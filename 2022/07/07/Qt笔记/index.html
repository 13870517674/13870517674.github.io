<!DOCTYPE html>
<html lang="CH">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="[TOC] Qt基础控件ToolButton按钮设置图标的方法和普通的Push Button按钮不同 它设置图标需要记得勾选一个控件    否则就算设置好控件的长宽与图片的一样依旧不行，会有一个框框。 而且一定要看图片的长宽，我们这个图片的大小是58*32，就算在iconSize内设置多大也不会再有变化，同时按钮控件的范围最好也保持一致，不然会出现实际点击界面大于图片显示界面。直接使用代码设置图片">
<meta property="og:type" content="article">
<meta property="og:title" content="Qt笔记.md">
<meta property="og:url" content="http://example.com/2022/07/07/Qt%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="[TOC] Qt基础控件ToolButton按钮设置图标的方法和普通的Push Button按钮不同 它设置图标需要记得勾选一个控件    否则就算设置好控件的长宽与图片的一样依旧不行，会有一个框框。 而且一定要看图片的长宽，我们这个图片的大小是58*32，就算在iconSize内设置多大也不会再有变化，同时按钮控件的范围最好也保持一致，不然会出现实际点击界面大于图片显示界面。直接使用代码设置图片">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5Cclip_image001.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5Cclip_image004.jpg">
<meta property="og:image" content="c:/Users/AMD/Desktop/Qt/图片/clip_image005.png">
<meta property="og:image" content="http://example.com/2022/07/07/Qt%E7%AC%94%E8%AE%B0/图片/clip_image007.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5Cclip_image009.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CL%5BTO$J_%5D~%7B~%7BTXYXBV%607D%7D7.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_08-48-35.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_08-58-10.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_09-07-48.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_09-10-19.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_15-07-51.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_15-08-26.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_19-09-52.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_19-11-51.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_21-07-42.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_21-07-59.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_23-33-24.png">
<meta property="og:image" content="c:/Users/AMD/Desktop/Qt/图片/Snipaste_2022-06-10_23-33-48.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-11_14-04-33.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_12-22-51.png">
<meta property="og:image" content="c:/Users/AMD/Desktop/Qt/图片/Snipaste_2022-06-12_12-23-18.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_13-19-06.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_13-22-43.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_13-23-28.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_14-04-41.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_11-43-42.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_11-43-48.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_12-38-54.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_12-40-50.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_21-21-56.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_16-19-44.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_16-30-42.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-14_22-57-47.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-15_16-47-04.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-15_17-12-12.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-15_17-36-54.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-15_17-40-20.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-16_15-24-45.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-16_15-43-54.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5C20220617224303.png">
<meta property="og:image" content="http://example.com/%5C%E5%9B%BE%E7%89%87%5CQQ%E5%9B%BE%E7%89%8720220617223709.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5C20220617230032.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5C20220617230456.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5C20220617232527.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5C20220618095516.png">
<meta property="og:image" content="c:/Users/AMD/Desktop/Qt/图片/Snipaste_2022-06-21_16-26-38.png">
<meta property="og:image" content="c:/Users/AMD/Desktop/Qt/图片/Snipaste_2022-06-21_16-31-49.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-25_14-24-02.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-28_16-35-49.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-05_17-13-31.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-04_23-55-18.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-05_21-42-07.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-05_21-43-52.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-05_21-44-54.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-22-48.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-24-50.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-27-37.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-29-10.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-30-50.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-53-06.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-59-01.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_16-11-21.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_16-21-51.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_18-13-30.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_18-15-07.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_17-53-26.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_19-30-16.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-07_15-06-32.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-07_15-30-44.png">
<meta property="og:image" content="http://example.com/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-07_15-49-24.png">
<meta property="article:published_time" content="2022-07-07T07:57:19.136Z">
<meta property="article:modified_time" content="2022-07-07T07:56:18.746Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/%E5%9B%BE%E7%89%87%5Cclip_image001.png">

<link rel="canonical" href="http://example.com/2022/07/07/Qt%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'CH'
  };
</script>

  <title>Qt笔记.md | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="تشغيل شريط التصفح">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>الأرشيفات</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="CH">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/07/Qt%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Qt笔记.md
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">نُشر في</span>
              

              <time title="أُنشأ: 2022-07-07 15:57:19 / عُدل: 15:56:18" itemprop="dateCreated datePublished" datetime="2022-07-07T15:57:19+08:00">2022-07-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>[TOC]</p>
<h1 id="Qt基础控件"><a href="#Qt基础控件" class="headerlink" title="Qt基础控件"></a>Qt基础控件</h1><h2 id="ToolButton按钮设置图标的方法"><a href="#ToolButton按钮设置图标的方法" class="headerlink" title="ToolButton按钮设置图标的方法"></a>ToolButton按钮设置图标的方法</h2><p>和普通的Push Button按钮不同 它设置图标需要记得勾选一个控件</p>
<p><img src="/%E5%9B%BE%E7%89%87%5Cclip_image001.png"></p>
<p><img src="/%E5%9B%BE%E7%89%87%5Cclip_image004.jpg" alt="clip_image004"></p>
<p><img src="C:\Users\AMD\Desktop\Qt\图片\clip_image005.png" alt="clip_image005"></p>
<p>否则就算设置好控件的长宽与图片的一样依旧不行，会有一个框框。</p>
<p>而且一定要看图片的长宽，我们这个图片的大小是58*32，就算在iconSize内设置多大也不会再有变化，同时按钮控件的范围最好也保持一致，不然会出现实际点击界面大于图片显示界面。直接使用代码设置图片也大差不差，就是指定控件，然后加一个set，比如下面这样</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ui-&gt;toolButton&gt;<span class="built_in">setIcon</span>(<span class="built_in">QIcon</span>(<span class="string">&quot;:/1/3.Button_Small-Em_Gray.png&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>高度宽度就不说了，api都差不多。</p>
<hr>
<h2 id="scrollArea滚动区域使用QLabel标签添加图片"><a href="#scrollArea滚动区域使用QLabel标签添加图片" class="headerlink" title="scrollArea滚动区域使用QLabel标签添加图片"></a>scrollArea滚动区域使用QLabel标签添加图片</h2><p>我们这里说说图片，控件，文字什么的都差不多，先看代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QLabel*pic=<span class="keyword">new</span> QLabel;</span><br><span class="line">    pic-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/1/2.jpg&quot;</span>));<span class="comment">//标签类添加图像</span></span><br><span class="line">    ui-&gt;scrollArea-&gt;<span class="built_in">setWidget</span>(pic);<span class="comment">//放入到滚动区域</span></span><br><span class="line">    pic-&gt;<span class="built_in">setFixedWidth</span>(<span class="number">1200</span>);       <span class="comment">//必须设置固定大小居中才能生效</span></span><br><span class="line">    pic-&gt;<span class="built_in">setFixedHeight</span>(<span class="number">1200</span>);</span><br><span class="line">    ui-&gt;scrollArea-&gt;<span class="built_in">setAlignment</span>(Qt::AlignHCenter);<span class="comment">//设置居中</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们为什么要设置固定大小?当然，我们设置的固定大小是图片大小。</p>
<p>首先为了缩放和主窗口一起 我们还得设置一个东西:在设计师模式设置整个主窗口为<strong>水平布局</strong>，scrollArea控件就会随着主窗口的变化自动收缩了。比如下面这样</p>
<img src="图片\clip_image007.png" style="zoom:60%;" />

<p><strong>scrollArea</strong>控件的大小基本等于主窗口了，我们可以用下拉或者又拉查看整个画面。</p>
<p><strong>固定大小的原因在于</strong>:如若不固定，那么会自动把图片填充满整个scrollArea控件，<strong>它会认为这全部都是它的大小，水平居中也就没有意义了，因为它觉得，我都已经满了，还居中啥</strong>，也就是说，一个很小的图片，如果加入scrollArea而不设置固定大小，实际上scrollArea把图片作为一部分实际上填满了自己。</p>
<hr>
<h2 id="Windeployqt命令在Windows下打包Qt程序"><a href="#Windeployqt命令在Windows下打包Qt程序" class="headerlink" title="Windeployqt命令在Windows下打包Qt程序"></a>Windeployqt命令在Windows下打包Qt程序</h2><p>首先要找到Qt的命令提示符</p>
<p><img src="/%E5%9B%BE%E7%89%87%5Cclip_image009.png"></p>
<p>用哪种编译器就用哪个打包</p>
<ol>
<li><p>先让项目用release跑一遍</p>
</li>
<li><p>使用命令提示符，cd到对应生成的exe路径(推荐重新创建一个文件夹再拷贝exe就行)</p>
</li>
<li><p>输入windeployqt 程序名称 程序名称也就是exe后缀的</p>
</li>
</ol>
<p>然后就会自动把对应的库，也就是dll等文件拷贝过来，就完成了</p>
<hr>
<h2 id="QDesktopServices-amp-Qurl写一个浏览器搜索框"><a href="#QDesktopServices-amp-Qurl写一个浏览器搜索框" class="headerlink" title="QDesktopServices&amp;Qurl写一个浏览器搜索框"></a>QDesktopServices&amp;Qurl写一个浏览器搜索框</h2><p>代码如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加到toolBar工具栏</span></span><br><span class="line">  QPushButton*b=<span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="string">&quot;搜索&quot;</span>);</span><br><span class="line">  ui-&gt;toolBar-&gt;<span class="built_in">addWidget</span>(b);<span class="comment">//添加一个按钮搜索</span></span><br><span class="line">  QPushButton*e=<span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="string">&quot;清除&quot;</span>);</span><br><span class="line">  ui-&gt;toolBar-&gt;<span class="built_in">addWidget</span>(e);<span class="comment">//添加一个按钮清除</span></span><br><span class="line">  QLineEdit*edit = <span class="keyword">new</span> QLineEdit;</span><br><span class="line">  <span class="comment">///edit-&gt;setMaximumWidth(200);//设置最大宽度为200</span></span><br><span class="line">  edit-&gt;<span class="built_in">setFixedWidth</span>(<span class="number">300</span>);<span class="comment">//设置固定宽度为300</span></span><br><span class="line">  edit-&gt;<span class="built_in">setFixedHeight</span>(<span class="number">25</span>);<span class="comment">//设置固定高度为30</span></span><br><span class="line">  ui-&gt;toolBar-&gt;<span class="built_in">addWidget</span>(edit);<span class="comment">//添加一个单行搜索框</span></span><br><span class="line">  edit-&gt;<span class="built_in">setFont</span>(<span class="built_in">QFont</span>( <span class="string">&quot;宋体&quot;</span> , <span class="number">10</span> ,  QFont::Normal) );<span class="comment">//设置字体和大小</span></span><br><span class="line">  edit-&gt;<span class="built_in">setPlaceholderText</span>(<span class="string">&quot;你要搜索什么呢?(*^▽^*)&quot;</span>);<span class="comment">//设置默认显示</span></span><br><span class="line">  edit-&gt;<span class="built_in">setMaxLength</span>(<span class="number">30</span>);<span class="comment">//设置最大的输入字符数</span></span><br><span class="line">  <span class="comment">//edit-&gt;setText(&quot;666&quot;); //类似于设置默认显示的test</span></span><br><span class="line"></span><br><span class="line"> <span class="built_in">connect</span>(b,&amp;QPushButton::clicked,<span class="keyword">this</span>,[=]()<span class="comment">//进行搜索</span></span><br><span class="line"> &#123;</span><br><span class="line">     QString value=edit-&gt;<span class="built_in">text</span>();            <span class="comment">//获取QLineEdit搜索框输入的值</span></span><br><span class="line">     <span class="comment">//QDesktopServices::openUrl(QUrl(&quot;https://www.baidu.com/s?ie=UTF-8&amp;wd=&quot;+value));//百度</span></span><br><span class="line">      QDesktopServices::<span class="built_in">openUrl</span>(<span class="built_in">QUrl</span>(<span class="string">&quot;https://www.bing.com/search?q=&quot;</span>+value));<span class="comment">//必应</span></span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="built_in">connect</span>(e,&amp;QPushButton::clicked,<span class="keyword">this</span>,[=]()</span><br><span class="line"> &#123;</span><br><span class="line">     edit-&gt;<span class="built_in">clear</span>();<span class="comment">//清空文本框的内容</span></span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<p>视图如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CL%5BTO$J_%5D~%7B~%7BTXYXBV%607D%7D7.png"></p>
<p>这里面唯一特殊的也就是我们设置的搜索按钮触发的信号<em>QDesktopServices::openUrl方法用于访问一个网址，参数要求是QUrl类型的</em></p>
<hr>
<h2 id="QVBoxLayout在滚动区域同时显示多个图片"><a href="#QVBoxLayout在滚动区域同时显示多个图片" class="headerlink" title="QVBoxLayout在滚动区域同时显示多个图片"></a>QVBoxLayout在滚动区域同时显示多个图片</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">QVBoxLayout*vlayout=<span class="keyword">new</span> QVBoxLayout;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        QLabel*pic=<span class="keyword">new</span> QLabel;</span><br><span class="line">        <span class="comment">//拼接字符串路径</span></span><br><span class="line">        QString name=<span class="built_in">QString</span>(<span class="string">&quot;:/1/%1&quot;</span>).<span class="built_in">arg</span>(i+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//设置QLabel的图片</span></span><br><span class="line">        pic-&gt;setPixma![Snipaste_2022<span class="number">-06</span><span class="number">-10</span>_08<span class="number">-48</span><span class="number">-35</span>](C:\Users\AMD\Desktop\Qt\图片\Snipaste_2022<span class="number">-06</span><span class="number">-10</span>_08<span class="number">-48</span><span class="number">-35.</span>png)<span class="built_in">p</span>(<span class="built_in">QPixmap</span>(name));</span><br><span class="line">        <span class="comment">//设置居中</span></span><br><span class="line">        pic-&gt;<span class="built_in">setAlignment</span>(Qt::AlignHCenter);</span><br><span class="line">        <span class="comment">//将已经设置好图片的标签QLabel插入到vlayout内</span></span><br><span class="line">        vlayout-&gt;<span class="built_in">addWidget</span>(pic);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//下面三行只是为了覆盖掉之前的设计 不需在意 我们的wg会覆盖掉之前的设计</span></span><br><span class="line">    QWidget*wg=<span class="keyword">new</span> QWidget;</span><br><span class="line">    wg-&gt;<span class="built_in">setLayout</span>(vlayout);</span><br><span class="line">    ui-&gt;scrollArea-&gt;<span class="built_in">setWidget</span>(wg);</span><br></pre></td></tr></table></figure>

<p>成品差不多下面这样</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_08-48-35.png"></p>
<p>我们可以看到有不止一张图片，下拉选项也很长，那就没问题了。</p>
<hr>
<h2 id="QProgressDialog-amp-QTimer设置进度条"><a href="#QProgressDialog-amp-QTimer设置进度条" class="headerlink" title="QProgressDialog&amp;QTimer设置进度条"></a>QProgressDialog&amp;QTimer设置进度条</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">QProgressDialog * progress=<span class="keyword">new</span> <span class="built_in">QProgressDialog</span>(<span class="string">&quot;正在拷贝数据...&quot;</span>,<span class="string">&quot;取消拷贝&quot;</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//初始化并显示进度条窗口 对话框的标题</span></span><br><span class="line">    progress-&gt;<span class="built_in">setWindowTitle</span>(<span class="string">&quot;请稍后&quot;</span>);</span><br><span class="line">    progress-&gt;<span class="built_in">show</span>();</span><br><span class="line">    <span class="comment">//更新进度条</span></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> value=<span class="number">0</span>; <span class="comment">//这里使用static是为了重复调用的时候value不被释放内存</span></span><br><span class="line">    QTimer *timer=<span class="keyword">new</span> QTimer;<span class="comment">//构造QTimer对象</span></span><br><span class="line">    <span class="built_in">connect</span>(timer,&amp;QTimer::timeout,<span class="keyword">this</span>,[=]()<span class="comment">//这个信号槽没什么好说的 它是用timer发射的信号</span></span><br><span class="line">    &#123;</span><br><span class="line">        progress-&gt;<span class="built_in">setValue</span>(value);</span><br><span class="line">        value++;</span><br><span class="line">        <span class="comment">//当value &gt; 最大值的时候</span></span><br><span class="line">        <span class="keyword">if</span>(value &gt; progress-&gt;<span class="built_in">maximum</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            timer-&gt;<span class="built_in">stop</span>();<span class="comment">//直到调用stop方法才会停止</span></span><br><span class="line">            value=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">delete</span> progress;</span><br><span class="line">            <span class="keyword">delete</span> timer;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//用于点击取消后得以退出的信号槽</span></span><br><span class="line">    <span class="built_in">connect</span>(progress,&amp;QProgressDialog::canceled,<span class="keyword">this</span>,[=]()<span class="comment">//此信号槽在点击取消按钮的时候触发</span></span><br><span class="line">    &#123;</span><br><span class="line">     timer-&gt;<span class="built_in">stop</span>();<span class="comment">//退出</span></span><br><span class="line">     value=<span class="number">0</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    timer-&gt;<span class="built_in">start</span>(<span class="number">50</span>);<span class="comment">//以msec毫秒的超时间隔启动或重新启动计时器。 这里也就是隔50毫秒</span></span><br></pre></td></tr></table></figure>

<p>运行如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_08-58-10.png"></p>
<p>我们第三行调用的是show方法，其实也可以使用模态，例如下面这样</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">progress-&gt;<span class="built_in">setWindowModality</span>(Qt::WindowModal);   <span class="comment">//使用模态</span></span><br></pre></td></tr></table></figure>

<p><strong>Qt::NonModal 非模态</strong><br><strong>Qt::WindowModal 模态+阻塞父窗口</strong><br><strong>Qt::ApplicationModal 模态 阻塞应用程序中的所有窗口</strong></p>
<hr>
<h2 id="QColor-amp-QBrush-amp-QRect-amp-QPixmap-amp-QPainter设置颜色"><a href="#QColor-amp-QBrush-amp-QRect-amp-QPixmap-amp-QPainter设置颜色" class="headerlink" title="QColor&amp;QBrush&amp;QRect&amp;QPixmap&amp;QPainter设置颜色"></a>QColor&amp;QBrush&amp;QRect&amp;QPixmap&amp;QPainter设置颜色</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">   QColor color = QColorDialog::<span class="built_in">getColor</span>();</span><br><span class="line"><span class="comment">//使用我们选择好的颜色属性创建brush对象</span></span><br><span class="line">   <span class="function">QBrush <span class="title">brush</span><span class="params">(color)</span></span>;</span><br><span class="line"><span class="comment">//使用Label控件color的宽和高创建rect对象</span></span><br><span class="line">   <span class="function">QRect <span class="title">rect</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>,ui-&gt;color-&gt;width(),ui-&gt;color-&gt;height())</span></span>;</span><br><span class="line"><span class="comment">//设置显示大小，使用rect的宽和高</span></span><br><span class="line">   <span class="function">QPixmap <span class="title">pix</span><span class="params">(rect.width(),rect.height())</span></span>;</span><br><span class="line">   <span class="function">QPainter <span class="title">p</span><span class="params">(&amp;pix)</span></span>;</span><br><span class="line"><span class="comment">//填满矩形 参数为大小与颜色</span></span><br><span class="line">   p.<span class="built_in">fillRect</span>(rect,brush);</span><br><span class="line">   <span class="comment">//设置Label的颜色 所有的ui-&gt;color都是Label控件 我们先前添加的</span></span><br><span class="line">   ui-&gt;color-&gt;<span class="built_in">setPixmap</span>(pix);</span><br><span class="line">   <span class="comment">//字符串拼接 然后修改Label内容显示出来</span></span><br><span class="line">   QString text =<span class="built_in">QString</span>(<span class="string">&quot;red: %1,green: %2,blue: %3,透明度: %4&quot;</span>)</span><br><span class="line">           .<span class="built_in">arg</span>(color.<span class="built_in">red</span>()).<span class="built_in">arg</span>(color.<span class="built_in">green</span>()).<span class="built_in">arg</span>(color.<span class="built_in">blue</span>()).<span class="built_in">arg</span>(color.<span class="built_in">alpha</span>());</span><br><span class="line">   ui-&gt;colorlabel-&gt;<span class="built_in">setText</span>(text);</span><br></pre></td></tr></table></figure>

<p>行代码是一个封装的调用，会显示如下这样:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_09-07-48.png"></p>
<p>我们手动选择之后就返回一个QColor对象</p>
<p>然后就会显示:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_09-10-19.png"></p>
<hr>
<h2 id="QtabWidget设置多个窗口与信号"><a href="#QtabWidget设置多个窗口与信号" class="headerlink" title="QtabWidget设置多个窗口与信号"></a>QtabWidget设置多个窗口与信号</h2><p>代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//移除tab页 也就是点击那个x就会触发 移除之前进行保存信息</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;tabWidget,&amp;QTabWidget::tabCloseRequested,<span class="keyword">this</span>,[=](<span class="type">int</span> index)</span><br><span class="line">    &#123;</span><br><span class="line">       QWidget*wg=ui-&gt;tabWidget-&gt;<span class="built_in">widget</span>(index);<span class="comment">//部件</span></span><br><span class="line">       QString title=ui-&gt;tabWidget-&gt;<span class="built_in">tabText</span>(index);<span class="comment">//标题</span></span><br><span class="line">       m_widgets.<span class="built_in">enqueue</span>(wg);</span><br><span class="line">       m_names.<span class="built_in">enqueue</span>(title);</span><br><span class="line">       <span class="comment">//移除</span></span><br><span class="line">       ui-&gt;tabWidget-&gt;<span class="built_in">removeTab</span>(index);</span><br><span class="line">       <span class="comment">//按钮状态设置为可用</span></span><br><span class="line">       ui-&gt;addBtn-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//单纯的点击就会触发，比如重复点击同一个</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;tabWidget,&amp;QTabWidget::tabBarClicked,<span class="keyword">this</span>,[=](<span class="type">int</span> index)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;我被点击了 我的的标题是:&quot;</span>+<span class="built_in">QString</span>(ui-&gt;tabWidget-&gt;<span class="built_in">tabText</span>(index));</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//必须切换，也就是重复点击相同控件无法触发</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;tabWidget,&amp;QTabWidget::currentChanged,<span class="keyword">this</span>,[=](<span class="type">int</span> index)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;我被切换了 的标题是:&quot;</span>+<span class="built_in">QString</span>(ui-&gt;tabWidget-&gt;<span class="built_in">tabText</span>(index));</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//按钮 用于恢复之前删除的</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;addBtn,&amp;QPushButton::clicked,<span class="keyword">this</span>,[=]()&#123;</span><br><span class="line">        ui-&gt;tabWidget-&gt;<span class="built_in">addTab</span>(m_widgets.<span class="built_in">dequeue</span>(),m_names.<span class="built_in">dequeue</span>());</span><br><span class="line">        <span class="keyword">if</span>(m_widgets.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//设置按钮不可用</span></span><br><span class="line">            ui-&gt;addBtn-&gt;<span class="built_in">setDisabled</span>(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里面的m_widgets与m_names放在类的私有成员也就是头文件处;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QQueue&lt;QWidget*&gt;m_widgets;</span><br><span class="line">QQueue&lt;QString&gt;m_names;</span><br></pre></td></tr></table></figure>

<p>我们写了四个信号的，第一个connect的主要在于注意在删除之前先备份数据放入队列与字符串内，然后即可调用<strong>removeTab</strong>方法传入index进行删除。</p>
<p>第二三connect没什么好说的，正常触发。</p>
<p>第四个connect是一个按钮触发的信号，目的是恢复被我们删除的窗口 如下</p>
<p><code>ui-&gt;tabWidget-&gt;addTab(m_widgets.dequeue(),m_names.dequeue());</code></p>
<p>同时要判断队列是否为空，如果为空证明我们已经恢复完了，没有东西再进行创建，此时设置为不可用状态<code>ui-&gt;addBtn-&gt;setDisabled(true);</code>，同时第一个connect如果有删除控件，那么就代表队列被插入了数据，也就可以使用恢复，按钮自然也就要恢复<code>ui-&gt;addBtn-&gt;setEnabled(true);</code></p>
<p>简单设置与界面如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_15-07-51.png"></p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_15-08-26.png" alt="Snipaste_2022-06-10_15-08-26"></p>
<hr>
<h2 id="QStackedWidget的简单使用"><a href="#QStackedWidget的简单使用" class="headerlink" title="QStackedWidget的简单使用"></a>QStackedWidget的简单使用</h2><p>其实这个类和上面那个差不多，先看设计师模式下设置</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_19-09-52.png"></p>
<p>也就是一个StackedWidget控件有两个页面，然后再主页面上还有两个按钮用于控制它们的切换:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_19-11-51.png"></p>
<p>代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置默认显示的窗口</span></span><br><span class="line">    ui-&gt;stackedWidget-&gt;<span class="built_in">setCurrentWidget</span>(ui-&gt;page_2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;win1,&amp;QPushButton::clicked,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;stackedWidget-&gt;<span class="built_in">setCurrentIndex</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;win2,&amp;QPushButton::clicked,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;stackedWidget-&gt;<span class="built_in">setCurrentIndex</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Qt多线程与网络通信"><a href="#Qt多线程与网络通信" class="headerlink" title="Qt多线程与网络通信"></a>Qt多线程与网络通信</h1><h2 id="创建线程生成随机数-amp-冒泡-amp-快排-amp-显示出来"><a href="#创建线程生成随机数-amp-冒泡-amp-快排-amp-显示出来" class="headerlink" title="创建线程生成随机数&amp;冒泡&amp;快排&amp;显示出来"></a>创建线程生成随机数&amp;冒泡&amp;快排&amp;显示出来</h2><p>我们先从第一步开始 设计师模式的控件:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_21-07-42.png"></p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_21-07-59.png"></p>
<p>我们创建了一个Generate类，如下 创建线程必须继承QThread类 同时重写run方法，它就是我们线程执行的代码</p>
<p><strong>Generate.h</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> GENERATE_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GENERATE_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QThread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QVector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Generate</span> : <span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Generate</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">recvNum</span><span class="params">(<span class="type">int</span> num)</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span><span class="keyword">override</span></span>;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt; num)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> m_num;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// GENERATE_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Generate.cpp</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Generate.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QElapsedTimer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line">Generate::<span class="built_in">Generate</span>(QObject *parent): QThread&#123;parent&#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Generate::recvNum</span><span class="params">(<span class="type">int</span> num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_num=num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Generate::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;生成随机数的线程的线程地址:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    QVector&lt;<span class="type">int</span>&gt;list;</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m_num;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        list.<span class="built_in">push_back</span>(<span class="built_in">rand</span>()%<span class="number">100000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> milsec=time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;生成&quot;</span>&lt;&lt;m_num&lt;&lt;<span class="string">&quot;个随机数总共用时:&quot;</span>&lt;&lt;milsec&lt;&lt;<span class="string">&quot;毫秒&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">sendArray</span><span class="params">(list)</span></span>;<span class="comment">//触发信号</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>就不放全部代码了，太麻烦 在mainWindow.h文件我们还创建了**void starting(int num);**信号 cpp有用代码如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建子线程对象</span></span><br><span class="line">Generate*gen=<span class="keyword">new</span> Generate;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这是一个自定义信号的connect 由this发出starting信号，gen对象的recvNum方法进行处理</span></span><br><span class="line"><span class="built_in">connect</span>(<span class="keyword">this</span>,&amp;MainWindow::starting,gen,&amp;Generate::recvNum);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.启动子线程</span></span><br><span class="line"><span class="built_in">connect</span>(ui-&gt;start,&amp;QPushButton::clicked,<span class="keyword">this</span>,[=]()</span><br><span class="line">&#123;</span><br><span class="line">    emit <span class="built_in">starting</span>(<span class="number">10000</span>);</span><br><span class="line">    gen-&gt;<span class="built_in">start</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//接收子线程发送的数据</span></span><br><span class="line"><span class="built_in">connect</span>(gen,&amp;Generate::sendArray,<span class="keyword">this</span>,[=](QVector&lt;<span class="type">int</span>&gt;list)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;randList-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>第二行代码就使用了该信号调用recvNum来处理</p>
<p>进行冒泡与快排同时显示</p>
<p>接下来我们看看写好的冒泡类和快排类以及更改的mainWindow文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BubbleSort</span>:<span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">BubbleSort</span><span class="params">(QObject *parent=<span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">recvArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span><span class="keyword">override</span></span>;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">finish</span><span class="params">(QVector&lt;<span class="type">int</span>&gt; num)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QVector&lt;<span class="type">int</span>&gt;m_list;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QuickSort</span>:<span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">QuickSort</span><span class="params">(QObject*parent=<span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">recvArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span><span class="keyword">override</span></span>;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">finish</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QVector&lt;<span class="type">int</span>&gt;m_list;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">quickSort</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right, QVector&lt;<span class="type">int</span>&gt;&amp; arr)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>下面是两个类的实现:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">BubbleSort::<span class="built_in">BubbleSort</span>(QObject *parent):<span class="built_in">QThread</span>(parent)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BubbleSort::recvArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt; list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_list=list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BubbleSort::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;冒泡排序的线程的线程地址:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    time.<span class="built_in">start</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m_list.<span class="built_in">size</span>();++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;m_list.<span class="built_in">size</span>()-i<span class="number">-1</span>;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(m_list[j]&gt;m_list[j+<span class="number">1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">            std::<span class="built_in">swap</span>(m_list[j],m_list[j+<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> milsec=time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;冒泡排序用时:&quot;</span>&lt;&lt;milsec&lt;&lt;<span class="string">&quot;毫秒&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">finish</span><span class="params">(m_list)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//QucikSort类方法的实现如下</span></span><br><span class="line"></span><br><span class="line">QuickSort::<span class="built_in">QuickSort</span>(QObject *parent):<span class="built_in">QThread</span>(parent)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QuickSort::recvArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt; list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_list=list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QuickSort::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;快速排序的线程的线程地址:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    time.<span class="built_in">start</span>();</span><br><span class="line">    <span class="built_in">quickSort</span>(<span class="number">0</span>,m_list.<span class="built_in">size</span>()<span class="number">-1</span>,m_list);</span><br><span class="line">    <span class="type">int</span> milsec=time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;快速排序用时:&quot;</span>&lt;&lt;milsec&lt;&lt;<span class="string">&quot;毫秒&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">finish</span><span class="params">(m_list)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QuickSort::quickSort</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right, QVector&lt;<span class="type">int</span>&gt;&amp; arr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (left &gt;= right)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> i=left, j=right, base = arr[left];<span class="comment">//取最左边的数为基准数</span></span><br><span class="line">    <span class="keyword">while</span> (i &lt; j)&#123;</span><br><span class="line">        <span class="keyword">while</span> (arr[j] &gt;= base &amp;&amp; i &lt; j)</span><br><span class="line">            j--;</span><br><span class="line">        <span class="keyword">while</span> (arr[i] &lt;= base &amp;&amp; i &lt; j)</span><br><span class="line">            i++;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) &#123;</span><br><span class="line">            std::<span class="built_in">swap</span>(arr[i], arr[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    std::<span class="built_in">swap</span>(arr[left], arr[i]);</span><br><span class="line">    <span class="built_in">quickSort</span>(left, i - <span class="number">1</span>, arr);<span class="comment">//递归左边</span></span><br><span class="line">    <span class="built_in">quickSort</span>(i + <span class="number">1</span>, right, arr);<span class="comment">//递归右边</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mainWind修改后代码如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建子线程对象</span></span><br><span class="line">Generate*gen=<span class="keyword">new</span> Generate;</span><br><span class="line">BubbleSort*bubble=<span class="keyword">new</span> BubbleSort;</span><br><span class="line">QuickSort*quick=<span class="keyword">new</span> QuickSort;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这是一个自定义信号的connect 由this发出starting信号，gen对象的recvNum方法进行处理</span></span><br><span class="line"><span class="built_in">connect</span>(<span class="keyword">this</span>,&amp;MainWindow::starting,gen,&amp;Generate::recvNum);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.启动子线程</span></span><br><span class="line"><span class="built_in">connect</span>(ui-&gt;start,&amp;QPushButton::clicked,<span class="keyword">this</span>,[=]()</span><br><span class="line">&#123;</span><br><span class="line">    emit <span class="built_in">starting</span>(<span class="number">10000</span>);</span><br><span class="line">    gen-&gt;<span class="built_in">start</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面两个connect用于调用sendArray方法的时候对冒泡类或者快排类的QVector赋值</span></span><br><span class="line"><span class="built_in">connect</span>(gen,&amp;Generate::sendArray,bubble,&amp;BubbleSort::recvArray);</span><br><span class="line"><span class="built_in">connect</span>(gen,&amp;Generate::sendArray,quick,&amp;QuickSort::recvArray);</span><br><span class="line"></span><br><span class="line"><span class="comment">//接收子线程发送的数据</span></span><br><span class="line"><span class="built_in">connect</span>(gen,&amp;Generate::sendArray,<span class="keyword">this</span>,[=](QVector&lt;<span class="type">int</span>&gt;list)</span><br><span class="line">&#123;</span><br><span class="line">    bubble-&gt;<span class="built_in">start</span>();</span><br><span class="line">    quick-&gt;<span class="built_in">start</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;randList-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">connect</span>(bubble,&amp;BubbleSort::finish,<span class="keyword">this</span>,[=](QVector&lt;<span class="type">int</span>&gt;list)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;bubbleList-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">connect</span>(quick,&amp;QuickSort::finish,<span class="keyword">this</span>,[=](QVector&lt;<span class="type">int</span>&gt;list)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;quickList-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol>
<li><p>是创建三个对象，也就是随机数，冒泡，快排；第一个connect是用来当调用starting(n)的时候会调用recvNum方法，也就是准备创建n个随机数</p>
</li>
<li><p>这个connect是随机数对象创建的，点击按钮后就调用starting(10000);会触发第一个的信号 然后开启线程，创建随机数</p>
</li>
<li><p>第三和第四个connect只是用于把冒号和快排对象的<strong>QVector对象</strong>赋值随机数，第五个connect也一起讲一下，为什么?看下面的代码</p>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Generate::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;生成随机数的线程的线程地址:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    QVector&lt;<span class="type">int</span>&gt;list;</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m_num;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        list.<span class="built_in">push_back</span>(<span class="built_in">rand</span>()%<span class="number">100000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> milsec=time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;生成&quot;</span>&lt;&lt;m_num&lt;&lt;<span class="string">&quot;个随机数总共用时:&quot;</span>&lt;&lt;milsec&lt;&lt;<span class="string">&quot;毫秒&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">sendArray</span><span class="params">(list)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不要遗忘了第一个随机数对象运行的时候最后一行代码是调用的sendArray(list);信号，也就是同时触发了<strong>3,4,5这三个connect</strong></p>
<p><strong>也就是完成了给BubbleSort与QuickSort的QVector<int>list对象的赋值随机数与将随机数显示到randList中</strong></p>
<p>最后两个connect使用的是各自自己类的finish信号，我们就举一个快排类的例子,冒泡也大差不差</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QuickSort::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;快速排序的线程的线程地址:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    time.<span class="built_in">start</span>();</span><br><span class="line">    <span class="built_in">quickSort</span>(<span class="number">0</span>,m_list.<span class="built_in">size</span>()<span class="number">-1</span>,m_list);</span><br><span class="line">    <span class="type">int</span> milsec=time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;快速排序用时:&quot;</span>&lt;&lt;milsec&lt;&lt;<span class="string">&quot;毫秒&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">finish</span><span class="params">(m_list)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个也是在run方法，也就是线程开启的时候执行的代码，进行排序，计时，<strong>然后将排序好的QVector传入信号finish</strong>；</p>
<p>也就会触发在mainWindow的connect，执行函数将排序好的数字显示到对应的文本框。冒泡同理，不再强调</p>
<p>运行结果如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-10_23-33-24.png"></p>
<p><img src="C:\Users\AMD\Desktop\Qt\图片\Snipaste_2022-06-10_23-33-48.png" alt="Snipaste_2022-06-10_23-33-48"></p>
<p><strong>这种方式只适合单个任务，如果处理多个任务推荐使用下面这种</strong></p>
<hr>
<h3 id="使用第二种方式创建线程"><a href="#使用第二种方式创建线程" class="headerlink" title="使用第二种方式创建线程"></a>使用第二种方式创建线程</h3><p>首先要创建一个任务类，必须要添加一个<strong>任务函数</strong>，叫什么无所谓，可以自由的传递参数。想要往外传递数据还是使用信号</p>
<p>任务函数的功能就是线程开启执行的代码，类似于第一种线程方式的**run()**，不过它是重写父类的方法，所以不能传参数</p>
<p>我们的任务对象必须继承QObject对象，因为在QObject内有一个方法叫moveToThread用于将任务对象移动到对应的子线程</p>
<p>修改的代码如下，三个类:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Generate</span> : <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Generate</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">working</span><span class="params">(<span class="type">int</span> num)</span></span>;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt; num)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BubbleSort</span>:<span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">BubbleSort</span><span class="params">(QObject *parent=<span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">working</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span>;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">finish</span><span class="params">(QVector&lt;<span class="type">int</span>&gt; num)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QuickSort</span>:<span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">QuickSort</span><span class="params">(QObject*parent=<span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">working</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">quickSort</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right, QVector&lt;<span class="type">int</span>&gt;&amp; arr)</span></span>;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">finish</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这里主要的改变在于继承从QThread变成QObject，且把run方法换成了<strong>working</strong>任务函数，它能够传参，同时也就去除了三个类的私有成员,以及recvArray方法。<strong>信号不变</strong>，看cpp实现代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">Generate::<span class="built_in">Generate</span>(QObject *parent): QObject&#123;parent&#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Generate::working</span><span class="params">(<span class="type">int</span> num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;生成随机数的线程的线程地址:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    QVector&lt;<span class="type">int</span>&gt;list;</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    time.<span class="built_in">start</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;num;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        list.<span class="built_in">push_back</span>(<span class="built_in">rand</span>()%<span class="number">100000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> milsec=time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;生成&quot;</span>&lt;&lt;num&lt;&lt;<span class="string">&quot;个随机数总共用时:&quot;</span>&lt;&lt;milsec&lt;&lt;<span class="string">&quot;毫秒&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">sendArray</span><span class="params">(list)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BubbleSort::<span class="built_in">BubbleSort</span>(QObject *parent):<span class="built_in">QObject</span>(parent)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BubbleSort::working</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;冒泡排序的线程的线程地址:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    time.<span class="built_in">start</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;list.<span class="built_in">size</span>()-i<span class="number">-1</span>;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(list[j]&gt;list[j+<span class="number">1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">            std::<span class="built_in">swap</span>(list[j],list[j+<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> milsec=time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;冒泡排序用时:&quot;</span>&lt;&lt;milsec&lt;&lt;<span class="string">&quot;毫秒&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">finish</span><span class="params">(list)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">QuickSort::<span class="built_in">QuickSort</span>(QObject *parent):<span class="built_in">QObject</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QuickSort::working</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;快速排序的线程的线程地址:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    time.<span class="built_in">start</span>();</span><br><span class="line">    <span class="built_in">quickSort</span>(<span class="number">0</span>,list.<span class="built_in">size</span>()<span class="number">-1</span>,list);</span><br><span class="line">    <span class="type">int</span> milsec=time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;快速排序用时:&quot;</span>&lt;&lt;milsec&lt;&lt;<span class="string">&quot;毫秒&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">finish</span><span class="params">(list)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QuickSort::quickSort</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right, QVector&lt;<span class="type">int</span>&gt;&amp; arr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (left &gt;= right)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> i=left, j=right, base = arr[left];<span class="comment">//取最左边的数为基准数</span></span><br><span class="line">    <span class="keyword">while</span> (i &lt; j)&#123;</span><br><span class="line">        <span class="keyword">while</span> (arr[j] &gt;= base &amp;&amp; i &lt; j)</span><br><span class="line">            j--;</span><br><span class="line">        <span class="keyword">while</span> (arr[i] &lt;= base &amp;&amp; i &lt; j)</span><br><span class="line">            i++;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) &#123;</span><br><span class="line">            std::<span class="built_in">swap</span>(arr[i], arr[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    std::<span class="built_in">swap</span>(arr[left], arr[i]);</span><br><span class="line">    <span class="built_in">quickSort</span>(left, i - <span class="number">1</span>, arr);<span class="comment">//递归左边</span></span><br><span class="line">    <span class="built_in">quickSort</span>(i + <span class="number">1</span>, right, arr);<span class="comment">//递归右边</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>除了去除了几个recvArray的实现，把私有的m_list变成传参的list以外也就没啥区别了，下面是mainWindows.cpp的主要代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建子线程对象</span></span><br><span class="line">    QThread*t1=<span class="keyword">new</span> QThread;</span><br><span class="line">    QThread*t2=<span class="keyword">new</span> QThread;</span><br><span class="line">    QThread*t3=<span class="keyword">new</span> QThread;</span><br><span class="line"></span><br><span class="line">    <span class="comment">///2.創建人物类的对象</span></span><br><span class="line">    Generate*gen=<span class="keyword">new</span> Generate;</span><br><span class="line">    BubbleSort*bubble=<span class="keyword">new</span> BubbleSort;</span><br><span class="line">    QuickSort*quick=<span class="keyword">new</span> QuickSort;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.将任务对象移动到某个子线程中</span></span><br><span class="line">    gen-&gt;<span class="built_in">moveToThread</span>(t1);</span><br><span class="line">    bubble-&gt;<span class="built_in">moveToThread</span>(t2);</span><br><span class="line">    quick-&gt;<span class="built_in">moveToThread</span>(t3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这是一个自定义信号的connect 由this发出starting信号，gen对象的recvNum方法进行处理</span></span><br><span class="line">    <span class="built_in">connect</span>(<span class="keyword">this</span>,&amp;MainWindow::starting,gen,&amp;Generate::working);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.启动子线程</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;start,&amp;QPushButton::clicked,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        emit <span class="built_in">starting</span>(<span class="number">10000</span>);</span><br><span class="line">        t1-&gt;<span class="built_in">start</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//下面两个connect用于调用第一个connect被触发的时候触发信号working就会传入参数到这里进行排序</span></span><br><span class="line">    <span class="built_in">connect</span>(gen,&amp;Generate::sendArray,bubble,&amp;BubbleSort::working);</span><br><span class="line">    <span class="built_in">connect</span>(gen,&amp;Generate::sendArray,quick,&amp;QuickSort::working);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接收子线程发送的数据</span></span><br><span class="line">    <span class="built_in">connect</span>(gen,&amp;Generate::sendArray,<span class="keyword">this</span>,[=](QVector&lt;<span class="type">int</span>&gt;list)</span><br><span class="line">    &#123;</span><br><span class="line">        t2-&gt;<span class="built_in">start</span>();</span><br><span class="line">        t3-&gt;<span class="built_in">start</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">        &#123;</span><br><span class="line">            ui-&gt;randList-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(bubble,&amp;BubbleSort::finish,<span class="keyword">this</span>,[=](QVector&lt;<span class="type">int</span>&gt;list)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">        &#123;</span><br><span class="line">            ui-&gt;bubbleList-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(quick,&amp;QuickSort::finish,<span class="keyword">this</span>,[=](QVector&lt;<span class="type">int</span>&gt;list)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">        &#123;</span><br><span class="line">            ui-&gt;quickList-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当前窗口释放的时候会释放destory信号，就会执行我们下面的代码</span></span><br><span class="line">    <span class="built_in">connect</span>(<span class="keyword">this</span>,&amp;MainWindow::destroy,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">       t1-&gt;<span class="built_in">quit</span>();<span class="comment">//退出线程的事件循环</span></span><br><span class="line">       t1-&gt;<span class="built_in">wait</span>();<span class="comment">//等待</span></span><br><span class="line">       t1-&gt;<span class="built_in">deleteLater</span>();<span class="comment">//销毁线程对象</span></span><br><span class="line"></span><br><span class="line">       t2-&gt;<span class="built_in">quit</span>();</span><br><span class="line">       t2-&gt;<span class="built_in">wait</span>();</span><br><span class="line">       t2-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line"></span><br><span class="line">       t3-&gt;<span class="built_in">quit</span>();</span><br><span class="line">       t3-&gt;<span class="built_in">wait</span>();</span><br><span class="line">       t3-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line"></span><br><span class="line">       gen-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">       bubble-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">       quick-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>步入正题了，我们首先直接创建三个线程对象，然后再创建三个类对象。它们互相对应。</p>
<p>我们使用线程对象的<strong>moveToThread</strong>方法将任务对象放入到线程对象中</p>
<p>第一二三四个connect都和第一种方法没什么区别。不过:第二个connect的开启线程是<code>t1-&gt;start</code>也就是说我们都是直接操控线程对象。</p>
<p>第一种创建线程方法在第三四个connect调用的方法是进行赋值的，run是自己线程开启的时候执行排序之类的。而我们这种方法，因为可以传参，首先省掉了私有成员的开销，也省掉了赋值成员函数的开销。当然这还不是重点，看下面</p>
<p>捋一捋，首先点击按钮触发staring信号，开启t1线程；staring触发后执行gen的working方法，也就是随机数，执行完working方法发时候触发sendArray信号；这个信号会触发三个信号槽，触发冒泡与快排的working方法，第三个就是开启线程，线程对象就会分别让子线程去执行冒泡与快排的working方法，同时主线程这里将随机数显示出来；然后bubble和quick的connect他们working方法会触发finish信号；也就会有2个connect执行，分别对应显示冒泡和显示快排的结果。</p>
<p>最后一步就是线程资源的释放:</p>
<p>线程对象的quick是如果线程在事件循环就退出，否则则不执行操作，wait则是等待线程结束，类似于join，deleteLater方法和之前delete没啥区别。</p>
<hr>
<h2 id="线程池QThreadPool"><a href="#线程池QThreadPool" class="headerlink" title="线程池QThreadPool"></a>线程池QThreadPool</h2><p>使用qt的线程池则不需要自己释放资源，线程池来维护</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-11_14-04-33.png"></p>
<p>同时它比较<strong>智能</strong>，我们可以看出来,当随机数创建完毕后，线程空闲不会浪费，用来进行冒泡排序</p>
<p>快速排序则用到线程池的另一个线程精选排序</p>
<p>不再说那么详细了，拿一个类举例</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Generate</span> : <span class="keyword">public</span> QObject,<span class="keyword">public</span> QRunnable</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Generate</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">recvNum</span><span class="params">(<span class="type">int</span> num)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span><span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt; num)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> m_num;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我们不再继承QThread，改成QObject和QRunnable也就是线程池类；这是拿第一种创建线程方式改进的，其实没什么变化，cpp实现没什么变化。直接看mainWindow的cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建任务类对象</span></span><br><span class="line">   Generate*gen=<span class="keyword">new</span> Generate;</span><br><span class="line">   BubbleSort*bubble=<span class="keyword">new</span> BubbleSort;</span><br><span class="line">   QuickSort*quick=<span class="keyword">new</span> QuickSort;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">connect</span>(<span class="keyword">this</span>,&amp;MainWindow::starting,gen,&amp;Generate::recvNum);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//2.启动子线程</span></span><br><span class="line">   <span class="built_in">connect</span>(ui-&gt;start,&amp;QPushButton::clicked,<span class="keyword">this</span>,[=]()</span><br><span class="line">   &#123;</span><br><span class="line">       emit <span class="built_in">starting</span>(<span class="number">10000</span>);</span><br><span class="line">       QThreadPool::<span class="built_in">globalInstance</span>()-&gt;<span class="built_in">start</span>(gen);</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//下面两个connect用于调用sendArray方法的时候对冒泡类或者快排类的QVector赋值</span></span><br><span class="line">   <span class="built_in">connect</span>(gen,&amp;Generate::sendArray,bubble,&amp;BubbleSort::recvArray);</span><br><span class="line">   <span class="built_in">connect</span>(gen,&amp;Generate::sendArray,quick,&amp;QuickSort::recvArray);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//接收子线程发送的数据</span></span><br><span class="line">   <span class="built_in">connect</span>(gen,&amp;Generate::sendArray,<span class="keyword">this</span>,[=](QVector&lt;<span class="type">int</span>&gt;list)</span><br><span class="line">   &#123;</span><br><span class="line">       QThreadPool::<span class="built_in">globalInstance</span>()-&gt;<span class="built_in">start</span>(bubble);</span><br><span class="line">       QThreadPool::<span class="built_in">globalInstance</span>()-&gt;<span class="built_in">start</span>(quick);</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">       &#123;</span><br><span class="line">           ui-&gt;randList-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   <span class="built_in">connect</span>(bubble,&amp;BubbleSort::finish,<span class="keyword">this</span>,[=](QVector&lt;<span class="type">int</span>&gt;list)</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">       &#123;</span><br><span class="line">           ui-&gt;bubbleList-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   <span class="built_in">connect</span>(quick,&amp;QuickSort::finish,<span class="keyword">this</span>,[=](QVector&lt;<span class="type">int</span>&gt;list)</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.<span class="built_in">size</span>();++i)</span><br><span class="line">       &#123;</span><br><span class="line">           ui-&gt;quickList-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>

<p>和第一种创建线程方式没什么区别，只是把开启线程变成了<code>QThreadPool::globalInstance()-&gt;start(bubble);</code>这种样子，它是调用了线程池的静态方法。因为有线程池的存在，我们不需要自己释放资源。</p>
<hr>
<h2 id="基础的Qt套接字通信"><a href="#基础的Qt套接字通信" class="headerlink" title="基础的Qt套接字通信"></a>基础的Qt套接字通信</h2><p>C++的标准库不提供套接字通信的api，只能使用平台提供的C语言的api，但是Qt框架提供了。我们写了两个项目的代码，分别是服务器端和客户端，让它们进行连接，以此简单的演示。</p>
<p>Qt想要使用网络编程这方面的必须子阿pro文件加上<strong>QT +&#x3D; network</strong>相当于引入模块</p>
<p>以及三个头文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTcpServer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTcpSocket&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QHostAddress&gt;</span></span></span><br></pre></td></tr></table></figure>



<h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><p>下面是设计师界面和属性</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_12-22-51.png"></p>
<p><img src="C:\Users\AMD\Desktop\Qt\图片\Snipaste_2022-06-12_12-23-18.png"></p>
<p>我们直接先看mainWindows.h的主要代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_setListen_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendMsg_clicked</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QTcpServer*m_s;</span><br><span class="line">    QTcpSocket*m_tcp;</span><br><span class="line">    QLabel*m_status;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>头文件没什么好说的，类的两个信号对应的是两个按钮；</p>
<p> QTcpServer*m_s;它的作用主要是用来监听地址和端口。当有新的 TCP 连接，会触发 newConnection() 信号，此时可以调用 nextPendingConnection() 以将挂起的连接接受为已连接的 QTcpSocket，通过该对象可以与客户端通信。</p>
<p>也就是可以<strong>m_tcp&#x3D;m_s-&gt;nextPendingConnection();</strong></p>
<p>QTcpSocket*m_tcp;主要作用在数据之间的传输操作，写入读取等。</p>
<p>QLabel*m_status;这个只是用来更改连接状态的图片的。主要的实现代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">    ui-&gt;port-&gt;<span class="built_in">setText</span>(<span class="string">&quot;8889&quot;</span>);</span><br><span class="line">    <span class="built_in">setWindowTitle</span>(<span class="string">&quot;服务器&quot;</span>);</span><br><span class="line">    <span class="comment">//创建监听的服务器对象</span></span><br><span class="line">    m_s=<span class="keyword">new</span> <span class="built_in">QTcpServer</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//在连接成功的时候被触发</span></span><br><span class="line">    <span class="built_in">connect</span>(m_s,&amp;QTcpServer::newConnection,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        m_tcp=m_s-&gt;<span class="built_in">nextPendingConnection</span>();<span class="comment">//实例化对象</span></span><br><span class="line">        <span class="comment">//在连接成功的时候设置图片</span></span><br><span class="line">        m_status-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/done.png&quot;</span>).<span class="built_in">scaled</span>(<span class="number">30</span>,<span class="number">30</span>));</span><br><span class="line">        <span class="comment">//检测是否可以接收数据</span></span><br><span class="line">        <span class="built_in">connect</span>(m_tcp,&amp;QTcpSocket::readyRead,<span class="keyword">this</span>,[=]()</span><br><span class="line">        &#123;</span><br><span class="line">            QByteArray data = m_tcp-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">            ui-&gt;record-&gt;<span class="built_in">append</span>(<span class="string">&quot;客户端say:&quot;</span>+data);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//被断开连接的时候触发此信号</span></span><br><span class="line">        <span class="built_in">connect</span>(m_tcp,&amp;QTcpSocket::disconnected,<span class="keyword">this</span>,[=]()</span><br><span class="line">        &#123;</span><br><span class="line">            m_tcp-&gt;<span class="built_in">close</span>();</span><br><span class="line">            m_tcp-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">            m_status-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/Icons_Tint Color_Black.svg&quot;</span>).<span class="built_in">scaled</span>(<span class="number">30</span>,<span class="number">30</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    m_status=<span class="keyword">new</span> QLabel;</span><br><span class="line">    m_status-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/Icons_Tint Color_Black.svg&quot;</span>).<span class="built_in">scaled</span>(<span class="number">30</span>,<span class="number">30</span>));</span><br><span class="line">    ui-&gt;statusbar-&gt;<span class="built_in">addWidget</span>(<span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="string">&quot;连接状态:&quot;</span>));</span><br><span class="line">    ui-&gt;statusbar-&gt;<span class="built_in">addWidget</span>(m_status);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_setListen_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> port=ui-&gt;port-&gt;<span class="built_in">text</span>().<span class="built_in">toUShort</span>();</span><br><span class="line">    m_s-&gt;<span class="built_in">listen</span>(QHostAddress::Any,port);<span class="comment">//监听指定地址和断开</span></span><br><span class="line">    ui-&gt;setListen-&gt;<span class="built_in">setDisabled</span>(<span class="literal">true</span>);<span class="comment">//设置按钮为不可用状态</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendMsg_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//以纯文本的方式把数据显示出来</span></span><br><span class="line">    QString msg=ui-&gt;msg-&gt;<span class="built_in">toPlainText</span>();</span><br><span class="line">    m_tcp-&gt;<span class="built_in">write</span>(msg.<span class="built_in">toUtf8</span>());</span><br><span class="line">    ui-&gt;record-&gt;<span class="built_in">append</span>(<span class="string">&quot;服务器say:&quot;</span>+msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>先给端口的控件设置默认显示8889，然后设置程序的标题为服务器；创建监听的服务器对象，也就是给成员指针new赋值，我们指定了this作为父对象，那么则不需要delete了，在释放资源的时候，Qt框架会自动为我们释放。</p>
<p>第一个信号槽，需要newConnection触发，其实我们已经介绍过了:当有新的 TCP 连接，会触发 newConnection() 信号</p>
<p>我们先看按钮，第一个按钮是监视，点击它就会读取我们的port控件里面的数据，转换为short保存，然后m_s调用 listen() 监听指定的地址和端口。然后把按钮设置为不可用状态，因为点击了就不能再点击了。</p>
<p>我们看状态栏，它其实就是设置左下角的状态的先new一个Label，然后m_status再加一个图片。它就完成了。然后给我们的控件加上文字描述，然后再加一个m_status也就是加一个图片，也就是设置默认状态，默认的图片。</p>
<p>知道这些之后我们就可以假设监视的按钮被点击后，如果有新的tcp连接，就会触发第一个信号槽:我们给m_tcp实例化。同时设置 m_status的图片为另一个，也就是一个勾勾，默认是叉叉。因为我们的statusbar控件已经被添加为m_status，所以修改它就相当于修改了m_status显示的图片。</p>
<p>里面还嵌套了connect，第一个的信号是QTcpSocket::readyRead，当有新的数据到来，会触发 readyRead() 信号，此时在槽函数中进行读取即可。<code>QByteArray data = m_tcp-&gt;readAll();</code>。readAll函数会读取全部的缓冲区数据，data进行接收，然后<code>ui-&gt;record-&gt;append(&quot;客户端say:&quot;+data);</code>也就是把得到的数据全部放到record控件内，即历史记录。</p>
<p>嵌套的第二个connect就很简单了，如果被断开就触发信号:close 关闭套接字的 IO，以及套接字的连接；然后调用的deleteLater();和直接delete没什么区别。最后把图片设置为叉叉就行。</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_13-19-06.png"></p>
<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>接下来我们写客户端：设计师模式如下</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_13-22-43.png"></p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_13-23-28.png"></p>
<p>强调一下，为什么服务器端只有端口没有ip?因为服务器是在我们主机上，服务器所在的主机有ip，客户端的ip是为了连接我们的服务器的ip。端口是一个网络设备的接口，独占一个，端口作为服务器响应接收的端口。</p>
<p>我们放的代码不放不重要的….</p>
<p>好，我们看h代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendMsg_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_connect_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_disconnect_clicked</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QTcpSocket*m_tcp;</span><br><span class="line">    QLabel*m_status;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>三个信号对应三个按钮。QTcpSocket<em>m_tcp;的作用和前面服务器端一样，QLabel</em>m_status;还是改变状态的图片。cpp主要如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ui-&gt;port-&gt;<span class="built_in">setText</span>(<span class="string">&quot;8889&quot;</span>);</span><br><span class="line">    ui-&gt;ip-&gt;<span class="built_in">setText</span>(<span class="string">&quot;192.168.182.1&quot;</span>);</span><br><span class="line">    <span class="built_in">setWindowTitle</span>(<span class="string">&quot;客户端&quot;</span>);</span><br><span class="line">    ui-&gt;disconnect-&gt;<span class="built_in">setDisabled</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    m_tcp=<span class="keyword">new</span> QTcpSocket;</span><br><span class="line">    <span class="built_in">connect</span>(m_tcp,&amp;QTcpSocket::readyRead,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        QByteArray data=m_tcp-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">        ui-&gt;record-&gt;<span class="built_in">append</span>(<span class="string">&quot;服务器say:&quot;</span>+data);</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">connect</span>(m_tcp,&amp;QTcpSocket::disconnected,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        m_tcp-&gt;<span class="built_in">close</span>();</span><br><span class="line">        m_tcp-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">        m_status-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/Icons_Tint Color_Black.svg&quot;</span>).<span class="built_in">scaled</span>(<span class="number">30</span>,<span class="number">30</span>));</span><br><span class="line">        ui-&gt;record-&gt;<span class="built_in">append</span>(<span class="string">&quot;服务器已经和客户端断开了...&quot;</span>);</span><br><span class="line">        ui-&gt;connect-&gt;<span class="built_in">setDisabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;disconnect-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(m_tcp,&amp;QTcpSocket::connected,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        m_status-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/done.png&quot;</span>).<span class="built_in">scaled</span>(<span class="number">30</span>,<span class="number">30</span>));</span><br><span class="line">        ui-&gt;record-&gt;<span class="built_in">append</span>(<span class="string">&quot;已经成功连接到了服务器...&quot;</span>);</span><br><span class="line">        ui-&gt;connect-&gt;<span class="built_in">setDisabled</span>(<span class="literal">true</span>);</span><br><span class="line">        ui-&gt;disconnect-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//状态栏</span></span><br><span class="line">    m_status=<span class="keyword">new</span> QLabel;</span><br><span class="line">    m_status-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/Icons_Tint Color_Black.svg&quot;</span>).<span class="built_in">scaled</span>(<span class="number">30</span>,<span class="number">30</span>));</span><br><span class="line">    ui-&gt;statusbar-&gt;<span class="built_in">addWidget</span>(<span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="string">&quot;连接状态:&quot;</span>));</span><br><span class="line">    ui-&gt;statusbar-&gt;<span class="built_in">addWidget</span>(m_status);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendMsg_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//以纯文本的方式把数据显示出来</span></span><br><span class="line">    QString msg=ui-&gt;msg-&gt;<span class="built_in">toPlainText</span>();</span><br><span class="line">    m_tcp-&gt;<span class="built_in">write</span>(msg.<span class="built_in">toUtf8</span>());</span><br><span class="line">    ui-&gt;record-&gt;<span class="built_in">append</span>(<span class="string">&quot;客户端say:&quot;</span>+msg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_connect_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString ip=ui-&gt;ip-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> port=ui-&gt;port-&gt;<span class="built_in">text</span>().<span class="built_in">toUShort</span>();</span><br><span class="line">    m_tcp-&gt;<span class="built_in">connectToHost</span>(<span class="built_in">QHostAddress</span>(ip),port);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_disconnect_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_tcp-&gt;<span class="built_in">close</span>();</span><br><span class="line">    ui-&gt;connect-&gt;<span class="built_in">setDisabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;disconnect-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前面四行还是先分别设置默认的端口，ip，然后设置程序的标题，再设置按钮为不可用，这个按钮是用于断开连接，我们会在点击连接成功后设置为可用。</p>
<p>先看按钮，从connect按钮开始，也就是连接，先读取到ip，然后读取到port端口，然后使用connectToHost方法进行连接，传入ip和端口作为参数，这里进行了一个匿名构造QHostAddress(ip)，它只能接收这种参数。连接到服务器端后就完成了。</p>
<p>不过这只是一个执行，不代表会连接成功，我们需要看第三个connect，如果触发了connected信号就代表连接成功，然后设置图片以及按钮状态。</p>
<p>如果点击第一个按钮那么就是把msg控件的数据发送出去，同时显示到record控件作为历史记录。</p>
<p>第一个connect信号槽是用来接收服务器端发送的数据，显示出来，然后剩下一个按钮和一个connect用作关闭的。状态栏和服务器一样。</p>
<p><strong>上一个有一些没说清楚，readyRead信号是有新的数据到来会被触发</strong></p>
<p>结果如下，懒得做美化:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_14-04-41.png"></p>
<hr>
<h2 id="多线程搭建发送文件的客户端与服务端"><a href="#多线程搭建发送文件的客户端与服务端" class="headerlink" title="多线程搭建发送文件的客户端与服务端"></a>多线程搭建发送文件的客户端与服务端</h2><p>我们分为两个项目，先客户端，后服务器端</p>
<p>头文件需要如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QThread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QMessageBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QFileDialog&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QHostAddress&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QFile&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QFileInfo&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QTcpSocket&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;qDebug&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>注意pro文件<strong>QT       +&#x3D; core gui network</strong></p>
<h3 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h3><p>先看设计师模式与属性</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_11-43-42.png"></p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_11-43-48.png"></p>
<p>我们创建了一个sendfile的类，先看头文件重要的如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SendFile</span> : <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">SendFile</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    <span class="comment">//连接服务器</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">connectServer</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span> port,QString ip)</span></span>;</span><br><span class="line">    <span class="comment">//发送文件</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendFile</span><span class="params">(QString path)</span></span>;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">connectOK</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">gameover</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">curPercent</span><span class="params">(<span class="type">int</span> num)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QTcpSocket*m_tcp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这个类是工作类，工作对象的函数会在线程里面执行。我们看到它有两个函数，分别表示连接和传输文件这两个功能。三个信号都是用于处理按钮信号要做的东西，在mainWindow的三个按钮不会完成全部的工作，会触发我们的信号，让工作类的方法在子线程里面运行。cpp实现两个方法如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">SendFile::connectServer</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span> port, QString ip)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;连接服务器的线程:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    m_tcp=<span class="keyword">new</span> QTcpSocket;</span><br><span class="line">    m_tcp-&gt;<span class="built_in">connectToHost</span>(<span class="built_in">QHostAddress</span>(ip),port);</span><br><span class="line">    <span class="comment">//在调用connectToHost () 并成功建立连接后发出此信号 然后触发connectOK自定义信号</span></span><br><span class="line">    <span class="built_in">connect</span>(m_tcp,&amp;QTcpSocket::connected,<span class="keyword">this</span>,&amp;SendFile::connectOK);</span><br><span class="line">    <span class="comment">//关闭的时候触发此信号进行回收资源和关闭连接，同时触发另一个connect进行线程回收和断开连接</span></span><br><span class="line">    <span class="built_in">connect</span>(m_tcp,&amp;QTcpSocket::disconnected,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        m_tcp-&gt;<span class="built_in">close</span>();</span><br><span class="line">        m_tcp-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">        emit <span class="built_in">gameover</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SendFile::sendFile</span><span class="params">(QString path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;发送文件的子线程:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(path)</span></span>;</span><br><span class="line">    <span class="function">QFileInfo <span class="title">info</span><span class="params">(path)</span></span>;</span><br><span class="line">    <span class="type">int</span> fileSize=info.<span class="built_in">size</span>();</span><br><span class="line">    file.<span class="built_in">open</span>(QFile::ReadOnly);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(!file.<span class="built_in">atEnd</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> num=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(num==<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//告诉服务器总共要发送多少数据</span></span><br><span class="line">            m_tcp-&gt;<span class="built_in">write</span>((<span class="type">char</span>*)&amp;fileSize,<span class="number">4</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        QByteArray line=file.<span class="built_in">readLine</span>();</span><br><span class="line">        num+=line.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> percent=(num*<span class="number">100</span>/fileSize);</span><br><span class="line">        <span class="function">emit <span class="title">curPercent</span><span class="params">(percent)</span></span>;<span class="comment">//更新进度条的信号</span></span><br><span class="line">        <span class="comment">//发送给服务器</span></span><br><span class="line">        m_tcp-&gt;<span class="built_in">write</span>(line);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看mainWindow的h主要文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">startConnect</span><span class="params">(<span class="type">unsigned</span> <span class="type">short</span>,QString)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendFile</span><span class="params">(QString path)</span></span>;</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_connectServer_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_sendFile_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_selFile_clicked</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这两个信号是用于在点击按钮的时候触发这两个信号，然后connect执行的就是工作类的方法。三个槽函数对应的三个按钮。先看cpp实现如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;主线程:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    ui-&gt;ip-&gt;<span class="built_in">setText</span>(<span class="string">&quot;192.168.182.1&quot;</span>);</span><br><span class="line">    ui-&gt;port-&gt;<span class="built_in">setText</span>(<span class="string">&quot;8989&quot;</span>);</span><br><span class="line">    ui-&gt;progressBar-&gt;<span class="built_in">setRange</span>(<span class="number">0</span>,<span class="number">100</span>);<span class="comment">//进度条范围</span></span><br><span class="line">    ui-&gt;progressBar-&gt;<span class="built_in">setValue</span>(<span class="number">0</span>);<span class="comment">//进度条从0开始</span></span><br><span class="line">    <span class="comment">//创建线程对象</span></span><br><span class="line">    QThread*t=<span class="keyword">new</span> QThread;</span><br><span class="line">    <span class="comment">//创建任务对象</span></span><br><span class="line">    SendFile*worker=<span class="keyword">new</span> SendFile;</span><br><span class="line">    worker-&gt;<span class="built_in">moveToThread</span>(t);</span><br><span class="line">    <span class="built_in">connect</span>(<span class="keyword">this</span>,&amp;MainWindow::sendFile,worker,&amp;SendFile::sendFile);</span><br><span class="line">    <span class="built_in">connect</span>(<span class="keyword">this</span>,&amp;MainWindow::startConnect,worker,&amp;SendFile::connectServer);</span><br><span class="line">    <span class="comment">//处理主线程发送的信号</span></span><br><span class="line">    <span class="built_in">connect</span>(worker,&amp;SendFile::connectOK,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;连接服务器&quot;</span>,<span class="string">&quot;已经成功连接了服务器，恭喜!&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(worker,&amp;SendFile::gameover,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        t-&gt;<span class="built_in">quit</span>();</span><br><span class="line">        t-&gt;<span class="built_in">wait</span>();</span><br><span class="line">        worker-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">        t-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(worker,&amp;SendFile::curPercent,ui-&gt;progressBar,&amp;QProgressBar::setValue);</span><br><span class="line">    t-&gt;<span class="built_in">start</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//连接服务器按钮</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_connectServer_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString ip=ui-&gt;ip-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> port=ui-&gt;port-&gt;<span class="built_in">text</span>().<span class="built_in">toUShort</span>();</span><br><span class="line">    <span class="function">emit <span class="title">startConnect</span><span class="params">(port,ip)</span></span>;<span class="comment">//触发信号，在27行调用connectServer函数连接服务器的代码，在子线程运行</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//选择文件按钮</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_selFile_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString path=QFileDialog::<span class="built_in">getOpenFileName</span>();</span><br><span class="line">    <span class="keyword">if</span>(path.<span class="built_in">isEmpty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>,<span class="string">&quot;打开文件&quot;</span>,<span class="string">&quot;选择的文件路径不能为空!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ui-&gt;filePath-&gt;<span class="built_in">setText</span>(path);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//发送文件按钮</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_sendFile_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">emit <span class="title">sendFile</span><span class="params">(ui-&gt;filePath-&gt;text())</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前面六行是一些基础默认设置；创建线程对象，然后实例化任务对象，调用moveToThread方法，这个任务对象就被放到线程里面了，有信号触发执行它的方法就会放到线程里面执行。这两个connect信号槽是当连接服务的按钮和发送文件的按钮被点击后会触发信号，然后在子线程执行任务对象的方法。选择文件的按钮是在主线程执行，任务类也没写它的方法。</p>
<p>然后第三个connect的信号是在任务类的连接函数里面，如果连接成功，任务类就会触发此信号，然后主线程就执行一个弹窗。</p>
<p>第四个connect的信号是在任务类的连接函数里面如果断开连接的时候就会发射此信号，主线程就会执行这些关闭资源的操作。</p>
<p>第五个connect是百分比的信号，显示那个控件的，它的信号是在任务类的传输文件的方法进行触发。</p>
<p>最后线程开启，当然肯定不是执行完才开启线程的，我们是先说完了信号槽这些一个一个的，实际上是在构造的时候就开启线程，等待信号被触发的。</p>
<h3 id="服务器端-1"><a href="#服务器端-1" class="headerlink" title="服务器端"></a>服务器端</h3><p>服务器端很简单，先看设计师模式<img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_12-38-54.png"></p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_12-40-50.png"></p>
<p>我们用的是继承QThread的方式，重写run方法创建线程，我们创建了一个recvfile的类，头文件主要如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RecvFile</span> : <span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">RecvFile</span><span class="params">(QTcpSocket*tcp,QObject *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span><span class="keyword">override</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">        QTcpSocket*m_tcp;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">over</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>很简单，生命重写run方法，还有一个QTcpSocket*m_tcp;成员，套接字通信。还有一个over信号用来在run函数内已经接收玩数据后触发</p>
<p>cpp实现如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">RecvFile::<span class="built_in">RecvFile</span>(QTcpSocket*tcp,QObject *parent): QThread&#123;parent&#125;</span><br><span class="line">&#123;</span><br><span class="line">    m_tcp=tcp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">RecvFile::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;服务器子线程:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    QFile*file =<span class="keyword">new</span> <span class="built_in">QFile</span>(<span class="string">&quot;recv.txt&quot;</span>);</span><br><span class="line">    file-&gt;<span class="built_in">open</span>(QFile::WriteOnly);</span><br><span class="line">    <span class="comment">//接收数据</span></span><br><span class="line">    <span class="built_in">connect</span>(m_tcp,&amp;QTcpSocket::readyRead,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="type">static</span> <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">       <span class="type">static</span> <span class="type">int</span> total=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span>(count==<span class="number">0</span>)</span><br><span class="line">       &#123;</span><br><span class="line">           m_tcp-&gt;<span class="built_in">read</span>((<span class="type">char</span>*)&amp;total,<span class="number">4</span>);<span class="comment">//读取大小</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//读取剩余的数据</span></span><br><span class="line">       QByteArray all=m_tcp-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">       count+=all.<span class="built_in">size</span>();</span><br><span class="line">       file-&gt;<span class="built_in">write</span>(all);</span><br><span class="line">       <span class="comment">//判断数据是否接收完毕了</span></span><br><span class="line">       <span class="keyword">if</span>(count==total)</span><br><span class="line">       &#123;</span><br><span class="line">           m_tcp-&gt;<span class="built_in">close</span>();</span><br><span class="line">           m_tcp-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">           file-&gt;<span class="built_in">close</span>();</span><br><span class="line">           file-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">           emit <span class="built_in">over</span>();</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//进入事件循环</span></span><br><span class="line">    <span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造函数是有参构造，用于初始化私有成员。</p>
<p>run方法的m_tcp-&gt;read((char*)&amp;total,4);会读取总共数据有多少字节，m_tcp-&gt;readAll();会一次性读取全部的数据；然后count+&#x3D;all.size();</p>
<p>count得到被读取的数据的大小，然后进行比较，如果相等就证明数据读取完毕if(count&#x3D;&#x3D;total)。然后会关闭资源和触发over信号</p>
<p>看mainWindow的头文件主要:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MainWindow</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_setListen_clicked</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    QTcpServer*m_s;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>很简单，只有一个按钮槽函数和一个私有的QTcpServer*m_s;成员用于监视是是否有客户端连接，cpp实现如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;服务器主线程:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThread</span>();</span><br><span class="line"></span><br><span class="line">    m_s=<span class="keyword">new</span> <span class="built_in">QTcpServer</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">connect</span>(m_s,&amp;QTcpServer::newConnection,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        QTcpSocket*tcp=m_s-&gt;<span class="built_in">nextPendingConnection</span>();</span><br><span class="line">        <span class="comment">//创建子线程</span></span><br><span class="line">        RecvFile*subThread=<span class="keyword">new</span> <span class="built_in">RecvFile</span>(tcp);</span><br><span class="line">        subThread-&gt;<span class="built_in">start</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">connect</span>(subThread,&amp;RecvFile::over,<span class="keyword">this</span>,[=]()</span><br><span class="line">        &#123;</span><br><span class="line">            subThread-&gt;<span class="built_in">exit</span>();</span><br><span class="line">            subThread-&gt;<span class="built_in">wait</span>();</span><br><span class="line">            subThread-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">            QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;文件接收&quot;</span>,<span class="string">&quot;文件接收完毕!&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_setListen_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> port = ui-&gt;port-&gt;<span class="built_in">text</span>().<span class="built_in">toShort</span>();</span><br><span class="line">    m_s-&gt;<span class="built_in">listen</span>(QHostAddress::Any,port);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先看按钮吧，就是点击之后，会获取我们输入文本框的数据，转换为short。然后调用listen方法进行监视此端口。</p>
<p>构造函数里面就是给m_s先实例化。然后信号:当有新的 TCP 连接，会触发 newConnection() 信号,其实之前已经说过了。</p>
<p>然后创建子线程，开启线程….开启了之后就会执行之前在run写的代码，当run执行完毕接收完全部的数据就会触发over自定义信号，我们进行退出事件循环，这里用exit和quit差不多都是退出事件循环，为什么呢?因为我们在run最后写了exec();</p>
<p>为什么要让它进入事件循环呢?因为不同于c++标准库等的线程，qt的线程函数需要等待，等待触发信号，如果不这样做，那么就直接执行完，线程就结束了，触发信号就没用了，必须设置一个信号用于退出。其他时候一直循环等待着其他信号被触发然后执行对应的方法。</p>
<p>然后就是一点回收资源和提示。最后两个成品如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-12_21-21-56.png"></p>
<hr>
<h1 id="Qt事件"><a href="#Qt事件" class="headerlink" title="Qt事件"></a>Qt事件</h1><p>众所周知 Qt 是一个基于 C++ 的框架，主要用来开发带窗口的应用程序（不带窗口的也行，但不是主流）。我们使用的基于窗口的应用程序都是基于事件，其目的主要是用来实现回调（因为只有这样程序的效率才是最高的）。所以在 Qt 框架内部为我们提供了一些列的事件处理机制，当窗口事件产生之后，事件会经过：事件派发 -&gt; 事件过滤-&gt;事件分发-&gt;事件处理几个阶段。Qt 窗口中对于产生的一系列事件都有默认的处理动作，如果我们有特殊需求就需要在合适的阶段重写事件的处理动作。</p>
<p>事件（event）是由系统或者 Qt 本身在不同的场景下发出的。当用户按下 &#x2F; 移动鼠标、敲下键盘，或者是窗口关闭 &#x2F; 大小发生变化 &#x2F; 隐藏或显示都会发出一个相应的事件。一些事件在对用户操作做出响应时发出，如鼠标 &#x2F; 键盘事件等；另一些事件则是由系统自动发出，如计时器事件。</p>
<p>每一个 Qt 应用程序都对应一个唯一的 QApplication 应用程序对象，然后调用这个对象的 exec() 函数，这样 Qt 框架内部的事件检测就开始了（程序将进入事件循环来监听应用程序的事件）。</p>
<h2 id="事件处理函数的使用"><a href="#事件处理函数的使用" class="headerlink" title="事件处理函数的使用"></a>事件处理函数的使用</h2><p>事件的函数都有默认值，我们可以重写那些方法，比如QMainWindow类中的closeEvent事件处理器函数。我们可以重写如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::closeEvent</span><span class="params">(QCloseEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=QMessageBox::<span class="built_in">question</span>(<span class="keyword">this</span>,<span class="string">&quot;提问&quot;</span>,<span class="string">&quot;您确定要关闭窗口吗?&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(ret==QMessageBox::Yes)</span><br><span class="line">    &#123;</span><br><span class="line">        ev-&gt;<span class="built_in">accept</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        ev-&gt;<span class="built_in">ignore</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加上这段代码后，我们点击关闭按钮的时候就会弹出对话框让我们选择</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_16-19-44.png"></p>
<p>如果返回值&#x3D;&#x3D;Yes那么就执行accept函数，也就是接受的意思，反之忽略;</p>
<p>或者我们可以重写QResizeEvent类的resizeEvent事件处理器函数，代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::resizeEvent</span><span class="params">(QResizeEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;oldSize:&quot;</span>&lt;&lt;ev-&gt;<span class="built_in">oldSize</span>()&lt;&lt;<span class="string">&quot;currSize:&quot;</span>&lt;&lt;ev-&gt;<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span>  QSize &amp;QResizeEvent:: <span class="built_in">oldSize</span> () <span class="type">const</span></span><br><span class="line"><span class="comment">//返回小部件的旧尺寸。</span></span><br><span class="line">    </span><br><span class="line"><span class="type">const</span> QSize&amp;QResizeEvent:: <span class="built_in">size</span> () <span class="type">const</span></span><br><span class="line"><span class="comment">//返回小部件的新大小。这与QWidget::size 相同。</span></span><br></pre></td></tr></table></figure>

<p>视图如下：每次移动都会触发事件</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-13_16-30-42.png"></p>
<h2 id="基于事件处理器函数自定义按钮"><a href="#基于事件处理器函数自定义按钮" class="headerlink" title="基于事件处理器函数自定义按钮"></a>基于事件处理器函数自定义按钮</h2><ol>
<li>从视觉上看是一个不规则的按钮(按钮实际上都是矩形的)</li>
<li>按钮上需要指定的背景图片</li>
<li>按钮在鼠标的不同操作阶段(无操作，鼠标悬停，鼠标按下)能够显示不同的背景图</li>
</ol>
<p>头文件如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyButton</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MyButton</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent*ev)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseReleaseEvent</span><span class="params">(QMouseEvent*ev)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enterEvent</span><span class="params">(QEvent*ev)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">leaveEvent</span><span class="params">(QEvent*ev)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent*ev)</span></span>;</span><br><span class="line">signals:</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//这里两种都可以</span></span><br><span class="line">    QPixmap m_pixmap;<span class="comment">//专注于显示，显示的时候效率更高</span></span><br><span class="line">    <span class="comment">//QImage m_imag;//主要是进行跨线程的图片传输，多线程绘图，能够实现一个像素级别的修改，QPixmap不可以。</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这里的五个函数都是重写父类的QWidget的事件处理函数，看cpp文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="comment">//没有被任何操作的时候,也就是默认显示</span></span><br><span class="line">MyButton::<span class="built_in">MyButton</span>(QWidget *parent): QWidget&#123;parent&#125;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">setMouseTracking</span>(<span class="literal">true</span>);</span><br><span class="line">    m_pixmap.<span class="built_in">load</span>(<span class="string">&quot;:/3.png&quot;</span>);</span><br><span class="line">    <span class="built_in">setFixedSize</span>(m_pixmap.<span class="built_in">size</span>());<span class="comment">//设置按钮的大小和图片大小一样</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//点击的时候</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyButton::mousePressEvent</span><span class="params">(QMouseEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_pixmap.<span class="built_in">load</span>(<span class="string">&quot;:/chilun.ico&quot;</span>);</span><br><span class="line">    <span class="built_in">update</span>();<span class="comment">//它是QWidget的槽函数会调用paintEvent重新绘制</span></span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//释放的时候</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyButton::mouseReleaseEvent</span><span class="params">(QMouseEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_pixmap.<span class="built_in">load</span>(<span class="string">&quot;:/3.png&quot;</span>);</span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;2&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//悬停的时候</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyButton::enterEvent</span><span class="params">(QEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;3&quot;</span>;</span><br><span class="line"><span class="comment">//    m_pixmap.load(&quot;:/done.png&quot;);</span></span><br><span class="line"><span class="comment">//    update();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//悬停鼠标离开的时候</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyButton::leaveEvent</span><span class="params">(QEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_pixmap.<span class="built_in">load</span>(<span class="string">&quot;:/done.png&quot;</span>);</span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;4&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//窗口被刷新的时候调用，比如遮盖，最小化....</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyButton::paintEvent</span><span class="params">(QPaintEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;<span class="comment">//指定绘图设备</span></span><br><span class="line">    p.<span class="built_in">drawPixmap</span>(<span class="built_in">rect</span>(),m_pixmap);</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;5&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么控件如何添加?没有QWidget这个控件,其实我们可以在设计师模式添加父类的QWideget控件然后提升为MyButton即可，也就是自定义按钮了。</p>
<p>我们的ev都没有用到，编译器会提示警告，因为我们的确没有用到它，有两种解决方案，一种是去掉ev，只留下QPaintEvent*作为占位参数。或者使用一个Qt给我们提供的宏**Q_UNUSED(ev)**就是告诉编译器我的确没用到ev，你别警告了。</p>
<hr>
<h3 id="自定义按钮添加信号"><a href="#自定义按钮添加信号" class="headerlink" title="自定义按钮添加信号"></a>自定义按钮添加信号</h3><p>只需要在MyButton类内加上一个void clicked();信号然后在点击的时候触发就行，如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyButton::mousePressEvent</span><span class="params">(QMouseEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_pixmap.<span class="built_in">load</span>(<span class="string">&quot;:/chilun.ico&quot;</span>);</span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">    <span class="function">emit <span class="title">clicked</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实就是多了一个触发信号，仅此而已，然后在mainWIndow里面加上一个信号槽，如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(ui-&gt;button,&amp;MyButton::clicked,<span class="keyword">this</span>,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;按钮&quot;</span>,<span class="string">&quot;物无聊无聊无聊&quot;</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>当按钮被点击的时候触发对话框。</p>
<hr>
<h2 id="事件的使用—案例"><a href="#事件的使用—案例" class="headerlink" title="事件的使用—案例"></a>事件的使用—案例</h2><p>我们的目标是完成一个类似于一个透明的没有任何边框的，然后一堆蝴蝶在电脑上显示移动的画面</p>
<p>我们写了一个类butterfly。声明:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Butterfly</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Butterfly</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">(<span class="type">int</span> min,<span class="type">int</span> max)</span></span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent*ev)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">timerEvent</span><span class="params">(QTimerEvent*ev)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseRressEvent</span><span class="params">(QMouseEvent*ev)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseMoveEvent</span><span class="params">(QMouseEvent*ev)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enterEvent</span><span class="params">(QMouseEvent*ev)</span></span>;</span><br><span class="line">signals:</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QPixmap m_pixmap;</span><br><span class="line">    <span class="type">int</span> m_index=<span class="number">1</span>;</span><br><span class="line">    QPoint m_pt;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>有两个自定义函数用来移动图片，五个重写的父类的事件处理器函数。私有成员变量第一个是为了切换图片，第二个是为了计数，在两个图片之间进行切换，第三个是用来计算坐标点的。</p>
<p>实现代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">Butterfly::<span class="built_in">Butterfly</span>(QWidget *parent)</span><br><span class="line">    : QWidget&#123;parent&#125;</span><br><span class="line">&#123;</span><br><span class="line">    m_pixmap.<span class="built_in">load</span>(<span class="string">&quot;:/1&quot;</span>);</span><br><span class="line">    <span class="comment">//设置显示的大小和图片大小一样</span></span><br><span class="line">    <span class="built_in">setFixedSize</span>(m_pixmap.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">startTimer</span>(<span class="number">100</span>);<span class="comment">//没个100ms调用一次</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Butterfly::fly</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">fly</span>(<span class="number">10</span>,<span class="number">30</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Butterfly::fly</span><span class="params">(<span class="type">int</span> min, <span class="type">int</span> max)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_index++;</span><br><span class="line">    <span class="keyword">if</span>(m_index&gt;<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        m_index=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    QString name=<span class="built_in">QString</span>(<span class="string">&quot;:/%1&quot;</span>).<span class="built_in">arg</span>(m_index);</span><br><span class="line">    m_pixmap.<span class="built_in">load</span>(name);</span><br><span class="line">    <span class="built_in">update</span>();<span class="comment">//窗口刷新，就是调用paintEvent</span></span><br><span class="line">    <span class="type">int</span> stepX=QRandomGenerator::<span class="built_in">global</span>()-&gt;<span class="built_in">bounded</span>(min,max);</span><br><span class="line">    <span class="type">int</span> setpY=QRandomGenerator::<span class="built_in">global</span>()-&gt;<span class="built_in">bounded</span>(min,max);</span><br><span class="line">    <span class="type">int</span> curX=<span class="keyword">this</span>-&gt;<span class="built_in">geometry</span>().<span class="built_in">topLeft</span>().<span class="built_in">x</span>()+stepX;</span><br><span class="line">    <span class="type">int</span> curY=<span class="keyword">this</span>-&gt;<span class="built_in">geometry</span>().<span class="built_in">topLeft</span>().<span class="built_in">y</span>()+setpY;</span><br><span class="line">    QScreen *desk=QApplication::<span class="built_in">primaryScreen</span>();</span><br><span class="line">    <span class="keyword">if</span>(curX &gt;= desk-&gt;<span class="built_in">geometry</span>().<span class="built_in">right</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        curX=desk-&gt;<span class="built_in">geometry</span>().<span class="built_in">left</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(curY &gt;= desk-&gt;<span class="built_in">geometry</span>().<span class="built_in">bottom</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        curY=desk-&gt;<span class="built_in">geometry</span>().<span class="built_in">top</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">move</span>(curX,curY);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//进行绘制</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Butterfly::paintEvent</span><span class="params">(QPaintEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    p.<span class="built_in">drawPixmap</span>(<span class="built_in">rect</span>(),m_pixmap);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Butterfly::timerEvent</span><span class="params">(QTimerEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">fly</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//鼠标左键按下</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Butterfly::mouseRressEvent</span><span class="params">(QMouseEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//先判断是否为左键</span></span><br><span class="line">    <span class="keyword">if</span>(ev-&gt;<span class="built_in">button</span>()==Qt::LeftButton)</span><br><span class="line">    &#123;</span><br><span class="line">        m_pt=ev-&gt;<span class="built_in">globalPos</span>()-<span class="keyword">this</span>-&gt;<span class="built_in">geometry</span>().<span class="built_in">topLeft</span>();<span class="comment">//计算距离</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//鼠标移动</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Butterfly::mouseMoveEvent</span><span class="params">(QMouseEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ev-&gt;<span class="built_in">buttons</span>()&amp;Qt::LeftButton)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">move</span>(ev-&gt;<span class="built_in">globalPos</span>()-m_pt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Butterfly::enterEvent</span><span class="params">(QMouseEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">fly</span>(<span class="number">-200</span>,<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mainWindow主要如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Butterfly*win=<span class="keyword">new</span> <span class="built_in">Butterfly</span>(<span class="keyword">this</span>);</span><br><span class="line">    win-&gt;<span class="built_in">move</span>((<span class="built_in">width</span>()-win-&gt;<span class="built_in">width</span>())/<span class="number">2</span>,(<span class="built_in">height</span>()-win-&gt;<span class="built_in">height</span>())/<span class="number">2</span>);</span><br><span class="line">    <span class="comment">//去边框</span></span><br><span class="line">    <span class="built_in">setWindowFlags</span>(<span class="built_in">windowFlags</span>()|Qt::FramelessWindowHint);</span><br><span class="line">    <span class="comment">//设置窗口透明</span></span><br><span class="line">    <span class="built_in">setAttribute</span>(Qt::WA_TranslucentBackground);</span><br><span class="line">    <span class="comment">//窗口最大化显示</span></span><br><span class="line">    <span class="built_in">showMaximized</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Butterfly*win=<span class="keyword">new</span> <span class="built_in">Butterfly</span>(<span class="keyword">this</span>);</span><br><span class="line">        win-&gt;<span class="built_in">move</span>(QRandomGenerator::<span class="built_in">global</span>()-&gt;<span class="built_in">bounded</span>(<span class="keyword">this</span>-&gt;<span class="built_in">width</span>()),</span><br><span class="line">                  QRandomGenerator::<span class="built_in">global</span>()-&gt;<span class="built_in">bounded</span>(<span class="keyword">this</span>-&gt;<span class="built_in">height</span>()));</span><br><span class="line">        win-&gt;<span class="built_in">show</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>去除边框和窗口透明这很重要，还有最大化显示。这里用的随机数是QRandomGenerator的静态方法global然后bounded是一个重载方法，可以指定最大与最小的随机范围，或者只指定一个参数。</p>
<p>强调一下鼠标移动的事件，写法如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::mouseMoveEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString msg=<span class="built_in">QString</span>(<span class="string">&quot;move: x:%1,y:%2&quot;</span>).<span class="built_in">arg</span>(event-&gt;<span class="built_in">x</span>()).<span class="built_in">arg</span>(event-&gt;<span class="built_in">y</span>());</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里只是简单的获取坐标打印，重写mouseMoveEvent事件</p>
<hr>
<h2 id="event事件分发器"><a href="#event事件分发器" class="headerlink" title="event事件分发器"></a>event事件分发器</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">event</span><span class="params">(QEvent *event)</span></span>;<span class="comment">//函数原型</span></span><br></pre></td></tr></table></figure>

<p>专门用来分发事件 ****一切事件都先交给它来判断属于谁，再分发到哪里处理事件。事件处理器函数那里讲过一些使用。</p>
<p>返回值是bool类型，如果返回的是true代表用户要处理这个时间，不向下分发事件了</p>
<p>我们可以通过event2022年6月14日22:26:53分发器 拦截事件，比如拦截鼠标按下的事件(单击)，如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先在头文件声明然后cpp实现，也就是重写，记住要先继承QWidget或者别的父类</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">event</span><span class="params">(QEvent *event)</span></span>;</span><br><span class="line"><span class="comment">//cpp:</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Butterfly::event</span><span class="params">(QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">type</span>()==QEvent::MouseButtonPress)</span><br><span class="line">    &#123;</span><br><span class="line">        QString str = <span class="built_in">QString</span>(<span class="string">&quot;Event拦截了鼠标按下&quot;</span>);</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们使用的是之前讲事件处理函数和案例的QtEvent项目，在butterfly类里实测继承QWidget的类重写event是有效的(继承QLabel也行)。也是可以被拦截触发的。</p>
<p>但是我们这么写是有问题的，首先，我们这样写的话，表示要拦截此类所有的事件了，没有return分发，只是说当遇到点击事件会执行我们写的<code>QDebug()</code>代码。如果是别的事件则全部也不会执行，如果要让它正常执行，需要交给父类处理，也就是默认处置。对于需要拦截的事件也要记得返回true。正确如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Butterfly::event</span><span class="params">(QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">type</span>()==QEvent::MouseButtonPress)</span><br><span class="line">    &#123;</span><br><span class="line">        QString str = <span class="built_in">QString</span>(<span class="string">&quot;Event拦截了鼠标按下&quot;</span>);</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;str;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//true代表用户自己处理这个事件，不向下分发</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//其他事件交给父类处理 默认处置</span></span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">event</span>(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>QEvent::MouseButtonPress这是Qt框架里面的一个枚举的成员，Type枚举表示了很多的事件，图如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-14_22-57-47.png"></p>
<p>还有很多很多就不列举了。</p>
<p>总结它的作用:</p>
<ol>
<li>用于事件的分发</li>
<li>事件的拦截(不推荐)</li>
</ol>
<hr>
<h2 id="事件过滤器"><a href="#事件过滤器" class="headerlink" title="事件过滤器"></a>事件过滤器</h2><p>通过事件过滤器可以在程序分发到even事件之前再做一次高级拦截。使用 两个步骤</p>
<ol>
<li>给控件安装事件过滤器</li>
<li>重写eventfilter事件</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Butterfly::eventfilter</span><span class="params">(QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">type</span>()==QEvent::MouseButtonPress)</span><br><span class="line">    &#123;</span><br><span class="line">        QString str = <span class="built_in">QString</span>(<span class="string">&quot;Event拦截了鼠标按下&quot;</span>);</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;str;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//true代表用户自己处理这个事件，不向下分发</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//其他事件交给父类处理 默认处置</span></span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">eventfilter</span>(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和事件分发器的使用方式一样，都是重写的，区别在于。事件过滤器会在event分发之前进行拦截</p>
<hr>
<h1 id="QPainter绘图"><a href="#QPainter绘图" class="headerlink" title="QPainter绘图"></a>QPainter绘图</h1><p>绘图事件:void paintEvent(QPaintEvent*); 需要继承QWidget，我们之前的Qt事件重写过这个</p>
<p>声明一个画家对象，指定绘图设备，然后即可开始绘画设置</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::paintEvent</span><span class="params">(QPaintEvent *)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//实例化画家对象 this指定的是绘图设备</span></span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    <span class="comment">//设置画笔</span></span><br><span class="line">    <span class="function">QPen <span class="title">pen</span><span class="params">(QColor(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>))</span></span>;</span><br><span class="line">    <span class="comment">//设置画笔宽度</span></span><br><span class="line">    pen.<span class="built_in">setWidth</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">//设置画笔风格</span></span><br><span class="line">    pen.<span class="built_in">setStyle</span>(Qt::DotLine);</span><br><span class="line">    <span class="comment">//让画家使用这个笔</span></span><br><span class="line">    painter.<span class="built_in">setPen</span>(pen);</span><br><span class="line">    <span class="comment">//设置画刷</span></span><br><span class="line">    <span class="function">QBrush <span class="title">brush</span><span class="params">(QColor(Qt::green))</span></span>;</span><br><span class="line">    <span class="comment">//设置画刷风格</span></span><br><span class="line">    brush.<span class="built_in">setStyle</span>(Qt::Dense7Pattern);</span><br><span class="line">    <span class="comment">//让画家使用画刷</span></span><br><span class="line">    painter.<span class="built_in">setBrush</span>(brush);</span><br><span class="line">    <span class="comment">//画线</span></span><br><span class="line">    <span class="comment">//painter.drawLine(QPoint(0,0),QPoint(100,100));//被淘汰了</span></span><br><span class="line">    QLineF s;</span><br><span class="line">    s.<span class="built_in">setPoints</span>(<span class="built_in">QPointF</span>(<span class="number">0</span>,<span class="number">0</span>),<span class="built_in">QPointF</span>(<span class="number">100</span>,<span class="number">100</span>));</span><br><span class="line">    painter.<span class="built_in">drawLine</span>(s);</span><br><span class="line">    <span class="comment">//画圆 椭圆 QRect的四个参数分别是左顶宽高，表示在距离x100，y100的地方，画一个宽100高50的圆</span></span><br><span class="line">    painter.<span class="built_in">drawEllipse</span>(<span class="built_in">QRect</span>(<span class="number">100</span>,<span class="number">100</span>,<span class="number">100</span>,<span class="number">50</span>));</span><br><span class="line">    <span class="comment">//画矩形</span></span><br><span class="line">    painter.<span class="built_in">drawRect</span>(<span class="built_in">QRect</span>(<span class="number">20</span>,<span class="number">20</span>,<span class="number">20</span>,<span class="number">20</span>));</span><br><span class="line">    <span class="comment">//画文字 第一个参数是设置框框也就是范围，但是不会显示，只会显示第二个参数的字符串</span></span><br><span class="line">    painter.<span class="built_in">drawText</span>(<span class="built_in">QRect</span>(<span class="number">100</span>,<span class="number">200</span>,<span class="number">150</span>,<span class="number">50</span>),<span class="string">&quot;好好学习，天天向上&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这只是举例子，有需要可以看文档。</p>
<h3 id="高级设置"><a href="#高级设置" class="headerlink" title="高级设置"></a>高级设置</h3><ol>
<li>设置抗锯齿画圆</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">painter.<span class="built_in">drawEllipse</span>(<span class="built_in">QPoint</span>(<span class="number">100</span>,<span class="number">50</span>),<span class="number">50</span>,<span class="number">50</span>);</span><br><span class="line"><span class="comment">//设置抗锯齿能力 效率较低,但是好看</span></span><br><span class="line">painter.<span class="built_in">setRenderHint</span>(QPainter::Antialiasing);</span><br><span class="line">painter.<span class="built_in">drawEllipse</span>(<span class="built_in">QPoint</span>(<span class="number">200</span>,<span class="number">50</span>),<span class="number">50</span>,<span class="number">50</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>设置移动画家</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;    </span><br><span class="line"><span class="comment">//画矩形</span></span><br><span class="line">painter.<span class="built_in">drawRect</span>(<span class="built_in">QRect</span>(<span class="number">20</span>,<span class="number">20</span>,<span class="number">50</span>,<span class="number">50</span>));</span><br><span class="line"><span class="comment">//移动画家</span></span><br><span class="line">painter.<span class="built_in">translate</span>(<span class="number">100</span>,<span class="number">0</span>);</span><br><span class="line"><span class="comment">//保存画家状态</span></span><br><span class="line">painter.<span class="built_in">save</span>();</span><br><span class="line"><span class="comment">//绘画</span></span><br><span class="line">painter.<span class="built_in">drawRect</span>(<span class="built_in">QRect</span>(<span class="number">20</span>,<span class="number">20</span>,<span class="number">50</span>,<span class="number">50</span>));</span><br><span class="line"><span class="comment">//通过向量 ( dx , dy )平移坐标系。</span></span><br><span class="line">painter.<span class="built_in">translate</span>(<span class="number">100</span>,<span class="number">0</span>);</span><br><span class="line"><span class="comment">//还原画家保存状态</span></span><br><span class="line">painter.<span class="built_in">restore</span>();</span><br><span class="line"><span class="comment">//绘画</span></span><br><span class="line">painter.<span class="built_in">drawRect</span>(<span class="built_in">QRect</span>(<span class="number">20</span>,<span class="number">20</span>,<span class="number">50</span>,<span class="number">50</span>));</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="利用画家-画资源图片，调用绘图事件"><a href="#利用画家-画资源图片，调用绘图事件" class="headerlink" title="利用画家 画资源图片，调用绘图事件"></a>利用画家 画资源图片，调用绘图事件</h4><p>构造函数写一个这样的信号槽，先在类的成员加上一个int posX&#x3D;0;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(ui-&gt;pushButton,&amp;QPushButton::clicked,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        posX+=<span class="number">20</span>;<span class="comment">//用作移动位置的计数</span></span><br><span class="line">        <span class="comment">//如果要手动的调用绘图事件用upadat()</span></span><br><span class="line">        emit <span class="built_in">update</span>();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>绘图事件如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::paintEvent</span><span class="params">(QPaintEvent *)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(<span class="number">0</span>,posX,<span class="built_in">QPixmap</span>(<span class="string">&quot;:/xx.png&quot;</span>));<span class="comment">//x y 图片 （三个参数）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每次点击按钮都会计数，然后调用绘图事件，重新绘制，posX作为参数，也就是一直移动了</p>
<hr>
<h3 id="绘图设备"><a href="#绘图设备" class="headerlink" title="绘图设备"></a>绘图设备</h3><p>绘图设备是指继承QPainterDevice的子类。Qt一共提供了四个这样的类，分别是QPixmap，QBitmap，QImage和QPicture。其中</p>
<ol>
<li><p><strong>QPixmap</strong>专门为图形在屏幕上的显示做了优化</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pixmap绘图设备 初始化画布的大小</span></span><br><span class="line"><span class="function">QPixmap <span class="title">pix</span><span class="params">(<span class="number">300</span>,<span class="number">300</span>)</span></span>;</span><br><span class="line"><span class="comment">//填充颜色 也就是设置背景色</span></span><br><span class="line">pix.<span class="built_in">fill</span>(Qt::white);</span><br><span class="line"><span class="comment">//声明画家</span></span><br><span class="line"><span class="function">QPainter <span class="title">painter</span><span class="params">(&amp;pix)</span></span>;</span><br><span class="line">painter.<span class="built_in">setPen</span>(<span class="built_in">QPen</span>(Qt::green));</span><br><span class="line"><span class="comment">//第一个参数是圆的圆心的位置，第二三个参数是圆的宽高</span></span><br><span class="line">painter.<span class="built_in">drawEllipse</span>(<span class="built_in">QPoint</span>(<span class="number">150</span>,<span class="number">150</span>),<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line"><span class="comment">//保存到本地磁盘</span></span><br><span class="line">pix.<span class="built_in">save</span>(<span class="string">&quot;C:/Users/AMD/Desktop/pix.png&quot;</span>);</span><br></pre></td></tr></table></figure>


</li>
<li><p><strong>QBitmap</strong>是QPixmap的子类，它的色深限定为1，可以使用QPixmap的isQBixmap()函数来确定这个QPixmap是不是一个QBitmap</p>
</li>
<li><p><strong>QImage</strong>专门为图像的像素级访问做了优化</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QImage <span class="title">img</span><span class="params">(<span class="number">300</span>,<span class="number">300</span>,QImage::Format_RGB32)</span></span>;</span><br><span class="line">img.<span class="built_in">fill</span>(Qt::white);</span><br><span class="line"><span class="function">QPainter <span class="title">painter</span><span class="params">(&amp;img)</span></span>;</span><br><span class="line">painter.<span class="built_in">setPen</span>(<span class="built_in">QPen</span>(Qt::blue));</span><br><span class="line">painter.<span class="built_in">drawEllipse</span>(<span class="built_in">QPoint</span>(<span class="number">150</span>,<span class="number">150</span>),<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line"><span class="comment">//保存</span></span><br><span class="line">img.<span class="built_in">save</span>(<span class="string">&quot;C:/Users/AMD/Desktop/img.png&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>普通的使用方式，不是重点，看下面:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::paintEvent</span><span class="params">(QPaintEvent *)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    <span class="comment">//利用QImage对像素进行修改</span></span><br><span class="line">    QImage img;</span><br><span class="line">    img.<span class="built_in">load</span>(<span class="string">&quot;:/xx.png&quot;</span>);</span><br><span class="line">    <span class="comment">//修改像素点</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">50</span>;i&lt;<span class="number">100</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">50</span>;j&lt;<span class="number">100</span>;j++)</span><br><span class="line">        &#123;</span><br><span class="line">            QRgb value=<span class="built_in">qRgb</span>(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">            img.<span class="built_in">setPixel</span>(i,j,value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    painter.<span class="built_in">drawImage</span>(<span class="number">0</span>,<span class="number">0</span>,img);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-15_16-47-04.png"></p>
<p>setPixel方法就是用来修改像素点的，三个参数表示x轴y轴与颜色</p>
</li>
<li><p><strong>QPicture</strong>则可以记录和重写QPainter的各条命令。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/////在构造函数这样写/////</span></span><br><span class="line">    QPicture pic;</span><br><span class="line">    QPainter Painter;</span><br><span class="line">    Painter.<span class="built_in">begin</span>(&amp;pic);<span class="comment">//开始往pic上画</span></span><br><span class="line">    Painter.<span class="built_in">setPen</span>(<span class="built_in">QPen</span>(Qt::blue));</span><br><span class="line">    Painter.<span class="built_in">drawEllipse</span>(<span class="built_in">QPoint</span>(<span class="number">150</span>,<span class="number">150</span>),<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    Painter.<span class="built_in">end</span>();<span class="comment">//结束画画</span></span><br><span class="line">    <span class="comment">//保存到磁盘</span></span><br><span class="line">    pic.<span class="built_in">save</span>(<span class="string">&quot;C:/Users/AMD/Desktop/img.zt&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/////绘图事件/////</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::paintEvent</span><span class="params">(QPaintEvent *)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    QPicture pic;</span><br><span class="line">    pic.<span class="built_in">load</span>(<span class="string">&quot;C:/Users/AMD/Desktop/img.zt&quot;</span>);</span><br><span class="line">    painter.<span class="built_in">drawPicture</span>(<span class="number">0</span>,<span class="number">0</span>,pic);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p>首先我们使用QPicture正常的构造了一个对象，先调用begin方法表示开始画画，然后是正常操作，结束后调用end方法。就画完了，存到磁盘中。这个zt后缀名是随便取的，就算是png一样无法看到图片内容，它只是用来记录我们对图片的操作。</p>
<p>绘图事件使用QPicture的load方法可以读取本地磁盘的它所创建的文件。然后用QPainter的drawPicture方法正常显示到屏幕，如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-15_17-12-12.png"></p>
<p>QPicture并不是主要用来画图的，主要是记录操作</p>
<hr>
<h2 id="QFile文件操作"><a href="#QFile文件操作" class="headerlink" title="QFile文件操作"></a>QFile文件操作</h2><h3 id="读："><a href="#读：" class="headerlink" title="读："></a>读：</h3><p>设计师模式如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-15_17-36-54.png"></p>
<p>总共只有三个控件，也只需要完成读取然后显示路径显示内容。代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//点击选取文件按钮，弹出对话框</span></span><br><span class="line"><span class="built_in">connect</span>(ui-&gt;pushButton,&amp;QPushButton::clicked,[=]()</span><br><span class="line">&#123;</span><br><span class="line">    QString path=QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;打开文件&quot;</span>,<span class="string">&quot;C:/Users/AMD/Desktop&quot;</span>);</span><br><span class="line">    ui-&gt;lineEdit-&gt;<span class="built_in">setText</span>(path);<span class="comment">//设置对话框显示路径</span></span><br><span class="line">    QFile <span class="built_in">file</span>(path);<span class="comment">//参数就是文件路径</span></span><br><span class="line">    <span class="comment">//设置打开方式</span></span><br><span class="line">    file.<span class="built_in">open</span>(QFile::ReadOnly);</span><br><span class="line">    <span class="comment">//读取全部的数据放入array</span></span><br><span class="line">    QByteArray array=file.<span class="built_in">readAll</span>();</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(array);</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>值得注意的是<strong>QFile默认支持的格式是utf-8</strong>，注意转换</p>
<p>如果需要查看gbk文件可以改成下面这样,但是utf8也就看不了了，关于这个问题可调用一些别的api</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(ui-&gt;pushButton,&amp;QPushButton::clicked,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        QString path=QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;打开文件&quot;</span>,<span class="string">&quot;C:/Users/AMD/Desktop&quot;</span>);</span><br><span class="line">        ui-&gt;lineEdit-&gt;<span class="built_in">setText</span>(path);</span><br><span class="line">        <span class="comment">//编码格式类	将一些本地编码的字符串转换为 Unicode：</span></span><br><span class="line">        QTextCodec *codec = QTextCodec::<span class="built_in">codecForName</span>(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">        QFile <span class="built_in">file</span>(path);<span class="comment">//参数就是文件路径</span></span><br><span class="line">        <span class="comment">//设置打开方式</span></span><br><span class="line">        file.<span class="built_in">open</span>(QFile::ReadOnly);</span><br><span class="line">        <span class="comment">//读取全部的数据放入array</span></span><br><span class="line">        QByteArray array=file.<span class="built_in">readAll</span>();</span><br><span class="line">        <span class="comment">//array=file.readLine();//也可以按行读取</span></span><br><span class="line">       ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(codec-&gt;<span class="built_in">toUnicode</span>(array));<span class="comment">//从 Unicode 转换为本地编码</span></span><br><span class="line">       file.<span class="built_in">close</span>();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>atEjd();判断文件是否为空</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(!file.<span class="built_in">atEnd</span>())</span><br><span class="line">&#123;</span><br><span class="line">    array+=file.<span class="built_in">readLine</span>();<span class="comment">//按行读取</span></span><br><span class="line">&#125;</span><br><span class="line">ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(codec-&gt;<span class="built_in">toUnicode</span>(array));</span><br></pre></td></tr></table></figure>

<p>读取全部的话结果如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-15_17-40-20.png"></p>
<p>关于第一个Qt框架自带控件我们可以再举例几个其他的</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//打开目录</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_filedlg_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0   <span class="comment">//第一种 它只能打开目录</span></span></span><br><span class="line">    QString dirName = QFileDialog::<span class="built_in">getExistingDirectory</span>(<span class="keyword">this</span>,<span class="string">&quot;打开目录&quot;</span>,<span class="string">&quot;D:\\自用&quot;</span>);<span class="comment">//父窗口 名称 默认目录</span></span><br><span class="line">    QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;打开目录&quot;</span>,<span class="string">&quot;您选择的目录是:&quot;</span>+dirName);<span class="comment">//弹窗 显示我们打开的目录</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0   <span class="comment">//第二种 它能打开文件</span></span></span><br><span class="line">    <span class="function">QString <span class="title">arg</span><span class="params">(<span class="string">&quot;Text files (*.txt)&quot;</span>)</span></span>;</span><br><span class="line">    <span class="comment">//初始化过滤器 有两种选择 默认是arg的Text    最后返回打开文件的绝对路径</span></span><br><span class="line">    QString fileName=QFileDialog::<span class="built_in">getOpenFileName</span>(</span><br><span class="line">                <span class="keyword">this</span>,<span class="built_in">tr</span>(<span class="string">&quot;OPen FIle&quot;</span>),<span class="string">&quot;D://自用&quot;</span>,</span><br><span class="line">                <span class="built_in">tr</span>(<span class="string">&quot;Images9(*.png *.jpg);;Text files (*.txt)&quot;</span>),&amp;arg);</span><br><span class="line">    <span class="comment">//打印显示</span></span><br><span class="line">    QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;打开文件&quot;</span>,<span class="string">&quot;您选择的文件夹是:&quot;</span>+fileName);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1   <span class="comment">//第三种 它能打开多个文件遍历</span></span></span><br><span class="line">    <span class="comment">//这里由于于没有创建arg 也就不是没有默认值 而是第一个Images9 同时QStringList相当于有一堆QString的列表</span></span><br><span class="line">    QStringList fileNames=QFileDialog::<span class="built_in">getOpenFileNames</span>(<span class="comment">//getOpenFileNames和上面那个相比只是多了一个s 但是返回的类型变成了QStringList</span></span><br><span class="line">                <span class="keyword">this</span>,<span class="built_in">tr</span>(<span class="string">&quot;OPen FIle&quot;</span>),<span class="string">&quot;D://自用&quot;</span>,</span><br><span class="line">                <span class="built_in">tr</span>(<span class="string">&quot;Images9(*.png *.jpg);;Text files (*.txt)&quot;</span>));</span><br><span class="line">    QString names;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;fileNames.<span class="built_in">size</span>();++i)</span><br><span class="line">    &#123;</span><br><span class="line">        names+=fileNames[i]+<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;打开文件(s)&quot;</span>,<span class="string">&quot;您选择的文件夹是:&quot;</span>+names);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0   <span class="comment">//第四种 用来覆盖已有文件 或者自己写一个文件 不过这些都是不存在的 这个对话框只是用来找路径的</span></span></span><br><span class="line">    QString fileName=QFileDialog::<span class="built_in">getSaveFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;保存的文件&quot;</span>,<span class="string">&quot;D:\\&quot;</span>);</span><br><span class="line">    QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;保存文件&quot;</span>,<span class="string">&quot;您指定的保存数据的文件是:&quot;</span>+fileName);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="写"><a href="#写" class="headerlink" title="写:"></a>写:</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file.<span class="built_in">open</span>(QFile::Append);<span class="comment">//使用追加的方式写</span></span><br><span class="line">file.<span class="built_in">write</span>(<span class="string">&quot;啊啊啊啊啊&quot;</span>);</span><br><span class="line">file.<span class="built_in">close</span>();</span><br></pre></td></tr></table></figure>

<p>非常简单，用write方法即可，默认写入的是utf-8编码</p>
<h3 id="QFileIfo文件信息读取"><a href="#QFileIfo文件信息读取" class="headerlink" title="QFileIfo文件信息读取"></a>QFileIfo文件信息读取</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QFileInfo <span class="title">info</span><span class="params">(path)</span></span>;</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;大小:&quot;</span>&lt;&lt;info.<span class="built_in">size</span>()&lt;&lt;<span class="string">&quot;后缀名:&quot;</span>&lt;&lt;info.<span class="built_in">suffix</span>()&lt;&lt;<span class="string">&quot;文件名称:&quot;</span>&lt;&lt;info.<span class="built_in">fileName</span>()&lt;&lt;<span class="string">&quot;文件路径:&quot;</span>&lt;&lt;info.<span class="built_in">path</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;创建日期:&quot;</span>&lt;&lt;info.<span class="built_in">birthTime</span>().<span class="built_in">toString</span>(<span class="string">&quot;yyyy/MM/dd hh:mm:ss&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>还有很多APi<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6.2/qfileinfo.html">可以查看文档</a></p>
<h2 id="Qt的多媒体模块multimedia"><a href="#Qt的多媒体模块multimedia" class="headerlink" title="Qt的多媒体模块multimedia"></a>Qt的多媒体模块multimedia</h2><p>Qt6中已经没有<code>QSound</code>类，播放音频需要使用<code>QSoundEffect</code>类<code>QT += multimedia</code><br> 首先在<code>.pro</code>文件中添加<code>multimedia</code>模块<br>使用方法：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QSoundEffect * startSound = <span class="keyword">new</span> <span class="built_in">QSoundEffect</span>(<span class="keyword">this</span>);</span><br><span class="line">startSound-&gt;<span class="built_in">setSource</span>(QUrl::<span class="built_in">fromLocalFile</span>(<span class="string">&quot;:/i.wav&quot;</span>));</span><br><span class="line">startSound-&gt;<span class="built_in">play</span>();</span><br></pre></td></tr></table></figure>

<p>最简单的就是这样播放音乐</p>
<p>下面我们根据<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qsoundeffect.html"><strong>文档</strong></a>来稍微介绍一些操作:</p>
<p>这个例子展示了如何播放一个循环的、有点安静的声音效果：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QSoundEffect * startSound = <span class="keyword">new</span> <span class="built_in">QSoundEffect</span>(<span class="keyword">this</span>);</span><br><span class="line">startSound-&gt;<span class="built_in">setSource</span>(QUrl::<span class="built_in">fromLocalFile</span>(<span class="string">&quot;:/i.wav&quot;</span>));</span><br><span class="line">startSound-&gt;<span class="built_in">setLoopCount</span>(QSoundEffect::Infinite);</span><br><span class="line">startSound-&gt;<span class="built_in">setVolume</span>(<span class="number">0.1f</span>);</span><br><span class="line">startSound-&gt;<span class="built_in">play</span>();</span><br></pre></td></tr></table></figure>

<h3 id="void-QSoundEffect-setLoopCount-int-loopCount"><a href="#void-QSoundEffect-setLoopCount-int-loopCount" class="headerlink" title="void QSoundEffect::setLoopCount(int loopCount)"></a>void QSoundEffect::setLoopCount(int <em>loopCount</em>)</h3><p>将播放此音效的总次数设置为<em>loopCount</em>。</p>
<p>将循环计数设置为 0 或 1 意味着音效将只播放一次；通过<code>QSoundEffect::Infinite</code>无限重复。播放音效时可以更改循环计数，在这种情况下，它将将剩余循环更新为新的<em>loopCount</em>。我们上面就是这样</p>
<h3 id="void-QSoundEffect-setMuted-bool-muted"><a href="#void-QSoundEffect-setMuted-bool-muted" class="headerlink" title="void QSoundEffect:: setMuted ( bool muted )"></a>void QSoundEffect:: setMuted ( bool <em>muted</em> )</h3><p>设置是否静音此音效的播放。</p>
<p>如果<em>muted</em>为 true，则播放将静音（静音），否则将以当前指定的<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qsoundeffect.html#volume">音量</a>() 进行播放。</p>
<h3 id="QUrl-QSoundEffect-source-const"><a href="#QUrl-QSoundEffect-source-const" class="headerlink" title="QUrl QSoundEffect:: source () const"></a><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qurl.html">QUrl</a> QSoundEffect:: source () const</h3><p>返回当前播放源的 URL</p>
<p><strong>注意：</strong>属性源的 Getter 函数。</p>
<p><strong>另请参见</strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qsoundeffect.html#setSource">setSource</a> ()。</p>
<h3 id="qreal-QSoundEffect-volume-const"><a href="#qreal-QSoundEffect-volume-const" class="headerlink" title="qreal QSoundEffect:: volume () const"></a><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qtglobal.html#qreal-typedef">qreal</a> QSoundEffect:: volume () const</h3><p>返回此音效的当前音量，从 0.0（静音）到 1.0（最大音量）。</p>
<p><strong>注意：</strong>属性卷的 Getter 函数。</p>
<p><strong>另请参见</strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qsoundeffect.html#setVolume">setVolume</a> ()</p>
<p>具体看文档，我们举一个实际应用的例子，按钮触发</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(ui-&gt;pushButton,&amp;QPushButton::clicked,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">        startSound-&gt;<span class="built_in">play</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="built_in">connect</span>(ui-&gt;pushButton_2,&amp;QPushButton::clicked,[=]()</span><br><span class="line">    &#123;</span><br><span class="line">       startSound-&gt;<span class="built_in">stop</span>();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>点击停止按钮后可以继续点击播放，但是会从头再来。</p>
<p>它还有众多的信号，我们不再介绍，可以查看<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qsoundeffect.html#categoryChanged">文档</a></p>
<hr>
<h2 id="案例QAction"><a href="#案例QAction" class="headerlink" title="案例QAction"></a>案例QAction</h2><p>首先为我们需要在在视图加一个工具栏，像下面这样选中主窗口右击添加工具栏</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-16_15-24-45.png"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RC_ICONS += chilun.ico<span class="comment">//在pro文件加入图标</span></span><br></pre></td></tr></table></figure>

<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-16_15-43-54.png"></p>
<p>先设置好基础的控件按钮，这里的可选的意思是点击后有反馈，就是两种模式</p>
<p>实际上不止这些，成品是下面这样:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5C20220617224303.png"></p>
<p>代码在Project项目内，我们说几个功能</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//播放音乐的槽函数，QAction按钮控制，有两种状态，进行图标的更改和音乐的暂停</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actMusic_triggered</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(checked)</span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;actMusic-&gt;<span class="built_in">setIcon</span>(<span class="built_in">QIcon</span>(<span class="string">&quot;:/images/stop.png&quot;</span>));</span><br><span class="line">        startSound-&gt;<span class="built_in">play</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;actMusic-&gt;<span class="built_in">setIcon</span>(<span class="built_in">QIcon</span>(<span class="string">&quot;:/images/music.png&quot;</span>));</span><br><span class="line">        startSound-&gt;<span class="built_in">stop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//但是一定要注意给播放音乐的对象初始化，在构造函数，至于对象创建在类里面就行，因为如果写在函数里，每次触发都是一个新的对象</span></span><br><span class="line"><span class="keyword">this</span>-&gt;startSound = <span class="keyword">new</span> <span class="built_in">QSoundEffect</span>(<span class="keyword">this</span>);</span><br><span class="line">startSound-&gt;<span class="built_in">setSource</span>(QUrl::<span class="built_in">fromLocalFile</span>(<span class="string">&quot;:/images/xia.wav&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>添加QCheckBox控件到工具栏使用，对QLabel进行只读的控制</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">QCheckBox*check=<span class="keyword">new</span> QCheckBox;</span><br><span class="line">check-&gt;<span class="built_in">setText</span>(<span class="string">&quot;阅读模式&quot;</span>);<span class="comment">//设置标题</span></span><br><span class="line">ui-&gt;toolBar-&gt;<span class="built_in">addWidget</span>(check);<span class="comment">//放入工具栏</span></span><br><span class="line"><span class="built_in">connect</span>(check,&amp;QCheckBox::clicked,[=](<span class="type">bool</span> choose)&#123;</span><br><span class="line">    <span class="keyword">if</span>(choose)</span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;textEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>一些其他操作如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新建文件</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actNew_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString path =QInputDialog::<span class="built_in">getText</span>(<span class="keyword">this</span>,<span class="string">&quot;新建文件&quot;</span>,<span class="string">&quot;请输入文件名和路径&quot;</span>,QLineEdit::Normal,<span class="string">&quot;C:/Users/AMD/Desktop&quot;</span>);</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(path)</span></span>;</span><br><span class="line">    file.<span class="built_in">open</span>(QFile::WriteOnly);</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">    <span class="comment">//QMessageBox::information(this,&quot;path&quot;,&quot;您的文件位于&quot;+path);</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;Path=path;</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setPlaceholderText</span>(<span class="string">&quot;请输入:&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存文件</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actionsave_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(Path)</span></span>;<span class="comment">//魔鬼细节，这里用的类的Path</span></span><br><span class="line">    file.<span class="built_in">open</span>(QFile::WriteOnly|QFile::Truncate );<span class="comment">//注意Truncate不能单独使用</span></span><br><span class="line">    file.<span class="built_in">write</span>(ui-&gt;textEdit-&gt;<span class="built_in">toPlainText</span>().<span class="built_in">toUtf8</span>());</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//读取文件数据返回</span></span><br><span class="line"><span class="function">QByteArray <span class="title">MainWindow::fileRead</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(Path)</span></span>;</span><br><span class="line">    file.<span class="built_in">open</span>(QFile::ReadOnly);</span><br><span class="line">    QByteArray array=file.<span class="built_in">readAll</span>();</span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//打开文件</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actOpen_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString path=QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;打开文件&quot;</span>,<span class="string">&quot;C:/Users/AMD/Desktop&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>-&gt;Path=path;</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(<span class="built_in">fileRead</span>());</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//删除文件</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actDeleteFile_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//QString path=QFileDialog::getOpenFileName(this,&quot;删除文件&quot;,&quot;C:/Users/AMD/Desktop&quot;);</span></span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(Path)</span></span>;</span><br><span class="line">    <span class="type">bool</span> c=file.<span class="built_in">remove</span>();</span><br><span class="line">    <span class="keyword">if</span>(c==<span class="literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;删除文件&quot;</span>,<span class="string">&quot;删除文件失败!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);<span class="comment">//设置不可编辑</span></span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setPlaceholderText</span>(<span class="string">&quot;请创建或打开一个新文件:&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//清空</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actEmpty_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//剪切</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actShear_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//通过QClipboard类设置剪贴板</span></span><br><span class="line">    QClipboard *clip = QApplication::<span class="built_in">clipboard</span>();</span><br><span class="line">    QString data=ui-&gt;textEdit-&gt;<span class="built_in">textCursor</span> ().<span class="built_in">selectedText</span> ();</span><br><span class="line">    clip-&gt;<span class="built_in">setText</span>(data);</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//复制</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actCopy_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QClipboard *clip = QApplication::<span class="built_in">clipboard</span>();</span><br><span class="line">    QString data=ui-&gt;textEdit-&gt;<span class="built_in">textCursor</span> ().<span class="built_in">selectedText</span> ();</span><br><span class="line">    clip-&gt;<span class="built_in">setText</span>(data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//粘贴</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actPaste_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QClipboard *clip = QApplication::<span class="built_in">clipboard</span>();</span><br><span class="line">    QString data=clip-&gt;<span class="built_in">text</span>();<span class="comment">//获取剪贴板的内容</span></span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">textCursor</span>().<span class="built_in">insertText</span>(data);<span class="comment">//在光标后进行追加</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置选中粗体</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actBold_triggered</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QTextCharFormat fmt;</span><br><span class="line">    <span class="keyword">if</span>(checked)</span><br><span class="line">    &#123;</span><br><span class="line">        fmt.<span class="built_in">setFontWeight</span>(QFont::Bold);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        fmt.<span class="built_in">setFontWeight</span>(QFont::Normal);</span><br><span class="line">    &#125;</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">mergeCurrentCharFormat</span>(fmt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置选中斜体</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actItalics_triggered</span><span class="params">(<span class="type">bool</span> checked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QTextCharFormat fmt;</span><br><span class="line">    <span class="keyword">if</span>(checked)</span><br><span class="line">    &#123;</span><br><span class="line">        fmt.<span class="built_in">setFontItalic</span>(checked);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        fmt.<span class="built_in">setFontItalic</span>(checked);</span><br><span class="line">    &#125;</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">mergeCurrentCharFormat</span>(fmt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置选中字体</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_setFont_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> ok;</span><br><span class="line">    QFont ft = QFontDialog::<span class="built_in">getFont</span>(&amp;ok,<span class="built_in">QFont</span>(<span class="string">&quot;微软雅黑&quot;</span>,<span class="number">12</span>,QFont::Bold),<span class="keyword">this</span>,<span class="string">&quot;选择字体&quot;</span>);</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setFont</span>(ft);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置选中文下划线</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actUnderline_toggled</span><span class="params">(<span class="type">bool</span> arg1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QTextCharFormat fmt;</span><br><span class="line">    fmt.<span class="built_in">setFontUnderline</span>(arg1);</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">mergeCurrentCharFormat</span>(fmt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//关闭程序</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actClose_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = QMessageBox::<span class="built_in">question</span>(<span class="keyword">this</span>,<span class="string">&quot;退出&quot;</span>,<span class="string">&quot;你要保存修改的文件内容再退出吗?&quot;</span>,<span class="comment">//?号</span></span><br><span class="line">                                    QMessageBox::Save | QMessageBox::Cancel,QMessageBox::Save);</span><br><span class="line">    <span class="keyword">if</span>(ret==QMessageBox::Save)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">on_actionsave_triggered</span>();</span><br><span class="line">        MainWindow::<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(ret ==QMessageBox::Cancel)</span><br><span class="line">    &#123;</span><br><span class="line">        MainWindow::<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="其他数值输入和显示组件"><a href="#其他数值输入和显示组件" class="headerlink" title="其他数值输入和显示组件:"></a>其他数值输入和显示组件:</h2><h3 id="使用QSlider控件"><a href="#使用QSlider控件" class="headerlink" title="使用QSlider控件"></a>使用QSlider控件</h3><p><img src="/%5C%E5%9B%BE%E7%89%87%5CQQ%E5%9B%BE%E7%89%8720220617223709.png"></p>
<p>我们要像图上一样用四个QSlider控件控制Qlabel的颜色</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先写了一个槽函数,我们是直接选择了valueChanged(int)信号转到</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_horizontalSlider_valueChanged</span><span class="params">(<span class="type">int</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QPalette pal=ui-&gt;textEdit-&gt;<span class="built_in">palette</span>();</span><br><span class="line">    QColor color;</span><br><span class="line">    color.<span class="built_in">setRgb</span>(ui-&gt;horizontalSlider-&gt;<span class="built_in">value</span>(),ui-&gt;horizontalSlider_2-&gt;<span class="built_in">value</span>(),</span><br><span class="line">                 ui-&gt;horizontalSlider_3-&gt;<span class="built_in">value</span>(),ui-&gt;horizontalSlider_4-&gt;<span class="built_in">value</span>());</span><br><span class="line">    pal.<span class="built_in">setColor</span>(QPalette::Base,color);</span><br><span class="line">    ui-&gt;textEdit-&gt;<span class="built_in">setPalette</span>(pal);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//我们完全没必要重复造轮子，剩下的三个控件使用connect构造函数连接即可，如下:</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;horizontalSlider_2,&amp;QSlider::valueChanged,<span class="keyword">this</span>,<span class="keyword">this</span>-&gt;on_horizontalSlider_valueChanged);</span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;horizontalSlider_3,&amp;QSlider::valueChanged,<span class="keyword">this</span>,<span class="keyword">this</span>-&gt;on_horizontalSlider_valueChanged);</span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;horizontalSlider_4,&amp;QSlider::valueChanged,<span class="keyword">this</span>,<span class="keyword">this</span>-&gt;on_horizontalSlider_valueChanged</span><br></pre></td></tr></table></figure>

<h3 id="使用QDial联动QLCDNumber，如图"><a href="#使用QDial联动QLCDNumber，如图" class="headerlink" title="使用QDial联动QLCDNumber，如图:"></a>使用QDial联动QLCDNumber，如图:</h3><p><img src="/%E5%9B%BE%E7%89%87%5C20220617230032.png"></p>
<p>其实就是使用这个轮盘来操作LCD显示的数字，非常简单</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用的valueChanged(int)信号转到，和前面一样</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_dial_valueChanged</span><span class="params">(<span class="type">int</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;LCDDisplay-&gt;<span class="built_in">display</span>(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="QSlider控件操作QProgressBar"><a href="#QSlider控件操作QProgressBar" class="headerlink" title="QSlider控件操作QProgressBar"></a>QSlider控件操作QProgressBar</h3><p><img src="/%E5%9B%BE%E7%89%87%5C20220617230456.png"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用valueChanged(int)信号，依旧是一行代码</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_SliderV_valueChanged</span><span class="params">(<span class="type">int</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;progBarV-&gt;<span class="built_in">setValue</span>(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="QRadioButton控制QLCDNumber"><a href="#QRadioButton控制QLCDNumber" class="headerlink" title="QRadioButton控制QLCDNumber"></a>QRadioButton控制QLCDNumber</h3><p>如图:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5C20220617232527.png"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2进制</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_radioButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;LCDDisplay-&gt;<span class="built_in">setDigitCount</span>(<span class="number">8</span>);<span class="comment">//设置位数</span></span><br><span class="line">    ui-&gt;LCDDisplay-&gt;<span class="built_in">setBinMode</span>();<span class="comment">//设置进制</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//8进制</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_radioButton_2_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;LCDDisplay-&gt;<span class="built_in">setDigitCount</span>(<span class="number">4</span>);</span><br><span class="line">    ui-&gt;LCDDisplay-&gt;<span class="built_in">setOctMode</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//10进制</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_radioButton_3_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;LCDDisplay-&gt;<span class="built_in">setDigitCount</span>(<span class="number">3</span>);</span><br><span class="line">    ui-&gt;LCDDisplay-&gt;<span class="built_in">setDecMode</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//16进制</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_radioButton_4_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;LCDDisplay-&gt;<span class="built_in">setDigitCount</span>(<span class="number">3</span>);</span><br><span class="line">    ui-&gt;LCDDisplay-&gt;<span class="built_in">setHexMode</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="时间日期与定时器"><a href="#时间日期与定时器" class="headerlink" title="时间日期与定时器"></a>时间日期与定时器</h2><p>先看成品，如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5C20220618095516.png"></p>
<p>当成三个部分就行，我们先看读取当前日期时间:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnGetTime_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//获取当前日期时间，为三个专用编辑器设置日期时间数据，并转换为字符串在LineEdit里显示</span></span><br><span class="line">    QDateTime curDateTime=QDateTime::<span class="built_in">currentDateTime</span>(); <span class="comment">//读取当前日期时间</span></span><br><span class="line"></span><br><span class="line">    ui-&gt;timeEdit-&gt;<span class="built_in">setTime</span>(curDateTime.<span class="built_in">time</span>()); <span class="comment">//设置时间</span></span><br><span class="line">    ui-&gt;editTime-&gt;<span class="built_in">setText</span>(curDateTime.<span class="built_in">toString</span>(<span class="string">&quot;hh:mm:ss&quot;</span>));<span class="comment">//转换为字符串显示</span></span><br><span class="line"></span><br><span class="line">    ui-&gt;dateEdit-&gt;<span class="built_in">setDate</span>(curDateTime.<span class="built_in">date</span>());<span class="comment">//设置日期</span></span><br><span class="line">    ui-&gt;editDate-&gt;<span class="built_in">setText</span>(curDateTime.<span class="built_in">toString</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>));<span class="comment">//转换为字符串显示</span></span><br><span class="line"></span><br><span class="line">    ui-&gt;dateTimeEdit-&gt;<span class="built_in">setDateTime</span>(curDateTime);<span class="comment">//设置日期时间</span></span><br><span class="line">    ui-&gt;editDateTime-&gt;<span class="built_in">setText</span>(curDateTime.<span class="built_in">toString</span>(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>));<span class="comment">//转换为字符串显示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总共给6个控件显示时间或日期，三个是一些特有的控件:QTimeEdit，QDateEdit，QDataTimeEdit。分别是显示时间，日期，时间日期的。另外三个都是Q:ineEdit，我们格式化字符串显示即可</p>
<p>还有三个按钮是设置时间，设置日期，设置日期时间如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnSetTime_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//字符串转换为QTime</span></span><br><span class="line">    QString str=ui-&gt;editTime-&gt;<span class="built_in">text</span>(); <span class="comment">//读取字符串表示的时间</span></span><br><span class="line">    <span class="comment">//    str=str.trimmed();//去掉空格</span></span><br><span class="line">    <span class="keyword">if</span> (!str.<span class="built_in">isEmpty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        QTime tm=QTime::<span class="built_in">fromString</span>(str,<span class="string">&quot;hh:mm:ss&quot;</span>); <span class="comment">//从字符串转换为QTime</span></span><br><span class="line">        ui-&gt;timeEdit-&gt;<span class="built_in">setTime</span>(tm); <span class="comment">//设置时间</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnSetDate_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//字符串转换为 QDate</span></span><br><span class="line">    QString str=ui-&gt;editDate-&gt;<span class="built_in">text</span>(); <span class="comment">//读取字符串表示的日期</span></span><br><span class="line"><span class="comment">//    str=str.trimmed();//去掉空格</span></span><br><span class="line">    <span class="keyword">if</span> (!str.<span class="built_in">isEmpty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        QDate dt=QDate::<span class="built_in">fromString</span>(str,<span class="string">&quot;yyyy-MM-dd&quot;</span>);<span class="comment">//从字符串转换为 QDate</span></span><br><span class="line">        ui-&gt;dateEdit-&gt;<span class="built_in">setDate</span>(dt);<span class="comment">//设置日期</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnSetDateTime_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//字符串转换为 QDateTime</span></span><br><span class="line">    QString str=ui-&gt;editDateTime-&gt;<span class="built_in">text</span>();<span class="comment">//读取字符串表示的日期</span></span><br><span class="line">    str=str.<span class="built_in">trimmed</span>();<span class="comment">//去掉空格</span></span><br><span class="line">    <span class="keyword">if</span> (!str.<span class="built_in">isEmpty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        QDateTime datetime=QDateTime::<span class="built_in">fromString</span>(str,<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>); <span class="comment">//从字符串转换为 QDateTime</span></span><br><span class="line">        ui-&gt;dateTimeEdit-&gt;<span class="built_in">setDateTime</span>(datetime);<span class="comment">//设置日期时间</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二部分日历选择显示:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意日历是QCalendarWidget控件，点击日期会触发selectionChanged信号</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_calendarWidget_selectionChanged</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//在日历上选择日期</span></span><br><span class="line">    QDate dt=ui-&gt;calendarWidget-&gt;<span class="built_in">selectedDate</span>(); <span class="comment">//读取选择的日期时间</span></span><br><span class="line">    QString str=dt.<span class="built_in">toString</span>(<span class="string">&quot;yyyy年M月d日&quot;</span>);<span class="comment">//转换为字符串</span></span><br><span class="line">    ui-&gt;editCalendar-&gt;<span class="built_in">setText</span>(str); <span class="comment">//字符串显示日期</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三部分定时器等:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造函数实例化定时器开启 fTimer是QTimer *类型</span></span><br><span class="line">fTimer=<span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);  <span class="comment">//创建定时器</span></span><br><span class="line">fTimer-&gt;<span class="built_in">stop</span>();</span><br><span class="line">fTimer-&gt;<span class="built_in">setInterval</span>(<span class="number">1000</span>);<span class="comment">//设置定时周期,单位：毫秒</span></span><br><span class="line"><span class="built_in">connect</span>(fTimer,<span class="built_in">SIGNAL</span>(<span class="built_in">timeout</span>()),<span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">on_timer_timeout</span>())); <span class="comment">//关联定时器的信号与槽</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//关联的槽函数如下:</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_timer_timeout</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//定时器中断响应槽函数</span></span><br><span class="line">    QTime curTime=QTime::<span class="built_in">currentTime</span>(); <span class="comment">//获取当前时间</span></span><br><span class="line">    ui-&gt;LCDHour-&gt;<span class="built_in">display</span>(curTime.<span class="built_in">hour</span>()); <span class="comment">//显示  小时</span></span><br><span class="line">    ui-&gt;LCDMin-&gt;<span class="built_in">display</span>(curTime.<span class="built_in">minute</span>());<span class="comment">//显示  分钟</span></span><br><span class="line">    ui-&gt;LCDSec-&gt;<span class="built_in">display</span>(curTime.<span class="built_in">second</span>());<span class="comment">//显示  秒</span></span><br><span class="line">    <span class="type">int</span> va=ui-&gt;progressBar-&gt;<span class="built_in">value</span>(); <span class="comment">//读取progressBar的数值</span></span><br><span class="line">    va++;</span><br><span class="line">    <span class="keyword">if</span> (va&gt;<span class="number">100</span>)</span><br><span class="line">        va=<span class="number">0</span>;</span><br><span class="line">    ui-&gt;progressBar-&gt;<span class="built_in">setValue</span>(va); <span class="comment">//设置progressBar的数值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定时器每次触发的时候同时对进度控件progressBar进行增加，我们这这里设置的是一秒。每次也会控制三个LCD显示更新后的时间。</p>
<p>设置定时器的周期:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnSetIntv_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//设置定时器周期</span></span><br><span class="line">    fTimer-&gt;<span class="built_in">setInterval</span>(ui-&gt;spinBoxIntv-&gt;<span class="built_in">value</span>()); <span class="comment">//设置定时器的周期</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用QTimer的<strong>setInterval</strong>方法设置定时器周期，设置为从QspinBox控件上获取值。</p>
<p><strong>定时器的开启和停止按钮</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnStart_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fTimer-&gt;<span class="built_in">start</span>();<span class="comment">//定时器开始工作</span></span><br><span class="line">    fTimeCounter=QDateTime::<span class="built_in">currentDateTime</span>();<span class="comment">//计时器开始工作</span></span><br><span class="line"><span class="comment">//更新各按键的状态</span></span><br><span class="line">    ui-&gt;btnStart-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;btnStop-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;btnSetIntv-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnStop_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fTimer-&gt;<span class="built_in">stop</span>(); <span class="comment">//定时器停止</span></span><br><span class="line">    QDateTime end=QDateTime::<span class="built_in">currentDateTime</span>();</span><br><span class="line">    <span class="type">int</span> tmMsec=fTimeCounter.<span class="built_in">msecsTo</span>(end);</span><br><span class="line">    <span class="type">int</span> ms=tmMsec%<span class="number">1000</span>; <span class="comment">//余数毫秒</span></span><br><span class="line">    <span class="type">int</span> sec=tmMsec/<span class="number">1000</span>; <span class="comment">//整秒</span></span><br><span class="line">    QString str=QString::<span class="built_in">asprintf</span>(<span class="string">&quot;流逝时间：%d 秒，%d 毫秒&quot;</span>,sec,ms);</span><br><span class="line">    ui-&gt;LabElapsTime-&gt;<span class="built_in">setText</span>(str); <span class="comment">//显示流逝的时间</span></span><br><span class="line">    ui-&gt;btnStart-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>); <span class="comment">//更新按键状态</span></span><br><span class="line">    ui-&gt;btnStop-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;btnSetIntv-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击开始按钮之后把自己和设置周期两个按钮设置为不可使用状态setEnabled(false);方法。其他也没啥好说的。设置流逝的时间。</p>
<h3 id="最后强调，计时器因为QTime的start方法被删除"><a href="#最后强调，计时器因为QTime的start方法被删除" class="headerlink" title="最后强调，计时器因为QTime的start方法被删除"></a>最后强调，计时器因为QTime的start方法被删除</h3><p>我们使用QDateTime类先使用QDateTime::currentDateTime();获取当前日期时间，然后再QDateTime end&#x3D;QDateTime::currentDateTime();获取结束的时间，然后int tmMsec&#x3D;fTimeCounter.msecsTo(end);即可获得两个时间之间有多少毫秒</p>
<hr>
<h2 id="QComBox和QPainTextEdot"><a href="#QComBox和QPainTextEdot" class="headerlink" title="QComBox和QPainTextEdot"></a>QComBox和QPainTextEdot</h2><h3 id="QComBox"><a href="#QComBox" class="headerlink" title="QComBox"></a>QComBox</h3><p>Qt5.9C++开发指南91面详细介绍了它，我们举个简单的例子:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先使用QMap赋值然后foreach遍历放入QComBox控件中</span></span><br><span class="line">    QComboBox*c=<span class="keyword">new</span> QComboBox;</span><br><span class="line">    QMap&lt;QString,<span class="type">int</span>&gt;Zone;</span><br><span class="line">    Zone.<span class="built_in">insert</span>(<span class="string">&quot;北京&quot;</span>,<span class="number">10</span>);</span><br><span class="line">    Zone.<span class="built_in">insert</span>(<span class="string">&quot;上海&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    Zone.<span class="built_in">insert</span>(<span class="string">&quot;天津&quot;</span>,<span class="number">30</span>);</span><br><span class="line">    foreach(QString str,Zone.<span class="built_in">keys</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;comboBox-&gt;<span class="built_in">addItem</span>(str,Zone.<span class="built_in">value</span>(str));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//当选项改变的时候触发此信号，获取当前QComboBox的值，设置给QPainTextEdit</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_comboBox_currentIndexChanged</span><span class="params">(<span class="type">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;lineEdit-&gt;<span class="built_in">setText</span>(ui-&gt;comboBox-&gt;<span class="built_in">itemText</span>(index));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="QPainTextEdot"><a href="#QPainTextEdot" class="headerlink" title="QPainTextEdot"></a>QPainTextEdot</h3><p>QPlainTextEdit 可以理解为 QTextEdit的低配版。QPlainTextEdit支持纯文本显示，QTextEdit支持富文本显示。就是多一个样式。<br>QPlainTextEdit显示的效率比QTextEdit高，如果需要显示大量文字，尤其是需要滚动条来回滚动的时候，QPlainTextEdit要好很多。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ui-&gt;textEdit-&gt;<span class="built_in">setContextMenuPolicy</span>(Qt::CustomContextMenu);<span class="comment">//设置QTextEdit控件</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="QMdiArea类"><a href="#QMdiArea类" class="headerlink" title="QMdiArea类"></a>QMdiArea类</h2><p><img src="C:\Users\AMD\Desktop\Qt\图片\Snipaste_2022-06-21_16-26-38.png"></p>
<p>像这种多个窗口嵌入一个子窗口的需要用到QMdiArea，也很简单</p>
<p><img src="C:\Users\AMD\Desktop\Qt\图片\Snipaste_2022-06-21_16-31-49.png"></p>
<p>在设计师模式放入一个MdiArea控件，和一个工具栏的动作，用于创建</p>
<p>在mainWindow的构造函数写如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">setCentralWidget</span>(ui-&gt;mdiArea);<span class="comment">//填满工作区</span></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">setWindowState</span>(Qt::WindowMaximized);<span class="comment">//设置默认显示为屏幕大小</span></span><br></pre></td></tr></table></figure>

<p>给按钮添加一个槽处理</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_action_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Test*test=<span class="keyword">new</span> <span class="built_in">Test</span>(<span class="keyword">this</span>);</span><br><span class="line">    test-&gt;<span class="built_in">setWindowFlags</span>(Qt::CustomizeWindowHint |</span><br><span class="line">                         Qt::WindowMinimizeButtonHint |</span><br><span class="line">                         Qt::WindowMaximizeButtonHint);<span class="comment">//去掉子窗口的默认按钮等控件</span></span><br><span class="line">    ui-&gt;mdiArea-&gt;<span class="built_in">setViewMode</span>(QMdiArea::TabbedView);<span class="comment">//多页显示模式</span></span><br><span class="line">    ui-&gt;mdiArea-&gt;<span class="built_in">addSubWindow</span>(test);</span><br><span class="line">    ui-&gt;mdiArea-&gt;<span class="built_in">setTabsClosable</span>(<span class="literal">true</span>);<span class="comment">//设置页面可以关闭</span></span><br><span class="line">    test-&gt;<span class="built_in">show</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的Test是一个设计师界面类，用来显示在我们主窗口的，做子窗</p>
<hr>
<h2 id="QTabeView"><a href="#QTabeView" class="headerlink" title="QTabeView"></a>QTabeView</h2><p>用于显示表格状数据，适用于二维表格型数据操作</p>
<p>一般设计师模式放一个这个控件，还需要一个数据模型一个选择模型</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QStandardItemModel  *theModel;<span class="comment">//数据模型</span></span><br><span class="line">QItemSelectionModel *theSelection;<span class="comment">//Item选择模型</span></span><br></pre></td></tr></table></figure>

<p>数据模型可以用来设置行列之类的，QTableView对象调用**setModel()**方法传入数据模型即可设置</p>
<p>差不多像下面这样在构造函数给这些东西初始化</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">theModel = <span class="keyword">new</span> <span class="built_in">QStandardItemModel</span>(<span class="number">5</span>,FixedColumnCount,<span class="keyword">this</span>); <span class="comment">//创建数据模型</span></span><br><span class="line">    QStringList     headerList;</span><br><span class="line">    headerList&lt;&lt;<span class="string">&quot;Depth&quot;</span>&lt;&lt;<span class="string">&quot;Measured Depth&quot;</span>&lt;&lt;<span class="string">&quot;Direction&quot;</span>&lt;&lt;<span class="string">&quot;Offset&quot;</span>&lt;&lt;<span class="string">&quot;Quality&quot;</span>&lt;&lt;<span class="string">&quot;Sampled&quot;</span>;</span><br><span class="line">    theModel-&gt;<span class="built_in">setHorizontalHeaderLabels</span>(headerList); <span class="comment">//设置表头文字</span></span><br><span class="line">    theSelection = <span class="keyword">new</span> <span class="built_in">QItemSelectionModel</span>(theModel);<span class="comment">//Item选择模型</span></span><br><span class="line">    <span class="built_in">connect</span>(theSelection,<span class="built_in">SIGNAL</span>(<span class="built_in">currentChanged</span>(QModelIndex,QModelIndex)),</span><br><span class="line">            <span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">on_currentChanged</span>(QModelIndex,QModelIndex)));</span><br><span class="line">    <span class="comment">//为tableView设置数据模型</span></span><br><span class="line">    ui-&gt;tableView-&gt;<span class="built_in">setModel</span>(theModel); <span class="comment">//设置数据模型</span></span><br><span class="line">    ui-&gt;tableView-&gt;<span class="built_in">setSelectionModel</span>(theSelection);<span class="comment">//设置选择模型</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三角函数"><a href="#三角函数" class="headerlink" title="三角函数"></a>三角函数</h2><ol>
<li><p>正弦sin，余弦cos，正切tan</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-25_14-24-02.png"></p>
</li>
</ol>
<p>sin x&#x3D;对边&#x2F;斜边   sin30度&#x3D;a&#x2F;2a，a是对边，2a是斜边，所以sin30度&#x3D;1&#x2F;2</p>
<p>cos x&#x3D;邻边&#x2F;斜边 cos30度&#x3D;√3 a&#x2F;2a&#x3D;√3&#x2F;2</p>
<p>tan x&#x3D;对边&#x2F;邻边 tan30度&#x3D;a&#x2F;√3 a&#x3D;√3&#x2F;3</p>
<p>三十度所对的直角边等于斜边的一半</p>
<p>勾股定理:三角形，a的二次方+b的的二次方&#x3D;c的二次方，c为斜边。如果知道斜边可以反推为a的边长等于c的二次方减b的二次方然后开根号</p>
<p>这里的sin cos tan都是代表的角的一个值，而不是三角形具体的某一个角，比如一个三角形可以有sin45，sin90，对边比斜边是角的对边和斜边，而不是固定的两条边</p>
<hr>
<h2 id="Qt-Http"><a href="#Qt-Http" class="headerlink" title="Qt Http"></a>Qt Http</h2><p>QT中提供了http网络接口，由<code>QNetworkAccessManager</code>，<code>QNetworkRequest</code>，<code>QNetworkReply</code>三部分组成。</p>
<p><strong>QNetworkRequest</strong>用于组件请求，包括请求头，请求内容。<strong>QNetworkAccessManager</strong>用于发出请求，常用的有get，post两个接口，参数就是QNetworkRequest，返回结果由<strong>QNetworkReply</strong>*。</p>
<p>这里要注意的是QNetworkAccessManager刚得到的QNetworkReply*还不能使用，因为请求未必收到了服务端的应答，<strong>所以要绑定QNetworkReply的信号finished来判断服务是否返回</strong>，这个信号返回之后我们再对QNetworkReply进行处理，比如查看是否有网络错误，http返回的code和获取返回内容。</p>
<p>注意加上</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QT += network</span><br></pre></td></tr></table></figure>

<p>学的不多，先跳过</p>
<hr>
<h2 id="QGraphicsView绘图架构"><a href="#QGraphicsView绘图架构" class="headerlink" title="QGraphicsView绘图架构"></a>QGraphicsView绘图架构</h2><p>完成好的如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-06-28_16-35-49.png"></p>
<p>可以任意移动这两个东西，同时在左下角显示坐标</p>
<p>首先我们创建了一个类，它继承自<strong>QGraphicsView</strong>，</p>
<p>qwgraphicsview.h删减版</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">QWGraphicsView</span> : <span class="keyword">public</span> QGraphicsView</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseMoveEvent</span><span class="params">(QMouseEvent *event)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent *event)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">QWGraphicsView</span>(QWidget *parent = <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseMovePoint</span><span class="params">(QPoint point)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseClicked</span><span class="params">(QPoint point)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我们可以看到继承了<strong>QGraphicsView</strong>重写了两个事件，信号声明了一下，这两个事件是移动和点击</p>
<p>qwgraphicsview.cpp删减版</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qwgraphicsview.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span>    <span class="string">&lt;QMouseEvent&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span>    <span class="string">&lt;QPoint&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QWGraphicsView::mouseMoveEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//鼠标移动事件</span></span><br><span class="line">    QPoint point=event-&gt;<span class="built_in">pos</span>(); <span class="comment">//QGraphicsView的坐标</span></span><br><span class="line">    <span class="function">emit <span class="title">mouseMovePoint</span><span class="params">(point)</span></span>; <span class="comment">//释放信号</span></span><br><span class="line">    QGraphicsView::<span class="built_in">mouseMoveEvent</span>(event);<span class="comment">//调用原来类封装好的虚函数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QWGraphicsView::mousePressEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//鼠标左键按下事件</span></span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">button</span>()==Qt::LeftButton)</span><br><span class="line">    &#123;</span><br><span class="line">        QPoint point=event-&gt;<span class="built_in">pos</span>(); <span class="comment">//QGraphicsView的坐标</span></span><br><span class="line">        <span class="function">emit <span class="title">mouseClicked</span><span class="params">(point)</span></span>;<span class="comment">//释放信号</span></span><br><span class="line">    &#125;</span><br><span class="line">    QGraphicsView::<span class="built_in">mousePressEvent</span>(event);<span class="comment">//调用原来类封装好的虚函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看mainwindow</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAINWINDOW_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span>    <span class="string">&lt;QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span>    <span class="string">&lt;QGraphicsScene&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span>    <span class="string">&lt;QLabel&gt;</span></span></span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QGraphicsScene  *scene;</span><br><span class="line">    QLabel  *labViewCord;</span><br><span class="line">    QLabel  *labSceneCord;</span><br><span class="line">    QLabel  *labItemCord;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">iniGraphicsSystem</span><span class="params">()</span></span>; <span class="comment">//创建Graphics View的各项</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">resizeEvent</span><span class="params">(QResizeEvent *event)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MainWindow</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span>    <span class="title">on_mouseMovePoint</span><span class="params">(QPoint point)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span>    <span class="title">on_mouseClicked</span><span class="params">(QPoint point)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// MAINWINDOW_H</span></span></span><br></pre></td></tr></table></figure>



<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//h</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">iniGraphicsSystem</span><span class="params">()</span></span>; <span class="comment">//创建Graphics View的各项</span></span><br><span class="line"><span class="comment">//cpp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::iniGraphicsSystem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//构造Graphics View的各项</span></span><br><span class="line">    <span class="function">QRectF   <span class="title">rect</span><span class="params">(<span class="number">-200</span>,<span class="number">-100</span>,<span class="number">400</span>,<span class="number">200</span>)</span></span>;</span><br><span class="line">    scene=<span class="keyword">new</span> <span class="built_in">QGraphicsScene</span>(rect); <span class="comment">//scene逻辑坐标系定义</span></span><br><span class="line">    ui-&gt;View-&gt;<span class="built_in">setScene</span>(scene);</span><br><span class="line"><span class="comment">//画一个矩形框，大小等于scene</span></span><br><span class="line">    QGraphicsRectItem   *item=<span class="keyword">new</span> <span class="built_in">QGraphicsRectItem</span>(rect); <span class="comment">//矩形框正好等于scene的大小</span></span><br><span class="line">    item-&gt;<span class="built_in">setFlags</span>(QGraphicsItem::ItemIsSelectable     <span class="comment">//可选，可以有焦点，但是不能移动</span></span><br><span class="line">                   | QGraphicsItem::ItemIsFocusable);</span><br><span class="line">    QPen pen;</span><br><span class="line">    pen.<span class="built_in">setWidth</span>(<span class="number">2</span>);</span><br><span class="line">    item-&gt;<span class="built_in">setPen</span>(pen);</span><br><span class="line"><span class="comment">//    item-&gt;setPos(500,0);//缺省位置在scene的（0,0）</span></span><br><span class="line">    scene-&gt;<span class="built_in">addItem</span>(item);</span><br><span class="line"><span class="comment">//一个位于scene中心的椭圆，测试局部坐标</span></span><br><span class="line">    QGraphicsEllipseItem   *item2=<span class="keyword">new</span> <span class="built_in">QGraphicsEllipseItem</span>(<span class="number">-100</span>,<span class="number">-50</span>,<span class="number">200</span>,<span class="number">100</span>); <span class="comment">//矩形框内创建椭圆,绘图项的局部坐标，左上角(-100,-50)，宽200，高100</span></span><br><span class="line">    item2-&gt;<span class="built_in">setPos</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    item2-&gt;<span class="built_in">setBrush</span>(<span class="built_in">QBrush</span>(Qt::blue));</span><br><span class="line">    item2-&gt;<span class="built_in">setFlags</span>(QGraphicsItem::ItemIsMovable</span><br><span class="line">                   | QGraphicsItem::ItemIsSelectable</span><br><span class="line">                   | QGraphicsItem::ItemIsFocusable);</span><br><span class="line">    scene-&gt;<span class="built_in">addItem</span>(item2);</span><br><span class="line"><span class="comment">//一个圆，中心位于scene的边缘</span></span><br><span class="line">    QGraphicsEllipseItem   *item3=<span class="keyword">new</span> <span class="built_in">QGraphicsEllipseItem</span>(<span class="number">-50</span>,<span class="number">-50</span>,<span class="number">100</span>,<span class="number">100</span>); <span class="comment">//矩形框内创建椭圆,绘图项的局部坐标，左上角(-100,-50)，宽200，高100</span></span><br><span class="line">    item3-&gt;<span class="built_in">setPos</span>(rect.<span class="built_in">right</span>(),rect.<span class="built_in">bottom</span>());</span><br><span class="line">    item3-&gt;<span class="built_in">setBrush</span>(<span class="built_in">QBrush</span>(Qt::red));</span><br><span class="line">    item3-&gt;<span class="built_in">setFlags</span>(QGraphicsItem::ItemIsMovable</span><br><span class="line">                   | QGraphicsItem::ItemIsSelectable</span><br><span class="line">                   | QGraphicsItem::ItemIsFocusable);</span><br><span class="line">    scene-&gt;<span class="built_in">addItem</span>(item3);</span><br><span class="line">    scene-&gt;<span class="built_in">clearSelection</span>();</span><br><span class="line"><span class="comment">//    item-&gt;setSelected(true);</span></span><br><span class="line"><span class="comment">//    ui-&gt;View-&gt;setDragMode(QGraphicsView::RubberBandDrag);</span></span><br><span class="line">&#125;<span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_mainwindow.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span>    <span class="string">&lt;QGraphicsEllipseItem&gt;</span></span></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::iniGraphicsSystem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//构造Graphics View的各项</span></span><br><span class="line">    <span class="function">QRectF   <span class="title">rect</span><span class="params">(<span class="number">-200</span>,<span class="number">-100</span>,<span class="number">400</span>,<span class="number">200</span>)</span></span>;</span><br><span class="line">    scene=<span class="keyword">new</span> <span class="built_in">QGraphicsScene</span>(rect); <span class="comment">//scene逻辑坐标系定义</span></span><br><span class="line">    ui-&gt;View-&gt;<span class="built_in">setScene</span>(scene);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//画一个矩形框，大小等于scene</span></span><br><span class="line">    QGraphicsRectItem   *item=<span class="keyword">new</span> <span class="built_in">QGraphicsRectItem</span>(rect); <span class="comment">//矩形框正好等于scene的大小</span></span><br><span class="line">    item-&gt;<span class="built_in">setFlags</span>(QGraphicsItem::ItemIsSelectable     <span class="comment">//可选，可以有焦点，但是不能移动</span></span><br><span class="line">                   | QGraphicsItem::ItemIsFocusable);</span><br><span class="line">    QPen    pen;</span><br><span class="line">    pen.<span class="built_in">setWidth</span>(<span class="number">2</span>);</span><br><span class="line">    item-&gt;<span class="built_in">setPen</span>(pen);</span><br><span class="line"><span class="comment">//    item-&gt;setPos(500,0);//缺省位置在scene的（0,0）</span></span><br><span class="line">    scene-&gt;<span class="built_in">addItem</span>(item);</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个位于scene中心的椭圆，测试局部坐标</span></span><br><span class="line">    QGraphicsEllipseItem   *item2=<span class="keyword">new</span> <span class="built_in">QGraphicsEllipseItem</span>(<span class="number">-100</span>,<span class="number">-50</span>,<span class="number">200</span>,<span class="number">100</span>); <span class="comment">//矩形框内创建椭圆,绘图项的局部坐标，左上角(-100,-50)，宽200，高100</span></span><br><span class="line">    item2-&gt;<span class="built_in">setPos</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    item2-&gt;<span class="built_in">setBrush</span>(<span class="built_in">QBrush</span>(Qt::blue));</span><br><span class="line">    item2-&gt;<span class="built_in">setFlags</span>(QGraphicsItem::ItemIsMovable</span><br><span class="line">                   | QGraphicsItem::ItemIsSelectable</span><br><span class="line">                   | QGraphicsItem::ItemIsFocusable);</span><br><span class="line">    scene-&gt;<span class="built_in">addItem</span>(item2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个圆，中心位于scene的边缘</span></span><br><span class="line">    QGraphicsEllipseItem   *item3=<span class="keyword">new</span> <span class="built_in">QGraphicsEllipseItem</span>(<span class="number">-50</span>,<span class="number">-50</span>,<span class="number">100</span>,<span class="number">100</span>); <span class="comment">//矩形框内创建椭圆,绘图项的局部坐标，左上角(-100,-50)，宽200，高100</span></span><br><span class="line">    item3-&gt;<span class="built_in">setPos</span>(rect.<span class="built_in">right</span>(),rect.<span class="built_in">bottom</span>());</span><br><span class="line">    item3-&gt;<span class="built_in">setBrush</span>(<span class="built_in">QBrush</span>(Qt::red));</span><br><span class="line">    item3-&gt;<span class="built_in">setFlags</span>(QGraphicsItem::ItemIsMovable</span><br><span class="line">                   | QGraphicsItem::ItemIsSelectable</span><br><span class="line">                   | QGraphicsItem::ItemIsFocusable);</span><br><span class="line">    scene-&gt;<span class="built_in">addItem</span>(item3);</span><br><span class="line"></span><br><span class="line">    scene-&gt;<span class="built_in">clearSelection</span>();</span><br><span class="line"><span class="comment">//    item-&gt;setSelected(true);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    ui-&gt;View-&gt;setDragMode(QGraphicsView::RubberBandDrag);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::resizeEvent</span><span class="params">(QResizeEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">//窗口变化大小时的事件</span></span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(event);</span><br><span class="line"><span class="comment">//Graphics View坐标，左上角总是（0,0），宽度=，长度=</span></span><br><span class="line">    ui-&gt;labViewSize-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">asprintf</span>(<span class="string">&quot;Graphics View坐标，左上角总是（0,0），宽度=%d，高度=%d&quot;</span>,</span><br><span class="line">                ui-&gt;View-&gt;<span class="built_in">width</span>(),ui-&gt;View-&gt;<span class="built_in">height</span>()));</span><br><span class="line"></span><br><span class="line">    QRectF  rectF=ui-&gt;View-&gt;<span class="built_in">sceneRect</span>(); <span class="comment">//Scene的矩形区</span></span><br><span class="line">    ui-&gt;LabSceneRect-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">asprintf</span>(<span class="string">&quot;QGraphicsView::sceneRect=(Left,Top,Width,Height)=%.0f,%.0f,%.0f,%.0f&quot;</span>,</span><br><span class="line">                                                rectF.<span class="built_in">left</span>(),rectF.<span class="built_in">top</span>(),rectF.<span class="built_in">width</span>(),rectF.<span class="built_in">height</span>()));</span><br><span class="line">&#125;</span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent) :</span><br><span class="line">    <span class="built_in">QMainWindow</span>(parent),</span><br><span class="line">    <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    labViewCord=<span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="string">&quot;View 坐标：&quot;</span>);</span><br><span class="line">    labViewCord-&gt;<span class="built_in">setMinimumWidth</span>(<span class="number">150</span>);</span><br><span class="line">    ui-&gt;statusBar-&gt;<span class="built_in">addWidget</span>(labViewCord);</span><br><span class="line"></span><br><span class="line">    labSceneCord=<span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="string">&quot;Scene 坐标：&quot;</span>);</span><br><span class="line">    labSceneCord-&gt;<span class="built_in">setMinimumWidth</span>(<span class="number">150</span>);</span><br><span class="line">    ui-&gt;statusBar-&gt;<span class="built_in">addWidget</span>(labSceneCord);</span><br><span class="line"></span><br><span class="line">    labItemCord=<span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="string">&quot;Item 坐标：&quot;</span>);</span><br><span class="line">    labItemCord-&gt;<span class="built_in">setMinimumWidth</span>(<span class="number">150</span>);</span><br><span class="line">    ui-&gt;statusBar-&gt;<span class="built_in">addWidget</span>(labItemCord);</span><br><span class="line"></span><br><span class="line">    ui-&gt;View-&gt;<span class="built_in">setCursor</span>(Qt::CrossCursor);</span><br><span class="line">    ui-&gt;View-&gt;<span class="built_in">setMouseTracking</span>(<span class="literal">true</span>);</span><br><span class="line">    ui-&gt;View-&gt;<span class="built_in">setDragMode</span>(QGraphicsView::RubberBandDrag);</span><br><span class="line"></span><br><span class="line">    QObject::<span class="built_in">connect</span>(ui-&gt;View,<span class="built_in">SIGNAL</span>(<span class="built_in">mouseMovePoint</span>(QPoint)),</span><br><span class="line">                     <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">on_mouseMovePoint</span>(QPoint)));</span><br><span class="line"></span><br><span class="line">    QObject::<span class="built_in">connect</span>(ui-&gt;View,<span class="built_in">SIGNAL</span>(<span class="built_in">mouseClicked</span>(QPoint)),</span><br><span class="line">                     <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">on_mouseClicked</span>(QPoint)));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">iniGraphicsSystem</span>();</span><br><span class="line">&#125;</span><br><span class="line">MainWindow::~<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_mouseMovePoint</span><span class="params">(QPoint point)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//鼠标移动事件，point是 GraphicsView的坐标,物理坐标</span></span><br><span class="line">    labViewCord-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">asprintf</span>(<span class="string">&quot;View 坐标：%d,%d&quot;</span>,point.<span class="built_in">x</span>(),point.<span class="built_in">y</span>()));</span><br><span class="line">    QPointF pointScene=ui-&gt;View-&gt;<span class="built_in">mapToScene</span>(point); <span class="comment">//转换到Scene坐标</span></span><br><span class="line">    labSceneCord-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">asprintf</span>(<span class="string">&quot;Scene 坐标：%.0f,%.0f&quot;</span>, pointScene.<span class="built_in">x</span>(),pointScene.<span class="built_in">y</span>()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_mouseClicked</span><span class="params">(QPoint point)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//鼠标单击事件</span></span><br><span class="line">    QPointF pointScene=ui-&gt;View-&gt;<span class="built_in">mapToScene</span>(point); <span class="comment">//转换到Scene坐标</span></span><br><span class="line">    QGraphicsItem  *item=<span class="literal">NULL</span>;</span><br><span class="line">    item=scene-&gt;<span class="built_in">itemAt</span>(pointScene,ui-&gt;View-&gt;<span class="built_in">transform</span>()); <span class="comment">//获取光标下的绘图项</span></span><br><span class="line">    <span class="keyword">if</span> (item != <span class="literal">NULL</span>) <span class="comment">//有绘图项</span></span><br><span class="line">    &#123;</span><br><span class="line">        QPointF pointItem=item-&gt;<span class="built_in">mapFromScene</span>(pointScene); <span class="comment">//转换为绘图项的局部坐标</span></span><br><span class="line">        labItemCord-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">asprintf</span>(<span class="string">&quot;Item 坐标：%.0f,%.0f&quot;</span>, pointItem.<span class="built_in">x</span>(),pointItem.<span class="built_in">y</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Qt连接mysql查询"><a href="#Qt连接mysql查询" class="headerlink" title="Qt连接mysql查询"></a>Qt连接mysql查询</h2><p>如何编译和配置环境就不说了，记得在pro文件加上</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QT	+=SQL</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">QStringList drivers = QSqlDatabase::<span class="built_in">drivers</span>();</span><br><span class="line">foreach(QString driver, drivers)</span><br><span class="line">     <span class="built_in">qDebug</span>()&lt;&lt;driver;	<span class="comment">//遍历打印可用的数据库类型</span></span><br><span class="line"></span><br><span class="line"> QSqlDatabase db=QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;QMYSQL&quot;</span>);</span><br><span class="line"> <span class="comment">//设置连接信息</span></span><br><span class="line"> db.<span class="built_in">setHostName</span>(<span class="string">&quot;localhost&quot;</span>);<span class="comment">//ip如果是本地可以不写，或者写主机名,比如localhost</span></span><br><span class="line"> db.<span class="built_in">setUserName</span>(<span class="string">&quot;root&quot;</span>);<span class="comment">//用户名</span></span><br><span class="line"> db.<span class="built_in">setPassword</span>(<span class="string">&quot;123456&quot;</span>);<span class="comment">//密码</span></span><br><span class="line"> db.<span class="built_in">setDatabaseName</span>(<span class="string">&quot;itcast&quot;</span>);<span class="comment">//数据库名</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>(db.<span class="built_in">open</span>()==<span class="literal">false</span>)&#123;</span><br><span class="line">     QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>,<span class="string">&quot;错误&quot;</span>,db.<span class="built_in">lastError</span>().<span class="built_in">text</span>());<span class="comment">//lastError返回的是一个QSqlError对象，调用text方法转换，即显示报错信息</span></span><br><span class="line"> &#125;</span><br><span class="line"> QString sql=<span class="string">&quot;select * from emp2&quot;</span>;</span><br><span class="line"> QSqlQuery query;<span class="comment">//创建执行SQl的对象</span></span><br><span class="line"> query.<span class="built_in">exec</span>(sql);<span class="comment">//sql语句</span></span><br><span class="line"> QStringList Text;</span><br><span class="line">     <span class="keyword">while</span>(query.<span class="built_in">next</span>())<span class="comment">//next方法如果遍历到最后一条信息则为false退出循环</span></span><br><span class="line">     &#123;</span><br><span class="line">         QString text;</span><br><span class="line">         text+=query.<span class="built_in">value</span>(<span class="string">&quot;id&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">         text+=<span class="string">&quot;\t&quot;</span>+query.<span class="built_in">value</span>(<span class="string">&quot;name&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">         text+=<span class="string">&quot;\t&quot;</span>+query.<span class="built_in">value</span>(<span class="string">&quot;age&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">         text+=<span class="string">&quot;\t&quot;</span>+query.<span class="built_in">value</span>(<span class="string">&quot;job&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">         text+=<span class="string">&quot;\t&quot;</span>+query.<span class="built_in">value</span>(<span class="string">&quot;salary&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">         text+=<span class="string">&quot;\t&quot;</span>+query.<span class="built_in">value</span>(<span class="string">&quot;entrydate&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">         text+=<span class="string">&quot;\t&quot;</span>+query.<span class="built_in">value</span>(<span class="string">&quot;managerid&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">         text+=<span class="string">&quot;\t&quot;</span>+query.<span class="built_in">value</span>(<span class="string">&quot;dept_id&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">         Text.<span class="built_in">append</span>(text+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span>(<span class="keyword">auto</span> i:Text)</span><br><span class="line">     ui-&gt;textEdit-&gt;<span class="built_in">append</span>(i);<span class="comment">//循环遍历显示出来</span></span><br><span class="line"> db.<span class="built_in">close</span>();<span class="comment">//关闭数据库</span></span><br></pre></td></tr></table></figure>

<p>value方法要输入的是字段名,我们为了方便字段名后面全部转为了String，其实也可以转成int之类的。</p>
<h2 id="Qt中数据库的事务操作"><a href="#Qt中数据库的事务操作" class="headerlink" title="Qt中数据库的事务操作"></a>Qt中数据库的事务操作</h2><p>和普通的mysql操作一样，我们使用事务主要用于写操作的时候才会使用，查询的时候没有必要</p>
<ol>
<li><p>创建事务</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QSqlDatabase::transaction</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>


</li>
<li><p>提交事务</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QSqkDatabase::commit</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>


</li>
<li><p>回滚事务</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QSqkDatabase::rollback</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>例子如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">QSqlQuery query;</span><br><span class="line">QString sql=<span class="string">&quot;update emp2 set age=100 where name=&#x27;灭绝&#x27;&quot;</span>;</span><br><span class="line">db.<span class="built_in">transaction</span>();<span class="comment">//开启事务</span></span><br><span class="line"><span class="type">bool</span> flag=query.<span class="built_in">exec</span>(sql);</span><br><span class="line"><span class="keyword">if</span>(flag)&#123;</span><br><span class="line">    db.<span class="built_in">commit</span>();<span class="comment">//提交事务</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    db.<span class="built_in">rollback</span>();<span class="comment">//回滚事务</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="重写QChartView控件"><a href="#重写QChartView控件" class="headerlink" title="重写QChartView控件"></a>重写QChartView控件</h2><p>主要是为了重写事件，然后我们的设计师模式下的控件也需要提升，QGraphicsView控件提升为我们重写过后的类</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">QWChartView</span> : <span class="keyword">public</span> QChartView</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QPoint  beginPoint; <span class="comment">//选择矩形区的起点</span></span><br><span class="line">    QPoint  endPoint;  <span class="comment">//选择矩形区的终点</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent *event)</span></span>; <span class="comment">//鼠标左键按下</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseMoveEvent</span><span class="params">(QMouseEvent *event)</span></span>; <span class="comment">//鼠标移动</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseReleaseEvent</span><span class="params">(QMouseEvent *event)</span></span>; <span class="comment">//鼠标释放左键</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">keyPressEvent</span><span class="params">(QKeyEvent *event)</span></span>; <span class="comment">//按键事件</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">QWChartView</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~<span class="built_in">QWChartView</span>();</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseMovePoint</span><span class="params">(QPoint point)</span></span>; <span class="comment">//鼠标移动信号，在mouseMoveEvent()事件中触发</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这是头文件，项目具体代码看samp9_4。</p>
<p>我们提一下这几个事件如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QWChartView::mousePressEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//鼠标左键按下，记录beginPoint</span></span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">button</span>()==Qt::LeftButton)</span><br><span class="line">        beginPoint=event-&gt;<span class="built_in">pos</span>();</span><br><span class="line">    QChartView::<span class="built_in">mousePressEvent</span>(event);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QWChartView::mouseMoveEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//鼠标移动事件</span></span><br><span class="line">    QPoint  point;</span><br><span class="line">    point=event-&gt;<span class="built_in">pos</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">emit <span class="title">mouseMovePoint</span><span class="params">(point)</span></span>;</span><br><span class="line">    QChartView::<span class="built_in">mouseMoveEvent</span>(event);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QWChartView::mouseReleaseEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">button</span>()==Qt::LeftButton)</span><br><span class="line">    &#123; <span class="comment">//鼠标左键释放，获取矩形框的endPoint,进行缩放</span></span><br><span class="line">        endPoint=event-&gt;<span class="built_in">pos</span>();</span><br><span class="line">        QRectF  rectF;</span><br><span class="line">        rectF.<span class="built_in">setTopLeft</span>(<span class="keyword">this</span>-&gt;beginPoint);</span><br><span class="line">        rectF.<span class="built_in">setBottomRight</span>(<span class="keyword">this</span>-&gt;endPoint);</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">chart</span>()-&gt;<span class="built_in">zoomIn</span>(rectF);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (event-&gt;<span class="built_in">button</span>()==Qt::RightButton)</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">chart</span>()-&gt;<span class="built_in">zoomReset</span>(); <span class="comment">//鼠标右键重置，resetZoom</span></span><br><span class="line">    QChartView::<span class="built_in">mouseReleaseEvent</span>(event);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QWChartView::keyPressEvent</span><span class="params">(QKeyEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//按键控制</span></span><br><span class="line">    <span class="keyword">switch</span> (event-&gt;<span class="built_in">key</span>()) &#123;</span><br><span class="line">    <span class="keyword">case</span> Qt::Key_Plus:  <span class="comment">//+</span></span><br><span class="line">        <span class="built_in">chart</span>()-&gt;<span class="built_in">zoom</span>(<span class="number">1.2</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Qt::Key_Minus:</span><br><span class="line">        <span class="built_in">chart</span>()-&gt;<span class="built_in">zoom</span>(<span class="number">0.8</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Qt::Key_Left:</span><br><span class="line">        <span class="built_in">chart</span>()-&gt;<span class="built_in">scroll</span>(<span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Qt::Key_Right:</span><br><span class="line">        <span class="built_in">chart</span>()-&gt;<span class="built_in">scroll</span>(<span class="number">-10</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Qt::Key_Up:</span><br><span class="line">        <span class="built_in">chart</span>()-&gt;<span class="built_in">scroll</span>(<span class="number">0</span>, <span class="number">-10</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Qt::Key_Down:</span><br><span class="line">        <span class="built_in">chart</span>()-&gt;<span class="built_in">scroll</span>(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Qt::Key_PageUp:</span><br><span class="line">        <span class="built_in">chart</span>()-&gt;<span class="built_in">scroll</span>(<span class="number">0</span>, <span class="number">50</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Qt::Key_PageDown:</span><br><span class="line">        <span class="built_in">chart</span>()-&gt;<span class="built_in">scroll</span>(<span class="number">0</span>, <span class="number">-50</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Qt::Key_Home:</span><br><span class="line">        <span class="built_in">chart</span>()-&gt;<span class="built_in">zoomReset</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        QGraphicsView::<span class="built_in">keyPressEvent</span>(event);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="给控件绘画渐变图像"><a href="#给控件绘画渐变图像" class="headerlink" title="给控件绘画渐变图像"></a>给控件绘画渐变图像</h2><p>我们这里给QPushButton也就是按钮绘画，如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QLinearGradient <span class="title">lgcolor1</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line">lgcolor1.<span class="built_in">setColorAt</span>(<span class="number">1.0</span>,Qt::black);</span><br><span class="line">lgcolor1.<span class="built_in">setColorAt</span>(<span class="number">0.67</span>,Qt::blue);</span><br><span class="line">lgcolor1.<span class="built_in">setColorAt</span>(<span class="number">0.33</span>,Qt::red);</span><br><span class="line">lgcolor1.<span class="built_in">setColorAt</span>(<span class="number">0.0</span>,Qt::yellow);</span><br><span class="line"><span class="function">QPixmap <span class="title">pm</span><span class="params">(<span class="number">160</span>,<span class="number">20</span>)</span></span>;</span><br><span class="line"><span class="function">QPainter <span class="title">painter</span><span class="params">(&amp;pm)</span></span>;</span><br><span class="line">painter.<span class="built_in">setBrush</span>(lgcolor1);</span><br><span class="line">painter.<span class="built_in">drawRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">160</span>,<span class="number">20</span>);</span><br><span class="line">ui-&gt;btnGrad1-&gt;<span class="built_in">setIcon</span>(<span class="built_in">QIcon</span>(pm));</span><br><span class="line">ui-&gt;btnGrad1-&gt;<span class="built_in">setIconSize</span>(<span class="built_in">QSize</span>(<span class="number">160</span>,<span class="number">20</span>));</span><br></pre></td></tr></table></figure>

<p>lgcolor1用来设置颜色即可，然后pm即图片对象，初始化大小即可，根据pm再创建painter绘图对象，绘图对象调用setBrush方法设置刷子也就是颜色，传入lgcolor1.然后开始绘画，前两个参数00表示从最坐上开始画。</p>
<p>然后即可把pm图片对象设置给按钮，记得调整大小。</p>
<p>同样我们也可以用类似的办法设置别的图片为当前按钮的大小</p>
<hr>
<h2 id="Sqlite使用指令"><a href="#Sqlite使用指令" class="headerlink" title="Sqlite使用指令"></a>Sqlite使用指令</h2><p>打开一个数据库文件，sqlite属于单击数据库，一个db文件就是一个数据库，如果数据库不存在就会在当前目录给我们创建</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.open xxx.db</span><br></pre></td></tr></table></figure>

<p>列举当前目录所有的数据库即db文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.databases</span><br></pre></td></tr></table></figure>

<p>列举当前数据库文件所有的表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.tables</span><br></pre></td></tr></table></figure>

<p>查询当前数据库下所有表的表结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from sqlite_master where type=&quot;table&quot;;</span><br></pre></td></tr></table></figure>

<p>插入语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO employee (EmpNo,Name,Gender,Height,Birthday,Mobile,Province,</span><br><span class="line"> City,Department,Education,Salary,Memo,Photo) </span><br><span class="line"> VALUES(:EmpNo,:Name, :Gender,:Height,:Birthday,:Mobile,:Province,</span><br><span class="line"> :City,:Department,:Education,:Salary,:Memo,:Photo)</span><br></pre></td></tr></table></figure>

<p>这里用到了类似占位的操作，先确定表，括号扩起字段，然后即可values()按道理里面直接写数据即可，但是我们写:加上字段名也就代理了</p>
<p>适用于多数数据库，DBeaver工具会显示下面这样:让我们输入值</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-05_17-13-31.png"></p>
<p>Qt有对应的处理的方式，如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actRecInsert_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//插入记录</span></span><br><span class="line">    QSqlQuery query;</span><br><span class="line">    query.<span class="built_in">exec</span>(<span class="string">&quot;select * from employee where EmpNo=-1&quot;</span>);</span><br><span class="line">    QSqlRecord curRec=query.<span class="built_in">record</span>();<span class="comment">//返回包含当前查询的字段信息的QSqlRecord</span></span><br><span class="line">    curRec.<span class="built_in">setValue</span>(<span class="string">&quot;EmpNo&quot;</span>,qryModel-&gt;<span class="built_in">rowCount</span>()+<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">    DialogData*dataDlg=<span class="keyword">new</span> DialogData;<span class="comment">//创建对话框对象</span></span><br><span class="line">    Qt::WindowFlags flags=dataDlg-&gt;<span class="built_in">windowFlags</span>();</span><br><span class="line">    dataDlg-&gt;<span class="built_in">setWindowFlags</span>(flags|Qt::MSWindowsFixedSizeDialogHint);</span><br><span class="line">    dataDlg-&gt;<span class="built_in">setInserRecord</span>(curRec);<span class="comment">//设置对话框名字和第一个属性</span></span><br><span class="line">    <span class="type">int</span> ret=dataDlg-&gt;<span class="built_in">exec</span>();<span class="comment">//模态显示</span></span><br><span class="line">    <span class="keyword">if</span>(ret==QDialog::Accepted)&#123;</span><br><span class="line">        QSqlRecord recData=dataDlg-&gt;<span class="built_in">getRecordData</span>();<span class="comment">//获取包含对话框内所有属性的QSqlRecord对象</span></span><br><span class="line">        query.<span class="built_in">prepare</span>(<span class="string">&quot;INSERT INTO employee (EmpNo,Name,Gender,Height,Birthday,Mobile,Province,&quot;</span></span><br><span class="line">                      <span class="string">&quot; City,Department,Education,Salary,Memo,Photo) &quot;</span></span><br><span class="line">                      <span class="string">&quot; VALUES(:EmpNo,:Name, :Gender,:Height,:Birthday,:Mobile,:Province,&quot;</span></span><br><span class="line">                      <span class="string">&quot; :City,:Department,:Education,:Salary,:Memo,:Photo)&quot;</span>);<span class="comment">//这是一个SQL的语法。下面是进行替换</span></span><br><span class="line">        <span class="comment">//绑定然后替换，我们执行SQL全部都是用:开头的占位符，不是实际的数据插入，我们第二个参数则进行替换，实际上我们用QString然后拼接字符串是一样的效果</span></span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:EmpNo&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;EmpNo&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Name&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Name&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Gender&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Gender&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Height&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Height&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Birthday&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Birthday&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Mobile&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Mobile&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Province&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Province&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:City&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;City&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Department&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Department&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Education&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Education&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Salary&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Salary&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Memo&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Memo&quot;</span>));</span><br><span class="line">        query.<span class="built_in">bindValue</span>(<span class="string">&quot;:Photo&quot;</span>,recData.<span class="built_in">value</span>(<span class="string">&quot;Photo&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span>(!query.<span class="built_in">exec</span>())</span><br><span class="line">            QMessageBox::<span class="built_in">critical</span>(<span class="keyword">this</span>,<span class="string">&quot;error&quot;</span>,<span class="string">&quot;information:&quot;</span>+query.<span class="built_in">lastError</span>().<span class="built_in">text</span>());</span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="comment">//重新显示插入后的数据，重新查询</span></span><br><span class="line">            qryModel-&gt;<span class="built_in">setQuery</span>(<span class="string">&quot;SELECT empNo, Name, Gender, Height, Birthday, Mobile, Province, City, Department, &quot;</span></span><br><span class="line">                               <span class="string">&quot; Education, Salary FROM employee order by empNo&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="QComboBox设置"><a href="#QComboBox设置" class="headerlink" title="QComboBox设置"></a>QComboBox设置</h2><p>在Qt6，设置QComboBox下拉控件是否可编辑使用setEditable(true);方法，传入true，默认false</p>
<h1 id="Qt的SQL模块"><a href="#Qt的SQL模块" class="headerlink" title="Qt的SQL模块"></a>Qt的SQL模块</h1><p>首先得在pro文件加上</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Qt    += sql</span><br></pre></td></tr></table></figure>



<h2 id="QsqlTableModel的使用"><a href="#QsqlTableModel的使用" class="headerlink" title="QsqlTableModel的使用"></a>QsqlTableModel的使用</h2><p>它和之前QTabeView控件的QStandardItemModel数据模型有很大的相似，它们都得用来设置QTabView控件显示数据，但我们的QsqlTableModel数据模型不再需要设置行和列，它对sql封装的非常的好。乃至于我们只需要把它放入控件，设置table，即可打开sqlite数据库文件直接显示，不需要任何设置。</p>
<p>我们简单点说先:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QSqlDatabase DB;<span class="comment">//数据库对象</span></span><br><span class="line">QSqlTableModel*tabModel;<span class="comment">//数据模型</span></span><br><span class="line">QItemSelectionModel*theSelection;<span class="comment">//选择模型</span></span><br></pre></td></tr></table></figure>

<p>起码我们需要这三个对象，然后设置打开按钮</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actOpenDB_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//加载数据库文件</span></span><br><span class="line">    QString aFile=QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;选择数据库文件&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;SQLite数据库(*.db *.db3)&quot;</span>);<span class="comment">//第三个参数是打开到的路径，省缺就会打开同级目录</span></span><br><span class="line">    <span class="keyword">if</span>(aFile.<span class="built_in">isEmpty</span>())<span class="keyword">return</span>;</span><br><span class="line">    DB=QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;QSQLITE&quot;</span>);<span class="comment">//添加驱动，不同数据库不同</span></span><br><span class="line">    DB.<span class="built_in">setDatabaseName</span>(aFile);<span class="comment">//设置数据库文件</span></span><br><span class="line">    <span class="keyword">if</span>(!DB.<span class="built_in">open</span>())&#123;</span><br><span class="line">        QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>,<span class="string">&quot;错误&quot;</span>,<span class="string">&quot;打开数据库失败&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">openTable</span>();<span class="comment">//调用函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>挺简单的，我们看函数,我们去掉很多设置，只需要看数据库和显示的操作</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::openTable</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//打开表格</span></span><br><span class="line">    tabModel=<span class="keyword">new</span> <span class="built_in">QSqlTableModel</span>(<span class="keyword">this</span>,DB);</span><br><span class="line">    tabModel-&gt;<span class="built_in">setTable</span>(<span class="string">&quot;employee&quot;</span>);<span class="comment">//数据表格</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setSort</span>(tabModel-&gt;<span class="built_in">fieldIndex</span>(<span class="string">&quot;EmpNo&quot;</span>),Qt::AscendingOrder);<span class="comment">//第一个字段</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setEditStrategy</span>(QSqlTableModel::OnManualSubmit);</span><br><span class="line">    <span class="keyword">if</span>(!tabModel-&gt;<span class="built_in">select</span>())&#123;</span><br><span class="line">        QMessageBox::<span class="built_in">critical</span>(<span class="keyword">this</span>,<span class="string">&quot;错误&quot;</span>,<span class="string">&quot;打开数据库错误,错误信息\n&quot;</span>+tabModel-&gt;<span class="built_in">lastError</span>().<span class="built_in">text</span>());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//tabModel-&gt;setHeaderData(tabModel-&gt;fieldIndex(&quot;EmpNo&quot;),Qt::Horizontal,&quot;工号&quot;);//设置第一行index为&quot;EmpNo&quot;的字段为中文的工号</span></span><br><span class="line">    theSelection=<span class="keyword">new</span> <span class="built_in">QItemSelectionModel</span>(tabModel);<span class="comment">//给选择模型实例化的同时绑定数据模型</span></span><br><span class="line">    ui-&gt;tableView-&gt;<span class="built_in">setModel</span>(tabModel);<span class="comment">//设置数据模型</span></span><br><span class="line">    ui-&gt;tableView-&gt;<span class="built_in">setSelectionModel</span>(theSelection); <span class="comment">//设置选择模型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们<strong>可以随意修改数据库表格的名字来打开不同的数据库.db或.db3文件</strong>，同时注意修改fieldIdex。我们可以看到我们没有任何显示设置。就是如此单纯。tabModel还有很多很多的方法可以调用，这个项目的代码和实现可以看书。</p>
<p>类头文件如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QSqlDatabase  DB;<span class="comment">//数据库连接</span></span><br><span class="line"></span><br><span class="line">    QSqlTableModel  *tabModel;  <span class="comment">//数据模型</span></span><br><span class="line"></span><br><span class="line">    QItemSelectionModel *theSelection; <span class="comment">//选择模型</span></span><br><span class="line"></span><br><span class="line">    QDataWidgetMapper   *dataMapper; <span class="comment">//数据映射</span></span><br><span class="line"></span><br><span class="line">    QWComboBoxDelegate   delegateSex; <span class="comment">//自定义数据代理，性别</span></span><br><span class="line">    QWComboBoxDelegate   delegateDepart; <span class="comment">//自定义数据代理，部门</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span>    <span class="title">openTable</span><span class="params">()</span></span>;<span class="comment">//打开数据表</span></span><br><span class="line">    <span class="function"><span class="type">void</span>    <span class="title">getFieldNames</span><span class="params">()</span></span>;<span class="comment">//获取字段名称,填充“排序字段”的comboBox</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MainWindow</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~<span class="built_in">MainWindow</span>();</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_currentChanged</span><span class="params">(<span class="type">const</span> QModelIndex &amp;current, <span class="type">const</span> QModelIndex &amp;previous)</span></span>;</span><br><span class="line"><span class="comment">// QTableView的SelectionModel的行发生了变化，进行处理</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_currentRowChanged</span><span class="params">(<span class="type">const</span> QModelIndex &amp;current, <span class="type">const</span> QModelIndex &amp;previous)</span></span>;</span><br><span class="line"><span class="comment">///////////////////////</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_actOpenDB_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_actRecAppend_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_actRecInsert_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_actRevert_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_actSubmit_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_actRecDelete_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_actPhoto_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_actPhotoClear_triggered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_radioBtnAscend_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_radioBtnDescend_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_radioBtnMan_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_radioBtnWoman_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_radioBtnBoth_clicked</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_comboFields_currentIndexChanged</span><span class="params">(<span class="type">int</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on_actScan_triggered</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>下面是一些方法的使用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actRecInsert_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//插入记录</span></span><br><span class="line">    QModelIndex curIndex=ui-&gt;tableView-&gt;<span class="built_in">currentIndex</span>();</span><br><span class="line"></span><br><span class="line">    tabModel-&gt;<span class="built_in">insertRow</span>(curIndex.<span class="built_in">row</span>(),<span class="built_in">QModelIndex</span>());</span><br><span class="line"></span><br><span class="line">    theSelection-&gt;<span class="built_in">clearSelection</span>();<span class="comment">//清除已有选择</span></span><br><span class="line">    theSelection-&gt;<span class="built_in">setCurrentIndex</span>(curIndex,QItemSelectionModel::Select);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actRevert_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//取消修改</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">revertAll</span>();</span><br><span class="line">    ui-&gt;actSubmit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    ui-&gt;actRevert-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actSubmit_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//保存修改</span></span><br><span class="line">    <span class="type">bool</span> res=tabModel-&gt;<span class="built_in">submitAll</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!res)</span><br><span class="line">        QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>, <span class="string">&quot;消息&quot;</span>, <span class="string">&quot;数据保存错误,错误信息\n&quot;</span>+tabModel-&gt;<span class="built_in">lastError</span>().<span class="built_in">text</span>(),</span><br><span class="line">                                 QMessageBox::Ok,QMessageBox::NoButton);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;actSubmit-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">        ui-&gt;actRevert-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actRecDelete_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//删除当前记录</span></span><br><span class="line">    QModelIndex curIndex=theSelection-&gt;<span class="built_in">currentIndex</span>();<span class="comment">//获取当前选择单元格的模型索引</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">removeRow</span>(curIndex.<span class="built_in">row</span>()); <span class="comment">//删除最后一行</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actPhoto_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//设置照片</span></span><br><span class="line">    QString aFile=QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;选择图片文件&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;照片(*.jpg)&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (aFile.<span class="built_in">isEmpty</span>())</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    QByteArray data;</span><br><span class="line">    QFile* file=<span class="keyword">new</span> <span class="built_in">QFile</span>(aFile); <span class="comment">//fileName为二进制数据文件名</span></span><br><span class="line">    file-&gt;<span class="built_in">open</span>(QIODevice::ReadOnly);</span><br><span class="line">    data = file-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">    file-&gt;<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> curRecNo=theSelection-&gt;<span class="built_in">currentIndex</span>().<span class="built_in">row</span>();</span><br><span class="line">    QSqlRecord  curRec=tabModel-&gt;<span class="built_in">record</span>(curRecNo); <span class="comment">//获取当前记录</span></span><br><span class="line">    curRec.<span class="built_in">setValue</span>(<span class="string">&quot;Photo&quot;</span>,data); <span class="comment">//设置字段数据</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setRecord</span>(curRecNo,curRec);</span><br><span class="line"></span><br><span class="line">    QPixmap pic;</span><br><span class="line">    pic.<span class="built_in">load</span>(aFile);  <span class="comment">//在界面上显示</span></span><br><span class="line">    ui-&gt;dbLabPhoto-&gt;<span class="built_in">setPixmap</span>(pic.<span class="built_in">scaledToWidth</span>(ui-&gt;dbLabPhoto-&gt;<span class="built_in">width</span>()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actPhotoClear_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> curRecNo=theSelection-&gt;<span class="built_in">currentIndex</span>().<span class="built_in">row</span>();</span><br><span class="line">    QSqlRecord  curRec=tabModel-&gt;<span class="built_in">record</span>(curRecNo); <span class="comment">//获取当前记录</span></span><br><span class="line"></span><br><span class="line">    curRec.<span class="built_in">setNull</span>(<span class="string">&quot;Photo&quot;</span>);<span class="comment">//设置为空值</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setRecord</span>(curRecNo,curRec);</span><br><span class="line"></span><br><span class="line">    ui-&gt;dbLabPhoto-&gt;<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_radioBtnAscend_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//升序</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setSort</span>(ui-&gt;comboFields-&gt;<span class="built_in">currentIndex</span>(),Qt::AscendingOrder);</span><br><span class="line">    tabModel-&gt;<span class="built_in">select</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_radioBtnDescend_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//降序</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setSort</span>(ui-&gt;comboFields-&gt;<span class="built_in">currentIndex</span>(),Qt::DescendingOrder);</span><br><span class="line">    tabModel-&gt;<span class="built_in">select</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_radioBtnMan_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    tabModel-&gt;<span class="built_in">setFilter</span>(<span class="string">&quot; Gender=&#x27;男&#x27; &quot;</span>);</span><br><span class="line"><span class="comment">//    tabModel-&gt;select();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_radioBtnWoman_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    tabModel-&gt;<span class="built_in">setFilter</span>(<span class="string">&quot; Gender=&#x27;女&#x27; &quot;</span>);</span><br><span class="line"><span class="comment">//    tabModel-&gt;select();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_radioBtnBoth_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//所有</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setFilter</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_comboFields_currentIndexChanged</span><span class="params">(<span class="type">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//选择字段进行排序</span></span><br><span class="line">    <span class="keyword">if</span> (ui-&gt;radioBtnAscend-&gt;<span class="built_in">isChecked</span>())</span><br><span class="line">        tabModel-&gt;<span class="built_in">setSort</span>(index,Qt::AscendingOrder);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        tabModel-&gt;<span class="built_in">setSort</span>(index,Qt::DescendingOrder);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actScan_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//涨工资，记录遍历</span></span><br><span class="line">    <span class="keyword">if</span> (tabModel-&gt;<span class="built_in">rowCount</span>()==<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;tabModel-&gt;<span class="built_in">rowCount</span>();i++)</span><br><span class="line">    &#123;</span><br><span class="line">        QSqlRecord aRec=tabModel-&gt;<span class="built_in">record</span>(i); <span class="comment">//获取当前记录</span></span><br><span class="line">        <span class="type">float</span> salary=aRec.<span class="built_in">value</span>(<span class="string">&quot;Salary&quot;</span>).<span class="built_in">toFloat</span>();</span><br><span class="line">        salary=salary*<span class="number">1.1</span>;</span><br><span class="line">        aRec.<span class="built_in">setValue</span>(<span class="string">&quot;Salary&quot;</span>,salary);</span><br><span class="line">        tabModel-&gt;<span class="built_in">setRecord</span>(i,aRec);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tabModel-&gt;<span class="built_in">submitAll</span>())</span><br><span class="line">        QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>, <span class="string">&quot;消息&quot;</span>, <span class="string">&quot;涨工资计算完毕&quot;</span>,</span><br><span class="line">                             QMessageBox::Ok,QMessageBox::NoButton);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>下面是切换行发出信号时执行的代码:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_currentRowChanged</span><span class="params">(<span class="type">const</span> QModelIndex &amp;current, <span class="type">const</span> QModelIndex &amp;previous)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(previous);</span><br><span class="line"><span class="comment">// 行切换时的状态控制</span></span><br><span class="line">    ui-&gt;actRecDelete-&gt;<span class="built_in">setEnabled</span>(current.<span class="built_in">isValid</span>());</span><br><span class="line">    ui-&gt;actPhoto-&gt;<span class="built_in">setEnabled</span>(current.<span class="built_in">isValid</span>());</span><br><span class="line">    ui-&gt;actPhotoClear-&gt;<span class="built_in">setEnabled</span>(current.<span class="built_in">isValid</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!current.<span class="built_in">isValid</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        ui-&gt;dbLabPhoto-&gt;<span class="built_in">clear</span>(); <span class="comment">//清除图片显示</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dataMapper-&gt;<span class="built_in">setCurrentIndex</span>(current.<span class="built_in">row</span>()); <span class="comment">//更细数据映射的行号</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> curRecNo=current.<span class="built_in">row</span>();<span class="comment">//获取行号</span></span><br><span class="line">    QSqlRecord  curRec=tabModel-&gt;<span class="built_in">record</span>(curRecNo); <span class="comment">//获取当前记录</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (curRec.<span class="built_in">isNull</span>(<span class="string">&quot;Photo&quot;</span>))  <span class="comment">//图片字段内容为空</span></span><br><span class="line">       ui-&gt;dbLabPhoto-&gt;<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        QByteArray data=curRec.<span class="built_in">value</span>(<span class="string">&quot;Photo&quot;</span>).<span class="built_in">toByteArray</span>();</span><br><span class="line">        QPixmap pic;</span><br><span class="line">        pic.<span class="built_in">loadFromData</span>(data);</span><br><span class="line">        ui-&gt;dbLabPhoto-&gt;<span class="built_in">setPixmap</span>(pic.<span class="built_in">scaledToWidth</span>(ui-&gt;dbLabPhoto-&gt;<span class="built_in">size</span>().<span class="built_in">width</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="QSQLQueryModel的使用"><a href="#QSQLQueryModel的使用" class="headerlink" title="QSQLQueryModel的使用"></a>QSQLQueryModel的使用</h2><p>QSQLQueryModel是QSQLTab额Model的父类</p>
<p>QSQLQueryModel封装了指向SELECT语句从数据库查询数据的功能</p>
<p>QSqlQueryModel只能读取数据，不能编辑</p>
<p>先简单的让它显示数据库的内容，头文件:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QSqlDatabase DB;<span class="comment">//数据库对象</span></span><br><span class="line">QSqlQueryModel*qryModel;<span class="comment">//数据模型</span></span><br><span class="line">QItemSelectionModel*theSelection;<span class="comment">//选择模型</span></span><br></pre></td></tr></table></figure>

<p>构造函数 非常普通简单</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qryModel=<span class="keyword">new</span> <span class="built_in">QSqlQueryModel</span>(<span class="keyword">this</span>);</span><br><span class="line">theSelection=<span class="keyword">new</span> <span class="built_in">QItemSelectionModel</span>(qryModel);</span><br><span class="line">ui-&gt;tableView-&gt;<span class="built_in">setModel</span>(qryModel);<span class="comment">//设置数据模型</span></span><br><span class="line">ui-&gt;tableView-&gt;<span class="built_in">setSelectionModel</span>(theSelection);<span class="comment">//设置选择模型</span></span><br></pre></td></tr></table></figure>

<p>打开数据库的按钮:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actOpenDB_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//打开</span></span><br><span class="line">    QString aFile=QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;打开数据库&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;数据库文件(*.db *.db3)&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(aFile.<span class="built_in">isEmpty</span>())<span class="keyword">return</span>;</span><br><span class="line">    DB=QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;QSQLITE&quot;</span>);</span><br><span class="line">    DB.<span class="built_in">setDatabaseName</span>(aFile);</span><br><span class="line">    <span class="keyword">if</span>(!DB.<span class="built_in">open</span>())&#123;</span><br><span class="line">        QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>,<span class="string">&quot;错误&quot;</span>,<span class="string">&quot;打开数据库失败&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    qryModel-&gt;<span class="built_in">setQuery</span>(<span class="string">&quot;SELECT empNo, Name, Gender, Height, Birthday, Mobile, Province, City, Department, &quot;</span></span><br><span class="line">                       <span class="string">&quot; Education, Salary FROM employee ORDER BY empNo&quot;</span>);<span class="comment">//sql查询语句</span></span><br><span class="line">    <span class="keyword">if</span>(qryModel-&gt;<span class="built_in">lastError</span>().<span class="built_in">isValid</span>())&#123;</span><br><span class="line">        QMessageBox::<span class="built_in">critical</span>(<span class="keyword">this</span>,<span class="string">&quot;错误&quot;</span>,<span class="string">&quot;数据库&quot;</span>,<span class="string">&quot;查询失败\n&quot;</span>+qryModel-&gt;<span class="built_in">lastError</span>().<span class="built_in">text</span>());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    qryModel-&gt;<span class="built_in">setHeaderData</span>(<span class="number">0</span>,Qt::Horizontal,<span class="string">&quot;工号&quot;</span>);<span class="comment">//设置第0和第二个字段的名称</span></span><br><span class="line">    qryModel-&gt;<span class="built_in">setHeaderData</span>(<span class="number">2</span>,Qt::Horizontal,<span class="string">&quot;性别&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行完毕后，其实和之前的界面一样的，主要在于这个我们无法修改了，没办法编辑</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-04_23-55-18.png"></p>
<p><strong>void QTableView:: setColumnHidden ( int <em>column</em> , bool <em>hide</em> )</strong></p>
<p>如果<em>hide</em>为真，则给定<em>列</em>将被隐藏；否则将显示。</p>
<p>只有QSqlTableModel作为数据模型才有效，用于隐藏或者重写显示列的。隐藏列不影响读取它的数据。</p>
<p><strong>QDataWidgetMapper</strong>是数据映射，值得注意</p>
<p>我们放两个函数，分别是打开和切换行的时候的函数，主要是为了看它的对数据库和一些类的方法使用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actOpenDB_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//打开</span></span><br><span class="line">    QString aFile=QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;打开数据库&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;数据库文件(*.db *.db3)&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(aFile.<span class="built_in">isEmpty</span>())<span class="keyword">return</span>;</span><br><span class="line">    DB=QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;QSQLITE&quot;</span>);</span><br><span class="line">    DB.<span class="built_in">setDatabaseName</span>(aFile);</span><br><span class="line">    <span class="keyword">if</span>(!DB.<span class="built_in">open</span>())&#123;</span><br><span class="line">        QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>,<span class="string">&quot;错误&quot;</span>,<span class="string">&quot;打开数据库失败&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    qryModel-&gt;<span class="built_in">setQuery</span>(<span class="string">&quot;SELECT empNo, Name, Gender, Height, Birthday, Mobile, Province, City, Department, &quot;</span></span><br><span class="line">                       <span class="string">&quot; Education, Salary FROM employee ORDER BY empNo&quot;</span>);<span class="comment">//准备SQL语句</span></span><br><span class="line">    <span class="keyword">if</span>(qryModel-&gt;<span class="built_in">lastError</span>().<span class="built_in">isValid</span>())&#123;</span><br><span class="line">        QMessageBox::<span class="built_in">critical</span>(<span class="keyword">this</span>,<span class="string">&quot;错误&quot;</span>,<span class="string">&quot;数据库&quot;</span>,<span class="string">&quot;查询失败\n&quot;</span>+qryModel-&gt;<span class="built_in">lastError</span>().<span class="built_in">text</span>());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    qryModel-&gt;<span class="built_in">setHeaderData</span>(<span class="number">0</span>,Qt::Horizontal,<span class="string">&quot;工号&quot;</span>);<span class="comment">//设置第0和第二个字段的名称</span></span><br><span class="line">    qryModel-&gt;<span class="built_in">setHeaderData</span>(<span class="number">2</span>,Qt::Horizontal,<span class="string">&quot;性别&quot;</span>);</span><br><span class="line"></span><br><span class="line">    dataMapper-&gt;<span class="built_in">addMapping</span>(ui-&gt;dbSpinEmpNo,<span class="number">0</span>);<span class="comment">//在小部件和模型中的部分之间添加映射</span></span><br><span class="line">    dataMapper-&gt;<span class="built_in">addMapping</span>(ui-&gt;dbEditName,<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//dataMapper-&gt;toFirst();//设置第一行映射</span></span><br><span class="line">    ui-&gt;actOpenDB-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_currentRowChanged</span><span class="params">(<span class="type">const</span> QModelIndex &amp;current, <span class="type">const</span> QModelIndex &amp;previous)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//行切换的时候触发此信号</span></span><br><span class="line">    <span class="keyword">if</span>(!current.<span class="built_in">isValid</span>())&#123;</span><br><span class="line">        ui-&gt;dbLabPhoto-&gt;<span class="built_in">clear</span>();</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    dataMapper-&gt;<span class="built_in">setCurrentModelIndex</span>(current);<span class="comment">//设置为当前所在的行,为了映射</span></span><br><span class="line">    <span class="type">bool</span> first=(current.<span class="built_in">row</span>()==<span class="number">0</span>);<span class="comment">//是否首记录</span></span><br><span class="line">    <span class="type">bool</span> last=(current.<span class="built_in">row</span>()==qryModel-&gt;<span class="built_in">rowCount</span>()<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">    ui-&gt;actRecFirst-&gt;<span class="built_in">setEnabled</span>(!first);<span class="comment">//更新状态</span></span><br><span class="line">    ui-&gt;actRecPrevious-&gt;<span class="built_in">setEnabled</span>(!first);</span><br><span class="line">    ui-&gt;actRecNext-&gt;<span class="built_in">setEnabled</span>(!last);</span><br><span class="line">    ui-&gt;actRecLast-&gt;<span class="built_in">setEnabled</span>(!last);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> curRecNo=theSelection-&gt;<span class="built_in">currentIndex</span>().<span class="built_in">row</span>();</span><br><span class="line">    QSqlRecord curRec=qryModel-&gt;<span class="built_in">record</span>(curRecNo);<span class="comment">//获取当前状态</span></span><br><span class="line">    <span class="type">int</span> empNo=curRec.<span class="built_in">value</span>(<span class="string">&quot;EmpNo&quot;</span>).<span class="built_in">toInt</span>();</span><br><span class="line">    QSqlQuery query;<span class="comment">//查询当前empNo的Memo和Photo字段的数据</span></span><br><span class="line">    query.<span class="built_in">prepare</span>(<span class="string">&quot;select EmpNo,Memo,Photo from employee where EmpNo=:ID&quot;</span>);<span class="comment">//准备SQL语句</span></span><br><span class="line">    query.<span class="built_in">bindValue</span>(<span class="string">&quot;:ID&quot;</span>,empNo);<span class="comment">//将占位符占位符设置为绑定到准备好的语句中的值val</span></span><br><span class="line">    query.<span class="built_in">exec</span>();</span><br><span class="line">    query.<span class="built_in">first</span>();<span class="comment">//回到第一条record</span></span><br><span class="line">    QVariant va=query.<span class="built_in">value</span>(<span class="string">&quot;Photo&quot;</span>);<span class="comment">//获取查询到的Photo字段的value</span></span><br><span class="line">    <span class="keyword">if</span>(!va.<span class="built_in">isValid</span>())<span class="comment">//图片字段内容为空则:</span></span><br><span class="line">        ui-&gt;dbLabPhoto-&gt;<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">else</span>&#123;<span class="comment">//反之显示照片:</span></span><br><span class="line">        QPixmap pic;</span><br><span class="line">        QByteArray data=va.<span class="built_in">toByteArray</span>();</span><br><span class="line">        pic.<span class="built_in">loadFromData</span>(data);</span><br><span class="line">        ui-&gt;dbLabPhoto-&gt;<span class="built_in">setPixmap</span>(pic.<span class="built_in">scaledToHeight</span>(ui-&gt;dbLabPhoto-&gt;<span class="built_in">size</span>().<span class="built_in">width</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">    QVariant va2=query.<span class="built_in">value</span>(<span class="string">&quot;Memo&quot;</span>);<span class="comment">//获取查询到的Memo字段的value</span></span><br><span class="line">    ui-&gt;dbEditMemo-&gt;<span class="built_in">setPlainText</span>(va2.<span class="built_in">toString</span>());<span class="comment">//将数据显示到控件中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到，与QsqlTableModel的不同是我们QSqlQueryModel的打开需要准备SQL查询语句才能显示，需要调用setQuery方法</p>
<p>删除当前记录:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actRecDelete_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//删除当前记录</span></span><br><span class="line">    <span class="type">int</span> curRecNo=theSelection-&gt;<span class="built_in">currentIndex</span>().<span class="built_in">row</span>();</span><br><span class="line">    QSqlRecord  curRec=qryModel-&gt;<span class="built_in">record</span>(curRecNo); <span class="comment">//获取当前记录</span></span><br><span class="line">    <span class="keyword">if</span> (curRec.<span class="built_in">isEmpty</span>()) <span class="comment">//当前为空记录</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> empNo=curRec.<span class="built_in">value</span>(<span class="string">&quot;EmpNo&quot;</span>).<span class="built_in">toInt</span>();<span class="comment">//获取员工编号</span></span><br><span class="line">    QSqlQuery query;</span><br><span class="line">    query.<span class="built_in">prepare</span>(<span class="string">&quot;delete  from employee where EmpNo = :ID&quot;</span>);</span><br><span class="line">    query.<span class="built_in">bindValue</span>(<span class="string">&quot;:ID&quot;</span>,empNo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!query.<span class="built_in">exec</span>())</span><br><span class="line">        QMessageBox::<span class="built_in">critical</span>(<span class="keyword">this</span>, <span class="string">&quot;错误&quot;</span>, <span class="string">&quot;删除记录出现错误\n&quot;</span>+query.<span class="built_in">lastError</span>().<span class="built_in">text</span>(),</span><br><span class="line">                                 QMessageBox::Ok,QMessageBox::NoButton);</span><br><span class="line">    <span class="keyword">else</span> <span class="comment">//插入，删除记录后需要重新设置SQL语句查询</span></span><br><span class="line">    &#123;</span><br><span class="line">        QString sqlStr=qryModel-&gt;<span class="built_in">query</span>().<span class="built_in">executedQuery</span>();<span class="comment">//  执行过的SELECT语句</span></span><br><span class="line">        qryModel-&gt;<span class="built_in">setQuery</span>(sqlStr);         <span class="comment">//重新查询数据</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>遍历，涨工资:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actScan_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//涨工资</span></span><br><span class="line">    QSqlQuery qryEmList;</span><br><span class="line">    qryEmList.<span class="built_in">exec</span>(<span class="string">&quot;SELECT EmpNo,Salary FROM employee order by EmpNo&quot;</span>);</span><br><span class="line">    qryEmList.<span class="built_in">first</span>();</span><br><span class="line">    QSqlQuery qryUpdate;</span><br><span class="line">    qryUpdate.<span class="built_in">prepare</span>(<span class="string">&quot;UPDATE employee SET Salary=:Salary Where EmpNo= :ID&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(qryEmList.<span class="built_in">isValid</span>())&#123;</span><br><span class="line">        <span class="type">int</span> empID=qryEmList.<span class="built_in">value</span>(<span class="string">&quot;EmpNo&quot;</span>).<span class="built_in">toInt</span>();</span><br><span class="line">        <span class="type">float</span> salary=qryEmList.<span class="built_in">value</span>(<span class="string">&quot;Salary&quot;</span>).<span class="built_in">toFloat</span>();</span><br><span class="line">        salary+=<span class="number">1000</span>;</span><br><span class="line">        qryUpdate.<span class="built_in">bindValue</span>(<span class="string">&quot;:ID&quot;</span>,empID);</span><br><span class="line">        qryUpdate.<span class="built_in">bindValue</span>(<span class="string">&quot;:Salary&quot;</span>,salary);</span><br><span class="line">        qryUpdate.<span class="built_in">exec</span>();<span class="comment">//执行</span></span><br><span class="line">        <span class="keyword">if</span>(qryUpdate.<span class="built_in">lastError</span>().<span class="built_in">isValid</span>())<span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(!qryEmList.<span class="built_in">next</span>())<span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    qryModel-&gt;<span class="built_in">setQuery</span>(<span class="string">&quot;SELECT empNo, Name, Gender, Height, Birthday, Mobile, Province, City, Department, &quot;</span></span><br><span class="line">                       <span class="string">&quot; Education, Salary FROM employee order by empNo&quot;</span>);</span><br><span class="line">    QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;提示&quot;</span>,<span class="string">&quot;涨工资完毕&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到Sql语句这种占位的方式用的非常多。另外我们这里使用的是Samp11_3的项目，最前面那个是2的</p>
<hr>
<h2 id="QSqlRelationalTableModel的使用"><a href="#QSqlRelationalTableModel的使用" class="headerlink" title="QSqlRelationalTableModel的使用"></a>QSqlRelationalTableModel的使用</h2><p>该类为单表提供了一个可编辑的数据模型，它支持外键</p>
<p>打开数据库:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actOpenDB_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//打开</span></span><br><span class="line">    QString aFile=QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;打开数据库&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;SQLITE数据(*.db *db3)&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(aFile.<span class="built_in">isEmpty</span>())<span class="keyword">return</span>;</span><br><span class="line">    DB=QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;QSQLITE&quot;</span>);</span><br><span class="line">    DB.<span class="built_in">setDatabaseName</span>(aFile);</span><br><span class="line">    <span class="keyword">if</span>(!DB.<span class="built_in">open</span>())&#123;</span><br><span class="line">        QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>,<span class="string">&quot;error&quot;</span>,<span class="string">&quot;打开数据库失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置数据与选择模型</span></span><br><span class="line">    tabModel=<span class="keyword">new</span> <span class="built_in">QSqlRelationalTableModel</span>(<span class="keyword">this</span>,DB);</span><br><span class="line">    tabModel-&gt;<span class="built_in">setTable</span>(<span class="string">&quot;studInfo&quot;</span>);<span class="comment">//设置表名</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setEditStrategy</span>(QSqlTableModel::OnManualSubmit);</span><br><span class="line">    tabModel-&gt;<span class="built_in">setSort</span>(<span class="number">0</span>,Qt::AscendingOrder);<span class="comment">//设置排序</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setHeaderData</span>(<span class="number">0</span>,Qt::Horizontal,<span class="string">&quot;学号&quot;</span>);<span class="comment">//分别更改五列的字段</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setHeaderData</span>(<span class="number">1</span>,Qt::Horizontal,<span class="string">&quot;姓名&quot;</span>);</span><br><span class="line">    tabModel-&gt;<span class="built_in">setHeaderData</span>(<span class="number">2</span>,Qt::Horizontal,<span class="string">&quot;性别&quot;</span>);</span><br><span class="line">    tabModel-&gt;<span class="built_in">setHeaderData</span>(<span class="number">3</span>,Qt::Horizontal,<span class="string">&quot;学院&quot;</span>);</span><br><span class="line">    tabModel-&gt;<span class="built_in">setHeaderData</span>(<span class="number">4</span>,Qt::Horizontal,<span class="string">&quot;专业&quot;</span>);</span><br><span class="line">    theSelection=<span class="keyword">new</span> <span class="built_in">QItemSelectionModel</span>(tabModel);</span><br><span class="line">    ui-&gt;tableView-&gt;<span class="built_in">setModel</span>(tabModel);</span><br><span class="line">    ui-&gt;tableView-&gt;<span class="built_in">setSelectionModel</span>(theSelection);</span><br><span class="line">    tabModel-&gt;<span class="built_in">select</span>();<span class="comment">//使用指定的过滤器和排序条件，使用通过setTable ()设置的表中的数据填充模型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重点:我们要让它像外键一样，同时还能下拉:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置代码字段的查询关系数据表,这两句代码第一个参数是表，第二个参数是字段，第三个参数是第一个参数表的需要替换的值，根据第二个参数让主表和从表进行匹配，然后第三个参数进行替换</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setRelation</span>(<span class="number">3</span>,<span class="built_in">QSqlRelation</span>(<span class="string">&quot;departments&quot;</span>,<span class="string">&quot;departID&quot;</span>,<span class="string">&quot;department&quot;</span>)); <span class="comment">//学院</span></span><br><span class="line">    tabModel-&gt;<span class="built_in">setRelation</span>(<span class="number">4</span>,<span class="built_in">QSqlRelation</span>(<span class="string">&quot;majors&quot;</span>,<span class="string">&quot;majorID&quot;</span>,<span class="string">&quot;major&quot;</span>));<span class="comment">//专业</span></span><br><span class="line">    ui-&gt;tableView-&gt;<span class="built_in">setItemDelegate</span>(<span class="keyword">new</span> <span class="built_in">QSqlRelationalDelegate</span>(ui-&gt;tableView));</span><br></pre></td></tr></table></figure>

<p>前面两行设置的是外键，第三行设置的是下拉列表:如果不设置:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-05_21-42-07.png"></p>
<p>只设置两行:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-05_21-43-52.png"></p>
<p>全部设置好:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-05_21-44-54.png"></p>
<p>遍历字段:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_actFields_triggered</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//字段列表</span></span><br><span class="line">    QSqlRecord emptyRec=tabModel-&gt;<span class="built_in">record</span>();</span><br><span class="line">    QString str=<span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;emptyRec.<span class="built_in">count</span>();i++)&#123;</span><br><span class="line">        str=str+emptyRec.<span class="built_in">fieldName</span>(i)+<span class="string">&#x27; &#x27;</span>;<span class="comment">//返回位置index的字段名称 累加</span></span><br><span class="line">    &#125;</span><br><span class="line">    QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;所有字段名称&quot;</span>,str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>项目例子是Samp11_4,其他函数不再介绍</p>
<hr>
<h2 id="自定义Qt-Designer插件"><a href="#自定义Qt-Designer插件" class="headerlink" title="自定义Qt Designer插件"></a>自定义Qt Designer插件</h2><p>…….看视频吧</p>
<h2 id="Qt编译静态库且使用"><a href="#Qt编译静态库且使用" class="headerlink" title="Qt编译静态库且使用"></a>Qt编译静态库且使用</h2><p>我们要创建library项目</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-22-48.png"></p>
<p>然后选择静态库，默认是动态库，如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-24-50.png"></p>
<p>我们这里使用在Samp9_3写的控件选择pen，需要复制一个h文件，一个cpp，一个ui，导入到项目即可编译。注意pro项目设置，默认少模块，自己加。如果使用的是gcc编译器后缀名就是a，正常现象。然后我们创建一个include文件夹，记得把头文件加进来:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-27-37.png"></p>
<p>最后这个d是我们自己加的，这很重要，因为在别的项目导入它的时候导入加，我们是debug生成的，点击项目右键添加库:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-29-10.png"></p>
<p>下一步:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-30-50.png"></p>
<p>自己选择好即可下一步结束，include引入头文件就能直接使用，编译静态库和使用的方式都大同小异，只是设置项目的不同ide不同而已。</p>
<hr>
<h2 id="创建和使用共享库"><a href="#创建和使用共享库" class="headerlink" title="创建和使用共享库"></a>创建和使用共享库</h2><p>基本的创建和导入和上面的静态是一样的，设置改成动态库即可，不介绍。讲不同的</p>
<p>注意编译好后我们需要一个静态库一个动态库，静态库类似辅助动态库的，因为使用gcc编译后缀名是a，如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-53-06.png"></p>
<p>但是现在是无效的，我们创建DLL项目除了一个头文件一个cpp，还会有一个<strong>xxx_global.h</strong>它需要被使用</p>
<p>需要在编译的h文件引入它，同时使用它的宏加在类名前面</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_15-59-01.png"></p>
<p>我们需要四个文件:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_16-11-21.png"></p>
<p>注意是debug生成的要在最后加d。</p>
<p>然后正常添加库，使用动态库，但选择的时候选择这个a后缀的静态。就好了。但是</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_16-21-51.png"></p>
<p>我们看到项目生成的代码实际上是把include_dl也当成搜索目录了。这个目录文件夹和项目所在的文件夹是同级。最好是我们把dll拷贝到生成的dll同级目录</p>
<h3 id="接下来我们看如何显式调用动态库，编译时无序动态库的任何文件"><a href="#接下来我们看如何显式调用动态库，编译时无序动态库的任何文件" class="headerlink" title="接下来我们看如何显式调用动态库，编译时无序动态库的任何文件"></a>接下来我们看如何显式调用动态库，编译时无序动态库的任何文件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MainWindow::on_pushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//调用Dephi DLL</span></span><br><span class="line">    <span class="function">QLibrary <span class="title">myLib</span><span class="params">(<span class="string">&quot;Qt_Dll&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (myLib.<span class="built_in">isLoaded</span>())<span class="comment">//加载</span></span><br><span class="line">        QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;信息&quot;</span>,<span class="string">&quot;Qt_Dll.dll已经被载入,第1处&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(*FunDef)</span><span class="params">(<span class="type">int</span>)</span></span>; <span class="comment">//函数原定定义</span></span><br><span class="line">    FunDef myTriple = (FunDef) myLib.<span class="built_in">resolve</span>(<span class="string">&quot;?n_3@@YAHH@Z&quot;</span>); <span class="comment">//解析DLL中的函数</span></span><br><span class="line">    <span class="type">int</span> V=<span class="built_in">myTriple</span>(ui-&gt;spinInput-&gt;<span class="built_in">value</span>()); <span class="comment">//调用函数</span></span><br><span class="line">    ui-&gt;spinOutput-&gt;<span class="built_in">setValue</span>(V);<span class="comment">//显示</span></span><br><span class="line">    <span class="keyword">if</span> (myLib.<span class="built_in">isLoaded</span>())</span><br><span class="line">        QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>,<span class="string">&quot;信息&quot;</span>,<span class="string">&quot;DelphiDLL.DLL已经被载入,第2处&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为啥这个函数名这么奇怪?因为这是一种比较粗暴的解决的方式</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_18-13-30.png"></p>
<p>输入:dumpbin &#x2F;exports dll路径</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_18-15-07.png"></p>
<p>就解决了，虽然有点傻</p>
<p>我们回忆一下vs生成dll吧，结果如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_17-53-26.png"></p>
<p>标准的显式链接调用，这里只是封装一个函数，头文件写:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="keyword">extern</span> __declspec(dllexport) <span class="function"><span class="type">int</span> <span class="title">n_3</span><span class="params">(<span class="type">int</span> n)</span></span>;</span><br></pre></td></tr></table></figure>

<p>cpp：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;test.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">n_3</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> n * <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类的话也只需要声明的时候类名前面加上extern __declspec(dllexport)即可</p>
<p>这种可以直接用于隐式链接调用共享库</p>
<hr>
<h3 id="用模块定义文件-def-解决函数名的问题"><a href="#用模块定义文件-def-解决函数名的问题" class="headerlink" title="用模块定义文件(.def)解决函数名的问题"></a>用模块定义文件(.def)解决函数名的问题</h3><p>首先我们不需要再写<strong>extern __declspec(dllexport)</strong> 了</p>
<p>创建一个*.def文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LIBRARY Qt_DLL<span class="comment">//第一个必须写，表示和dll关联，第二个是生成的dll的名字</span></span><br><span class="line">EXPORTS<span class="comment">//必写</span></span><br><span class="line">	n_3<span class="comment">//函数名</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数完整的语法是</span></span><br><span class="line">EXPORTS</span><br><span class="line">  函数标识符 = 导出名</span><br></pre></td></tr></table></figure>

<p>还要设置项目的连接器属性，不然项目不知道。这种方式对类无效</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-06_19-30-16.png"></p>
<hr>
<h2 id="ABI"><a href="#ABI" class="headerlink" title="ABI"></a>ABI</h2><p>ABI(应用程序二进制接口)</p>
<h2 id="API和ABI"><a href="#API和ABI" class="headerlink" title="API和ABI"></a>API和ABI</h2><p>API，Application Programming Interface</p>
<p>ABI，Application Binary Interface</p>
<p>从名字上就可以看出，API是面向编程人员的，是面向人的；而ABI，编程人员是不容易直接看到的，但编程人员的行为可以直接影响到ABI，简单来说，ABI是面向编译器的。举个简单的例子</p>
<p>详细看<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/895451c7b678">文章</a></p>
<hr>
<h2 id="Qt互斥量，线程同步"><a href="#Qt互斥量，线程同步" class="headerlink" title="Qt互斥量，线程同步"></a>Qt互斥量，线程同步</h2><p>QThread之前介绍过了，不再说明。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//QMutex是Qt提供的互斥量，类似std::mutex</span></span><br><span class="line"><span class="built_in">lock</span>() <span class="built_in">unlock</span>() <span class="built_in">trylock</span>()<span class="comment">//三种常用的方法</span></span><br><span class="line">       </span><br><span class="line"><span class="comment">//QMutexLocker简化了互斥量的处理，利用的RAII，构造与析构进行互斥量的操作</span></span><br><span class="line">   std::lock_guard&lt;std::mutex&gt;<span class="comment">//类似于这个，创建它的时候需要传入一个互斥量进行构造</span></span><br><span class="line">   <span class="comment">//Qt必须传入互斥量地址，标准库使用的是引用</span></span><br><span class="line">   QMutexLocker&lt;QMutex&gt;<span class="built_in">T</span>(&amp;c);<span class="comment">//实际就是一个包装器</span></span><br></pre></td></tr></table></figure>



<p>Qt的基于<strong>QReadWriteLock</strong>的线程同步</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//QReadWriteLock提供以下几个主要的函数：</span></span><br><span class="line"><span class="built_in">lockForRead</span>()<span class="comment">//：只读方式锁定资源，如果有其他线程以写入方式锁定，这个函数会阻塞</span></span><br><span class="line"><span class="built_in">lockForWrite</span>()<span class="comment">//：以写入方式锁定资源，如果本线程或其他线程以读或写模式锁定资源，则函数堵塞</span></span><br><span class="line"><span class="built_in">unlock</span>()<span class="comment">//：解锁</span></span><br><span class="line"><span class="built_in">tryLockForRead</span>()<span class="comment">//：是lockForRead的非阻塞版本</span></span><br><span class="line"><span class="built_in">tryLockForWrite</span>()<span class="comment">//：是lockForWrite的非阻塞版本</span></span><br></pre></td></tr></table></figure>

<p>QReadLocker和QWriteLocker是QReadWriteLock的简便形式,无需与unlock()配对使用</p>
<p><strong>他们用的是RAII自动的,所有不用手动unlock()</strong></p>
<p><strong>QReadWriteLock 不是包装器，它本身就是锁，不需要传入QMutex进行构造</strong></p>
<p>Qt的<strong>QWaitCondition</strong>线程同步</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//QWaitCondition提供如下一些函数</span></span><br><span class="line"><span class="built_in">wait</span>(QMutex*lockedMutex)<span class="comment">//进入等待状态，解锁互斥量lockedMutex，被唤醒后锁定lockedMutex并退出函数</span></span><br><span class="line"><span class="built_in">wakeAll</span>()<span class="comment">//唤醒所有处于等待状态的线程，线程唤醒的顺序不确定，由操作系统的调度策略决定</span></span><br><span class="line"><span class="built_in">wakeOne</span>()<span class="comment">//唤醒一个处于等待状态的线程，唤醒哪个线程不确定，由操作系统的调度策略</span></span><br></pre></td></tr></table></figure>

<p>QWaitCondition 一般用于 “ 生产者／消费者 ” （ producer&#x2F;consumer ）模型中 。“ 生产者”产生数据， “ 消费者 ” 使用数据 </p>
<p>它既不是锁也不是包装器，类似std::condition_variable</p>
<p>Qt<strong>基于信号量的线程同步QSemaphore</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//QSemaphore是实现信号量功能的类，提供以下函数：</span></span><br><span class="line"><span class="built_in">acquire</span>(<span class="type">int</span> n)<span class="comment">//：尝试获得n个资源，如果不够将堵塞线程，直到n个资源可用；</span></span><br><span class="line"><span class="built_in">release</span>(<span class="type">int</span> n)<span class="comment">//：释放资源，如果资源已经全部可用，则可扩充资源总数；</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">available</span><span class="params">()</span><span class="comment">//：返回当前信号量的资源个数；</span></span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">tryAcquire</span><span class="params">(<span class="type">int</span> n=<span class="number">1</span>)</span><span class="comment">//：尝试获取n个资源，不成功时，不阻塞线程；</span></span></span><br></pre></td></tr></table></figure>

<p>信号量（Semaphore）通常用于保护一定的相同的资源，例如数Data Acquisition (数据采集)时的双缓冲数量区。</p>
<hr>
<h2 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h2><p>其实之前讲过一些，我们详细讲一下，首先项目文件导入网络模块</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QT       += network</span><br></pre></td></tr></table></figure>



<p>获取IPv4地址与主机名显示:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnGetHostInfo_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//主机名</span></span><br><span class="line">    QString hostName=QHostInfo::<span class="built_in">localHostName</span>();<span class="comment">//获取主机名</span></span><br><span class="line">    ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(hostName);<span class="comment">//显示主机名</span></span><br><span class="line">    QHostInfo hostInfo=QHostInfo::<span class="built_in">fromName</span>(hostName);<span class="comment">//获取主机信息</span></span><br><span class="line"></span><br><span class="line">    QList&lt;QHostAddress&gt;addList=hostInfo.<span class="built_in">addresses</span>();<span class="comment">//返回与hostName()关联的IP地址列表 保存</span></span><br><span class="line">    <span class="keyword">if</span>(addList.<span class="built_in">isEmpty</span>())<span class="keyword">return</span>;<span class="comment">//列表为空则退出</span></span><br><span class="line">    <span class="type">bool</span> show;</span><br><span class="line">    foreach (<span class="keyword">auto</span> aHost, addList) &#123;<span class="comment">//foreach遍历只是为了找到列表中IPv4的属性</span></span><br><span class="line">        <span class="keyword">if</span>(ui-&gt;chkOnlyIPv4-&gt;<span class="built_in">isChecked</span>())</span><br><span class="line">            show=aHost.<span class="built_in">protocol</span>()==QAbstractSocket::IPv4Protocol;<span class="comment">//protocol()返回主机地址的网络层协议，进行比较</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            show=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(show)&#123;<span class="comment">//当show为true也就是找到IPv4的时候进行显示</span></span><br><span class="line">            ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;协议:&quot;</span>+<span class="built_in">protocolName</span>(aHost.<span class="built_in">protocol</span>()));</span><br><span class="line">            ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;本机IP地址:&quot;</span>+aHost.<span class="built_in">toString</span>()+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">QString <span class="title">Dialog::protocolName</span><span class="params">(QAbstractSocket::NetworkLayerProtocol protocoal)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(protocoal)&#123;</span><br><span class="line">    <span class="keyword">case</span> QAbstractSocket::IPv4Protocol:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;IPv4 protocol&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> QAbstractSocket::IPv6Protocol:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;IPv6 protocol&quot;</span>;</span><br><span class="line">    <span class="keyword">case</span> QAbstractSocket::AnyIPProtocol:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Any IP protocol&quot;</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unknown Network Layer Protocol&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果想要不同的协议也可以稍加修改枚举量</p>
<p>查找域名的方式获取IP地址:</p>
<p><strong>int QHostInfo:: lookupHost (const <a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qstring.html">QString</a> &amp; <em>name</em> , <a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qobject.html">QObject</a> * <em>receiver</em> , const char * <em>member</em> )[static]</strong></p>
<p><em>查找与主机名name</em>关联的 IP 地址，并返回用于查找的 ID。当查找结果准备好时，<em>接收器</em>中的插槽或信号<em>成员</em>将使用<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qhostinfo.html">QHostInfo</a>参数调用。然后可以检查<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qhostinfo.html">QHostInfo对象以获取查找结果。</a></p>
<p>查找由单个函数调用执行，例如：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QHostInfo :: <span class="built_in">lookupHost</span>( <span class="string">&quot;www.kde.org&quot;</span> , <span class="keyword">this</span> , <span class="built_in">SLOT</span>(<span class="built_in">lookup</span>( QHostInfo )));</span><br></pre></td></tr></table></figure>

<p>我们的例子如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnLookup_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//查找域名的ip地址</span></span><br><span class="line">    QString hostname=ui-&gt;editHost-&gt;<span class="built_in">text</span>();</span><br><span class="line">    ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;正在查询的主机信息&quot;</span>+hostname);</span><br><span class="line">    QHostInfo::<span class="built_in">lookupHost</span>(hostname,<span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">lookedUpHostInfo</span>(QHostInfo)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::lookedUpHostInfo</span><span class="params">(<span class="type">const</span> QHostInfo &amp;host)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QList&lt;QHostAddress&gt; addList=host.<span class="built_in">addresses</span>();</span><br><span class="line">    <span class="keyword">if</span>(addList.<span class="built_in">isEmpty</span>())<span class="keyword">return</span>;<span class="comment">//列表为空则退出</span></span><br><span class="line">    <span class="type">bool</span> show;</span><br><span class="line">    foreach (<span class="keyword">auto</span> aHost, addList) &#123;<span class="comment">//foreach遍历只是为了找到列表中IPv4的属性</span></span><br><span class="line">        <span class="keyword">if</span>(ui-&gt;chkOnlyIPv4-&gt;<span class="built_in">isChecked</span>())</span><br><span class="line">            show=aHost.<span class="built_in">protocol</span>()==QAbstractSocket::IPv4Protocol;<span class="comment">//protocol()返回主机地址的网络层协议，进行比较</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            show=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(show)&#123;<span class="comment">//当show为true也就是找到IPv4的时候进行显示</span></span><br><span class="line">            ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;协议:&quot;</span>+<span class="built_in">protocolName</span>(aHost.<span class="built_in">protocol</span>()));</span><br><span class="line">            ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;地址:&quot;</span>+aHost.<span class="built_in">toString</span>()+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>lookupHost静态函数调用的我们写的函数和先前的差不多，都是查询主机IPv4地址的。我们是写成两个按钮，如下:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-07_15-06-32.png"></p>
<p><strong>QNetworkInterface 类提供主机 IP 地址和网络接口的列表。</strong></p>
<h3 id="static-QList-lt-QHostAddress-gt-QNetworkInterface-allAddresses"><a href="#static-QList-lt-QHostAddress-gt-QNetworkInterface-allAddresses" class="headerlink" title="[static]QList &lt; QHostAddress &gt; QNetworkInterface:: allAddresses ()"></a><code>[static]</code><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qlist.html">QList</a> &lt;<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qhostaddress.html"> QHostAddress</a> &gt; QNetworkInterface:: allAddresses ()</h3><p>此便捷函数返回在主机上找到的所有 IP 地址。这相当于对<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qnetworkinterface.html#addressEntries">allInterfaces</a> ()返回的所有处于<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qnetworkinterface.html#InterfaceFlag-enum">QNetworkInterface::IsUp状态的对象调用</a><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qnetworkinterface.html#allInterfaces">addressEntries</a> ()以获取<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qnetworkaddressentry.html">QNetworkAddressEntry</a>对象的列表，然后对每个对象调用<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qnetworkaddressentry.html#ip">QNetworkAddressEntry::ip ()。</a></p>
<p>也就是图右侧第一个按钮，实现代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnDetail_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QList&lt;QHostAddress&gt; addList=QNetworkInterface::<span class="built_in">allAddresses</span>();</span><br><span class="line">    <span class="keyword">if</span>(addList.<span class="built_in">isEmpty</span>())<span class="keyword">return</span>;<span class="comment">//列表为空则退出</span></span><br><span class="line">    <span class="type">bool</span> show;</span><br><span class="line">    foreach (<span class="keyword">auto</span> aHost, addList) &#123;<span class="comment">//foreach遍历只是为了找到列表中IPv4的属性</span></span><br><span class="line">        <span class="keyword">if</span>(ui-&gt;chkOnlyIPv4-&gt;<span class="built_in">isChecked</span>())</span><br><span class="line">            show=aHost.<span class="built_in">protocol</span>()==QAbstractSocket::IPv4Protocol;<span class="comment">//protocol()返回主机地址的网络层协议，进行比较</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            show=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(show)&#123;<span class="comment">//当show为true也就是找到IPv4的时候进行显示</span></span><br><span class="line">            ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;协议:&quot;</span>+<span class="built_in">protocolName</span>(aHost.<span class="built_in">protocol</span>()));</span><br><span class="line">            ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;地址:&quot;</span>+aHost.<span class="built_in">toString</span>()+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只需要看函数内第一句话就行，其他的和前面的代码如出一辙</p>
<h3 id="static-QList-lt-QNetworkInterface-gt-QNetworkInterface-allInterfaces"><a href="#static-QList-lt-QNetworkInterface-gt-QNetworkInterface-allInterfaces" class="headerlink" title="[static]QList &lt; QNetworkInterface &gt;QNetworkInterface:: allInterfaces ()"></a><code>[static]</code><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qlist.html">QList</a> &lt;<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qnetworkinterface.html#QNetworkInterface"> QNetworkInterface</a> &gt;QNetworkInterface:: allInterfaces ()</h3><p>返回主机上找到的所有网络接口的列表。如果失败，它会返回一个包含零元素的列表。</p>
<p>最后一个按钮的例子:</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-07_15-30-44.png"></p>
<p>实现代码如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog::on_btnALLInterface_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QList&lt;QNetworkInterface&gt;list=QNetworkInterface::<span class="built_in">allInterfaces</span>();<span class="comment">//返回主机上找到的所有网络接口的列表</span></span><br><span class="line">    foreach(<span class="keyword">auto</span> aInterface,list)&#123;<span class="comment">//遍历这些网络接口列表</span></span><br><span class="line">        <span class="keyword">if</span>(!aInterface.<span class="built_in">isValid</span>())<span class="keyword">continue</span>;</span><br><span class="line">        ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;设备名称&quot;</span>+aInterface.<span class="built_in">humanReadableName</span>());</span><br><span class="line">        ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;硬件地址&quot;</span>+aInterface.<span class="built_in">hardwareAddress</span>());</span><br><span class="line">        QList&lt;QNetworkAddressEntry&gt;entryList=aInterface.<span class="built_in">addressEntries</span>();<span class="comment">//返回所有的ip地址列表等网关掩码广播地址</span></span><br><span class="line">        foreach (<span class="keyword">auto</span> aEntry, entryList) &#123;</span><br><span class="line">            ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot; IP地址:&quot;</span>+aEntry.<span class="built_in">ip</span>().<span class="built_in">toString</span>());</span><br><span class="line">            ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;子网掩码:&quot;</span>+aEntry.<span class="built_in">netmask</span>().<span class="built_in">toString</span>());</span><br><span class="line">            ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;广播地址:&quot;</span>+aEntry.<span class="built_in">broadcast</span>().<span class="built_in">toString</span>()+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ui-&gt;plainTextEdit-&gt;<span class="built_in">appendPlainText</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="QList-lt-QNetworkAddressEntry-gt-QNetworkInterface-addressEntries-const"><a href="#QList-lt-QNetworkAddressEntry-gt-QNetworkInterface-addressEntries-const" class="headerlink" title="QList &lt; QNetworkAddressEntry &gt; QNetworkInterface:: addressEntries () const"></a><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qlist.html">QList</a> &lt;<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qnetworkaddressentry.html"> QNetworkAddressEntry</a> &gt; QNetworkInterface:: addressEntries () const</h3><p>返回此接口拥有的 IP 地址列表及其关联的网络掩码和广播地址。</p>
<hr>
<h2 id="TCP通信"><a href="#TCP通信" class="headerlink" title="TCP通信"></a>TCP通信</h2><p>之前学过，但是还是再说一遍</p>
<p>TCP是一种被大多数Internet网络协议（如HTTP和FTP）用于数据传输的低级网络协议，是可靠的、面向流、面向连接的传输协议。</p>
<p><img src="/%E5%9B%BE%E7%89%87%5CSnipaste_2022-07-07_15-49-24.png"></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/05/19/%E5%87%BD%E6%95%B0/" rel="prev" title="函数">
      <i class="fa fa-chevron-left"></i> 函数
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          المحتويات
        </li>
        <li class="sidebar-nav-overview">
          عام
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Qt%E5%9F%BA%E7%A1%80%E6%8E%A7%E4%BB%B6"><span class="nav-number">1.</span> <span class="nav-text">Qt基础控件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ToolButton%E6%8C%89%E9%92%AE%E8%AE%BE%E7%BD%AE%E5%9B%BE%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">ToolButton按钮设置图标的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scrollArea%E6%BB%9A%E5%8A%A8%E5%8C%BA%E5%9F%9F%E4%BD%BF%E7%94%A8QLabel%E6%A0%87%E7%AD%BE%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87"><span class="nav-number">1.2.</span> <span class="nav-text">scrollArea滚动区域使用QLabel标签添加图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Windeployqt%E5%91%BD%E4%BB%A4%E5%9C%A8Windows%E4%B8%8B%E6%89%93%E5%8C%85Qt%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.3.</span> <span class="nav-text">Windeployqt命令在Windows下打包Qt程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QDesktopServices-amp-Qurl%E5%86%99%E4%B8%80%E4%B8%AA%E6%B5%8F%E8%A7%88%E5%99%A8%E6%90%9C%E7%B4%A2%E6%A1%86"><span class="nav-number">1.4.</span> <span class="nav-text">QDesktopServices&amp;Qurl写一个浏览器搜索框</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QVBoxLayout%E5%9C%A8%E6%BB%9A%E5%8A%A8%E5%8C%BA%E5%9F%9F%E5%90%8C%E6%97%B6%E6%98%BE%E7%A4%BA%E5%A4%9A%E4%B8%AA%E5%9B%BE%E7%89%87"><span class="nav-number">1.5.</span> <span class="nav-text">QVBoxLayout在滚动区域同时显示多个图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QProgressDialog-amp-QTimer%E8%AE%BE%E7%BD%AE%E8%BF%9B%E5%BA%A6%E6%9D%A1"><span class="nav-number">1.6.</span> <span class="nav-text">QProgressDialog&amp;QTimer设置进度条</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QColor-amp-QBrush-amp-QRect-amp-QPixmap-amp-QPainter%E8%AE%BE%E7%BD%AE%E9%A2%9C%E8%89%B2"><span class="nav-number">1.7.</span> <span class="nav-text">QColor&amp;QBrush&amp;QRect&amp;QPixmap&amp;QPainter设置颜色</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QtabWidget%E8%AE%BE%E7%BD%AE%E5%A4%9A%E4%B8%AA%E7%AA%97%E5%8F%A3%E4%B8%8E%E4%BF%A1%E5%8F%B7"><span class="nav-number">1.8.</span> <span class="nav-text">QtabWidget设置多个窗口与信号</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QStackedWidget%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="nav-number">1.9.</span> <span class="nav-text">QStackedWidget的简单使用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Qt%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1"><span class="nav-number">2.</span> <span class="nav-text">Qt多线程与网络通信</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0-amp-%E5%86%92%E6%B3%A1-amp-%E5%BF%AB%E6%8E%92-amp-%E6%98%BE%E7%A4%BA%E5%87%BA%E6%9D%A5"><span class="nav-number">2.1.</span> <span class="nav-text">创建线程生成随机数&amp;冒泡&amp;快排&amp;显示出来</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B"><span class="nav-number">2.1.1.</span> <span class="nav-text">使用第二种方式创建线程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0QThreadPool"><span class="nav-number">2.2.</span> <span class="nav-text">线程池QThreadPool</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9A%84Qt%E5%A5%97%E6%8E%A5%E5%AD%97%E9%80%9A%E4%BF%A1"><span class="nav-number">2.3.</span> <span class="nav-text">基础的Qt套接字通信</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF"><span class="nav-number">2.3.1.</span> <span class="nav-text">服务器端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">2.3.2.</span> <span class="nav-text">客户端</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%90%AD%E5%BB%BA%E5%8F%91%E9%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-number">2.4.</span> <span class="nav-text">多线程搭建发送文件的客户端与服务端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF-1"><span class="nav-number">2.4.1.</span> <span class="nav-text">客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF-1"><span class="nav-number">2.4.2.</span> <span class="nav-text">服务器端</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Qt%E4%BA%8B%E4%BB%B6"><span class="nav-number">3.</span> <span class="nav-text">Qt事件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">3.1.</span> <span class="nav-text">事件处理函数的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%99%A8%E5%87%BD%E6%95%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%89%E9%92%AE"><span class="nav-number">3.2.</span> <span class="nav-text">基于事件处理器函数自定义按钮</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%89%E9%92%AE%E6%B7%BB%E5%8A%A0%E4%BF%A1%E5%8F%B7"><span class="nav-number">3.2.1.</span> <span class="nav-text">自定义按钮添加信号</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%E2%80%94%E6%A1%88%E4%BE%8B"><span class="nav-number">3.3.</span> <span class="nav-text">事件的使用—案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#event%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E5%99%A8"><span class="nav-number">3.4.</span> <span class="nav-text">event事件分发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">3.5.</span> <span class="nav-text">事件过滤器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#QPainter%E7%BB%98%E5%9B%BE"><span class="nav-number">4.</span> <span class="nav-text">QPainter绘图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E8%AE%BE%E7%BD%AE"><span class="nav-number">4.0.1.</span> <span class="nav-text">高级设置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E7%94%BB%E5%AE%B6-%E7%94%BB%E8%B5%84%E6%BA%90%E5%9B%BE%E7%89%87%EF%BC%8C%E8%B0%83%E7%94%A8%E7%BB%98%E5%9B%BE%E4%BA%8B%E4%BB%B6"><span class="nav-number">4.0.1.1.</span> <span class="nav-text">利用画家 画资源图片，调用绘图事件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%9B%BE%E8%AE%BE%E5%A4%87"><span class="nav-number">4.0.2.</span> <span class="nav-text">绘图设备</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QFile%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">4.1.</span> <span class="nav-text">QFile文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%EF%BC%9A"><span class="nav-number">4.1.1.</span> <span class="nav-text">读：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99"><span class="nav-number">4.1.2.</span> <span class="nav-text">写:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QFileIfo%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF%E8%AF%BB%E5%8F%96"><span class="nav-number">4.1.3.</span> <span class="nav-text">QFileIfo文件信息读取</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Qt%E7%9A%84%E5%A4%9A%E5%AA%92%E4%BD%93%E6%A8%A1%E5%9D%97multimedia"><span class="nav-number">4.2.</span> <span class="nav-text">Qt的多媒体模块multimedia</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#void-QSoundEffect-setLoopCount-int-loopCount"><span class="nav-number">4.2.1.</span> <span class="nav-text">void QSoundEffect::setLoopCount(int loopCount)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#void-QSoundEffect-setMuted-bool-muted"><span class="nav-number">4.2.2.</span> <span class="nav-text">void QSoundEffect:: setMuted ( bool muted )</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QUrl-QSoundEffect-source-const"><span class="nav-number">4.2.3.</span> <span class="nav-text">QUrl QSoundEffect:: source () const</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#qreal-QSoundEffect-volume-const"><span class="nav-number">4.2.4.</span> <span class="nav-text">qreal QSoundEffect:: volume () const</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8BQAction"><span class="nav-number">4.3.</span> <span class="nav-text">案例QAction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%95%B0%E5%80%BC%E8%BE%93%E5%85%A5%E5%92%8C%E6%98%BE%E7%A4%BA%E7%BB%84%E4%BB%B6"><span class="nav-number">4.4.</span> <span class="nav-text">其他数值输入和显示组件:</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8QSlider%E6%8E%A7%E4%BB%B6"><span class="nav-number">4.4.1.</span> <span class="nav-text">使用QSlider控件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8QDial%E8%81%94%E5%8A%A8QLCDNumber%EF%BC%8C%E5%A6%82%E5%9B%BE"><span class="nav-number">4.4.2.</span> <span class="nav-text">使用QDial联动QLCDNumber，如图:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QSlider%E6%8E%A7%E4%BB%B6%E6%93%8D%E4%BD%9CQProgressBar"><span class="nav-number">4.4.3.</span> <span class="nav-text">QSlider控件操作QProgressBar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QRadioButton%E6%8E%A7%E5%88%B6QLCDNumber"><span class="nav-number">4.4.4.</span> <span class="nav-text">QRadioButton控制QLCDNumber</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E4%B8%8E%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="nav-number">4.5.</span> <span class="nav-text">时间日期与定时器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%E5%BC%BA%E8%B0%83%EF%BC%8C%E8%AE%A1%E6%97%B6%E5%99%A8%E5%9B%A0%E4%B8%BAQTime%E7%9A%84start%E6%96%B9%E6%B3%95%E8%A2%AB%E5%88%A0%E9%99%A4"><span class="nav-number">4.5.1.</span> <span class="nav-text">最后强调，计时器因为QTime的start方法被删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QComBox%E5%92%8CQPainTextEdot"><span class="nav-number">4.6.</span> <span class="nav-text">QComBox和QPainTextEdot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#QComBox"><span class="nav-number">4.6.1.</span> <span class="nav-text">QComBox</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QPainTextEdot"><span class="nav-number">4.6.2.</span> <span class="nav-text">QPainTextEdot</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QMdiArea%E7%B1%BB"><span class="nav-number">4.7.</span> <span class="nav-text">QMdiArea类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QTabeView"><span class="nav-number">4.8.</span> <span class="nav-text">QTabeView</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E8%A7%92%E5%87%BD%E6%95%B0"><span class="nav-number">4.9.</span> <span class="nav-text">三角函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Qt-Http"><span class="nav-number">4.10.</span> <span class="nav-text">Qt Http</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QGraphicsView%E7%BB%98%E5%9B%BE%E6%9E%B6%E6%9E%84"><span class="nav-number">4.11.</span> <span class="nav-text">QGraphicsView绘图架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Qt%E8%BF%9E%E6%8E%A5mysql%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.12.</span> <span class="nav-text">Qt连接mysql查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Qt%E4%B8%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C"><span class="nav-number">4.13.</span> <span class="nav-text">Qt中数据库的事务操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E5%86%99QChartView%E6%8E%A7%E4%BB%B6"><span class="nav-number">4.14.</span> <span class="nav-text">重写QChartView控件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%99%E6%8E%A7%E4%BB%B6%E7%BB%98%E7%94%BB%E6%B8%90%E5%8F%98%E5%9B%BE%E5%83%8F"><span class="nav-number">4.15.</span> <span class="nav-text">给控件绘画渐变图像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sqlite%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="nav-number">4.16.</span> <span class="nav-text">Sqlite使用指令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QComboBox%E8%AE%BE%E7%BD%AE"><span class="nav-number">4.17.</span> <span class="nav-text">QComboBox设置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Qt%E7%9A%84SQL%E6%A8%A1%E5%9D%97"><span class="nav-number">5.</span> <span class="nav-text">Qt的SQL模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#QsqlTableModel%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">5.1.</span> <span class="nav-text">QsqlTableModel的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QSQLQueryModel%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">5.2.</span> <span class="nav-text">QSQLQueryModel的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QSqlRelationalTableModel%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">5.3.</span> <span class="nav-text">QSqlRelationalTableModel的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Qt-Designer%E6%8F%92%E4%BB%B6"><span class="nav-number">5.4.</span> <span class="nav-text">自定义Qt Designer插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Qt%E7%BC%96%E8%AF%91%E9%9D%99%E6%80%81%E5%BA%93%E4%B8%94%E4%BD%BF%E7%94%A8"><span class="nav-number">5.5.</span> <span class="nav-text">Qt编译静态库且使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8%E5%85%B1%E4%BA%AB%E5%BA%93"><span class="nav-number">5.6.</span> <span class="nav-text">创建和使用共享库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E6%88%91%E4%BB%AC%E7%9C%8B%E5%A6%82%E4%BD%95%E6%98%BE%E5%BC%8F%E8%B0%83%E7%94%A8%E5%8A%A8%E6%80%81%E5%BA%93%EF%BC%8C%E7%BC%96%E8%AF%91%E6%97%B6%E6%97%A0%E5%BA%8F%E5%8A%A8%E6%80%81%E5%BA%93%E7%9A%84%E4%BB%BB%E4%BD%95%E6%96%87%E4%BB%B6"><span class="nav-number">5.6.1.</span> <span class="nav-text">接下来我们看如何显式调用动态库，编译时无序动态库的任何文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6-def-%E8%A7%A3%E5%86%B3%E5%87%BD%E6%95%B0%E5%90%8D%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">5.6.2.</span> <span class="nav-text">用模块定义文件(.def)解决函数名的问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ABI"><span class="nav-number">5.7.</span> <span class="nav-text">ABI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API%E5%92%8CABI"><span class="nav-number">5.8.</span> <span class="nav-text">API和ABI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Qt%E4%BA%92%E6%96%A5%E9%87%8F%EF%BC%8C%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5"><span class="nav-number">5.9.</span> <span class="nav-text">Qt互斥量，线程同步</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="nav-number">5.10.</span> <span class="nav-text">网络编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#static-QList-lt-QHostAddress-gt-QNetworkInterface-allAddresses"><span class="nav-number">5.10.1.</span> <span class="nav-text">[static]QList &lt; QHostAddress &gt; QNetworkInterface:: allAddresses ()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#static-QList-lt-QNetworkInterface-gt-QNetworkInterface-allInterfaces"><span class="nav-number">5.10.2.</span> <span class="nav-text">[static]QList &lt; QNetworkInterface &gt;QNetworkInterface:: allInterfaces ()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QList-lt-QNetworkAddressEntry-gt-QNetworkInterface-addressEntries-const"><span class="nav-number">5.10.3.</span> <span class="nav-text">QList &lt; QNetworkAddressEntry &gt; QNetworkInterface:: addressEntries () const</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TCP%E9%80%9A%E4%BF%A1"><span class="nav-number">5.11.</span> <span class="nav-text">TCP通信</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">المقالات</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">تطبيق الموقع <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
